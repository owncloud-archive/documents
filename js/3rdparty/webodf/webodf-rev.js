/*

 This is a generated file. DO NOT EDIT.

 Copyright (C) 2010-2014 KO GmbH <copyright@kogmbh.com>

 @licstart
 This file is the compiled version of the WebODF library.

 WebODF is free software: you can redistribute it and/or modify it
 under the terms of the GNU Affero General Public License (GNU AGPL)
 as published by the Free Software Foundation, either version 3 of
 the License, or (at your option) any later version.

 WebODF is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU Affero General Public License for more details.

 You should have received a copy of the GNU Affero General Public License
 along with WebODF.  If not, see <http://www.gnu.org/licenses/>.
 @licend

 @source: http://www.webodf.org/
 @source: https://github.com/kogmbh/WebODF/
*/
var webodf_version="0.4.2-2454-g0803e08";function Runtime(){}Runtime.prototype.getVariable=function(f){};Runtime.prototype.toJson=function(f){};Runtime.prototype.fromJson=function(f){};Runtime.prototype.byteArrayFromString=function(f,g){};Runtime.prototype.byteArrayToString=function(f,g){};Runtime.prototype.read=function(f,g,d,b){};Runtime.prototype.readFile=function(f,g,d){};Runtime.prototype.readFileSync=function(f,g){};Runtime.prototype.loadXML=function(f,g){};Runtime.prototype.writeFile=function(f,g,d){};
Runtime.prototype.isFile=function(f,g){};Runtime.prototype.getFileSize=function(f,g){};Runtime.prototype.deleteFile=function(f,g){};Runtime.prototype.log=function(f,g){};Runtime.prototype.setTimeout=function(f,g){};Runtime.prototype.clearTimeout=function(f){};Runtime.prototype.libraryPaths=function(){};Runtime.prototype.currentDirectory=function(){};Runtime.prototype.setCurrentDirectory=function(f){};Runtime.prototype.type=function(){};Runtime.prototype.getDOMImplementation=function(){};
Runtime.prototype.parseXML=function(f){};Runtime.prototype.exit=function(f){};Runtime.prototype.getWindow=function(){};Runtime.prototype.requestAnimationFrame=function(f){};Runtime.prototype.cancelAnimationFrame=function(f){};Runtime.prototype.assert=function(f,g,d){};var IS_COMPILED_CODE=!0;
Runtime.byteArrayToString=function(f,g){function d(b){var d="",e,f=b.length;for(e=0;e<f;e+=1)d+=String.fromCharCode(b[e]&255);return d}function b(b){var d="",e,f=b.length,m=[],r,c,a,n;for(e=0;e<f;e+=1)r=b[e],128>r?m.push(r):(e+=1,c=b[e],194<=r&&224>r?m.push((r&31)<<6|c&63):(e+=1,a=b[e],224<=r&&240>r?m.push((r&15)<<12|(c&63)<<6|a&63):(e+=1,n=b[e],240<=r&&245>r&&(r=(r&7)<<18|(c&63)<<12|(a&63)<<6|n&63,r-=65536,m.push((r>>10)+55296,(r&1023)+56320))))),1E3<=m.length&&(d+=String.fromCharCode.apply(null,
m),m.length=0);return d+String.fromCharCode.apply(null,m)}var e;"utf8"===g?e=b(f):("binary"!==g&&this.log("Unsupported encoding: "+g),e=d(f));return e};Runtime.getVariable=function(f){try{return eval(f)}catch(g){}};Runtime.toJson=function(f){return JSON.stringify(f)};Runtime.fromJson=function(f){return JSON.parse(f)};Runtime.getFunctionName=function(f){return void 0===f.name?(f=/function\s+(\w+)/.exec(f))&&f[1]:f.name};
function BrowserRuntime(f){function g(b){var c=b.length,a,n,h=0;for(a=0;a<c;a+=1)n=b.charCodeAt(a),h+=1+(128<n)+(2048<n),55040<n&&57344>n&&(h+=1,a+=1);return h}function d(b,c,a){var n=b.length,h,d;c=new Uint8Array(new ArrayBuffer(c));a?(c[0]=239,c[1]=187,c[2]=191,d=3):d=0;for(a=0;a<n;a+=1)h=b.charCodeAt(a),128>h?(c[d]=h,d+=1):2048>h?(c[d]=192|h>>>6,c[d+1]=128|h&63,d+=2):55040>=h||57344<=h?(c[d]=224|h>>>12&15,c[d+1]=128|h>>>6&63,c[d+2]=128|h&63,d+=3):(a+=1,h=(h-55296<<10|b.charCodeAt(a)-56320)+65536,
c[d]=240|h>>>18&7,c[d+1]=128|h>>>12&63,c[d+2]=128|h>>>6&63,c[d+3]=128|h&63,d+=4);return c}function b(b){var c=b.length,a=new Uint8Array(new ArrayBuffer(c)),n;for(n=0;n<c;n+=1)a[n]=b.charCodeAt(n)&255;return a}function e(b,c){var a,n,h;void 0!==c?h=b:c=b;f?(n=f.ownerDocument,h&&(a=n.createElement("span"),a.className=h,a.appendChild(n.createTextNode(h)),f.appendChild(a),f.appendChild(n.createTextNode(" "))),a=n.createElement("span"),0<c.length&&"<"===c[0]?a.innerHTML=c:a.appendChild(n.createTextNode(c)),
f.appendChild(a),f.appendChild(n.createElement("br"))):console&&console.log(c);"alert"===h&&alert(c)}function k(e,c,a){if(0!==a.status||a.responseText)if(200===a.status||0===a.status){if(a.response&&"string"!==typeof a.response)"binary"===c?(a=a.response,a=new Uint8Array(a)):a=String(a.response);else if("binary"===c)if(null!==a.responseBody&&"undefined"!==String(typeof VBArray)){a=(new VBArray(a.responseBody)).toArray();var n=a.length,h=new Uint8Array(new ArrayBuffer(n));for(c=0;c<n;c+=1)h[c]=a[c];
a=h}else{(c=a.getResponseHeader("Content-Length"))&&(c=parseInt(c,10));if(c&&c!==a.responseText.length)a:{var n=a.responseText,h=!1,s=g(n);if("number"===typeof c){if(c!==s&&c!==s+3){n=void 0;break a}h=s+3===c;s=c}n=d(n,s,h)}void 0===n&&(n=b(a.responseText));a=n}else a=a.responseText;m[e]=a;e={err:null,data:a}}else e={err:a.responseText||a.statusText,data:null};else e={err:"File "+e+" is empty.",data:null};return e}function l(b,c,a){var n=new XMLHttpRequest;n.open("GET",b,a);n.overrideMimeType&&("binary"!==
c?n.overrideMimeType("text/plain; charset="+c):n.overrideMimeType("text/plain; charset=x-user-defined"));return n}function p(b,c,a){function n(){var n;4===h.readyState&&(n=k(b,c,h),a(n.err,n.data))}if(m.hasOwnProperty(b))a(null,m[b]);else{var h=l(b,c,!0);h.onreadystatechange=n;try{h.send(null)}catch(d){a(d.message,null)}}}var q=this,m={};this.byteArrayFromString=function(e,c){var a;"utf8"===c?a=d(e,g(e),!1):("binary"!==c&&q.log("unknown encoding: "+c),a=b(e));return a};this.byteArrayToString=Runtime.byteArrayToString;
this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=p;this.read=function(b,c,a,n){p(b,"binary",function(h,b){var d=null;if(b){if("string"===typeof b)throw"This should not happen.";d=b.subarray(c,c+a)}n(h,d)})};this.readFileSync=function(b,c){var a=l(b,c,!1),n;try{a.send(null);n=k(b,c,a);if(n.err)throw n.err;if(null===n.data)throw"No data read from "+b+".";}catch(h){throw h;}return n.data};this.writeFile=function(b,c,a){m[b]=c;var n=new XMLHttpRequest,
h;n.open("PUT",b,!0);n.onreadystatechange=function(){4===n.readyState&&(0!==n.status||n.responseText?200<=n.status&&300>n.status||0===n.status?a(null):a("Status "+String(n.status)+": "+n.responseText||n.statusText):a("File "+b+" is empty."))};h=c.buffer&&!n.sendAsBinary?c.buffer:q.byteArrayToString(c,"binary");try{n.sendAsBinary?n.sendAsBinary(h):n.send(h)}catch(d){q.log("HUH? "+d+" "+c),a(d.message)}};this.deleteFile=function(b,c){delete m[b];var a=new XMLHttpRequest;a.open("DELETE",b,!0);a.onreadystatechange=
function(){4===a.readyState&&(200>a.status&&300<=a.status?c(a.responseText):c(null))};a.send(null)};this.loadXML=function(b,c){var a=new XMLHttpRequest;a.open("GET",b,!0);a.overrideMimeType&&a.overrideMimeType("text/xml");a.onreadystatechange=function(){4===a.readyState&&(0!==a.status||a.responseText?200===a.status||0===a.status?c(null,a.responseXML):c(a.responseText,null):c("File "+b+" is empty.",null))};try{a.send(null)}catch(n){c(n.message,null)}};this.isFile=function(b,c){q.getFileSize(b,function(a){c(-1!==
a)})};this.getFileSize=function(b,c){if(m.hasOwnProperty(b)&&"string"!==typeof m[b])c(m[b].length);else{var a=new XMLHttpRequest;a.open("HEAD",b,!0);a.onreadystatechange=function(){if(4===a.readyState){var n=a.getResponseHeader("Content-Length");n?c(parseInt(n,10)):p(b,"binary",function(a,n){a?c(-1):c(n.length)})}};a.send(null)}};this.log=e;this.assert=function(b,c,a){if(!b)throw e("alert","ASSERTION FAILED:\n"+c),a&&a(),c;};this.setTimeout=function(b,c){return setTimeout(function(){b()},c)};this.clearTimeout=
function(b){clearTimeout(b)};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(){};this.currentDirectory=function(){return""};this.type=function(){return"BrowserRuntime"};this.getDOMImplementation=function(){return window.document.implementation};this.parseXML=function(b){return(new DOMParser).parseFromString(b,"text/xml")};this.exit=function(b){e("Calling exit with code "+String(b)+", but exit() is not implemented.")};this.getWindow=function(){return window};this.requestAnimationFrame=
function(b){var c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,a=0;if(c)c.bind(window),a=c(b);else return setTimeout(b,15);return a};this.cancelAnimationFrame=function(b){var c=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;c?(c.bind(window),c(b)):clearTimeout(b)}}
function NodeJSRuntime(){function f(b){var d=b.length,e,c=new Uint8Array(new ArrayBuffer(d));for(e=0;e<d;e+=1)c[e]=b[e];return c}function g(d,l,p){function c(a,c){if(a)return p(a,null);if(!c)return p("No data for "+d+".",null);if("string"===typeof c)return p(a,c);p(a,f(c))}d=e.resolve(k,d);"binary"!==l?b.readFile(d,l,c):b.readFile(d,null,c)}var d=this,b=require("fs"),e=require("path"),k="",l,p;this.byteArrayFromString=function(b,d){var e=new Buffer(b,d),c,a=e.length,n=new Uint8Array(new ArrayBuffer(a));
for(c=0;c<a;c+=1)n[c]=e[c];return n};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=g;this.loadXML=function(b,e){g(b,"utf-8",function(f,c){if(f)return e(f,null);if(!c)return e("No data for "+b+".",null);e(null,d.parseXML(c))})};this.writeFile=function(d,f,l){f=new Buffer(f);d=e.resolve(k,d);b.writeFile(d,f,"binary",function(c){l(c||null)})};this.deleteFile=function(d,f){d=e.resolve(k,d);
b.unlink(d,f)};this.read=function(d,l,p,c){d=e.resolve(k,d);b.open(d,"r+",666,function(a,n){if(a)c(a,null);else{var h=new Buffer(p);b.read(n,h,0,p,l,function(a){b.close(n);c(a,f(h))})}})};this.readFileSync=function(d,e){var l;l=b.readFileSync(d,"binary"===e?null:e);if(null===l)throw"File "+d+" could not be read.";"binary"===e&&(l=f(l));return l};this.isFile=function(d,f){d=e.resolve(k,d);b.stat(d,function(b,c){f(!b&&c.isFile())})};this.getFileSize=function(d,f){d=e.resolve(k,d);b.stat(d,function(b,
c){b?f(-1):f(c.size)})};this.log=function(b,d){var e;void 0!==d?e=b:d=b;"alert"===e&&process.stderr.write("\n!!!!! ALERT !!!!!\n");process.stderr.write(d+"\n");"alert"===e&&process.stderr.write("!!!!! ALERT !!!!!\n")};this.assert=function(b,d,e){b||(process.stderr.write("ASSERTION FAILED: "+d),e&&e())};this.setTimeout=function(b,d){return setTimeout(function(){b()},d)};this.clearTimeout=function(b){clearTimeout(b)};this.libraryPaths=function(){return[__dirname]};this.setCurrentDirectory=function(b){k=
b};this.currentDirectory=function(){return k};this.type=function(){return"NodeJSRuntime"};this.getDOMImplementation=function(){return p};this.parseXML=function(b){return l.parseFromString(b,"text/xml")};this.exit=process.exit;this.getWindow=function(){return null};this.requestAnimationFrame=function(b){return setTimeout(b,15)};this.cancelAnimationFrame=function(b){clearTimeout(b)};l=new (require("xmldom").DOMParser);p=d.parseXML("<a/>").implementation}
function RhinoRuntime(){function f(b,d){var e;void 0!==d?e=b:d=b;"alert"===e&&print("\n!!!!! ALERT !!!!!");print(d);"alert"===e&&print("!!!!! ALERT !!!!!")}var g=this,d={},b=d.javax.xml.parsers.DocumentBuilderFactory.newInstance(),e,k,l="";b.setValidating(!1);b.setNamespaceAware(!0);b.setExpandEntityReferences(!1);b.setSchema(null);k=d.org.xml.sax.EntityResolver({resolveEntity:function(b,e){var f=new d.java.io.FileReader(e);return new d.org.xml.sax.InputSource(f)}});e=b.newDocumentBuilder();e.setEntityResolver(k);
this.byteArrayFromString=function(b,d){var e,f=b.length,c=new Uint8Array(new ArrayBuffer(f));for(e=0;e<f;e+=1)c[e]=b.charCodeAt(e)&255;return c};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.loadXML=function(b,f){var l=new d.java.io.File(b),g=null;try{g=e.parse(l)}catch(c){return print(c),f(c,null)}f(null,g)};this.readFile=function(b,e,f){l&&(b=l+"/"+b);var k=new d.java.io.File(b),c="binary"===e?
"latin1":e;k.isFile()?((b=readFile(b,c))&&"binary"===e&&(b=g.byteArrayFromString(b,"binary")),f(null,b)):f(b+" is not a file.",null)};this.writeFile=function(b,e,f){l&&(b=l+"/"+b);b=new d.java.io.FileOutputStream(b);var g,c=e.length;for(g=0;g<c;g+=1)b.write(e[g]);b.close();f(null)};this.deleteFile=function(b,e){l&&(b=l+"/"+b);var f=new d.java.io.File(b),g=b+Math.random(),g=new d.java.io.File(g);f.rename(g)?(g.deleteOnExit(),e(null)):e("Could not delete "+b)};this.read=function(b,e,f,g){l&&(b=l+"/"+
b);var c;c=b;var a="binary";(new d.java.io.File(c)).isFile()?("binary"===a&&(a="latin1"),c=readFile(c,a)):c=null;c?g(null,this.byteArrayFromString(c.substring(e,e+f),"binary")):g("Cannot read "+b,null)};this.readFileSync=function(b,d){if(!d)return"";var e=readFile(b,d);if(null===e)throw"File could not be read.";return e};this.isFile=function(b,e){l&&(b=l+"/"+b);var f=new d.java.io.File(b);e(f.isFile())};this.getFileSize=function(b,e){l&&(b=l+"/"+b);var f=new d.java.io.File(b);e(f.length())};this.log=
f;this.assert=function(b,d,e){b||(f("alert","ASSERTION FAILED: "+d),e&&e())};this.setTimeout=function(b){b();return 0};this.clearTimeout=function(){};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(b){l=b};this.currentDirectory=function(){return l};this.type=function(){return"RhinoRuntime"};this.getDOMImplementation=function(){return e.getDOMImplementation()};this.parseXML=function(b){b=new d.java.io.StringReader(b);b=new d.org.xml.sax.InputSource(b);return e.parse(b)};
this.exit=quit;this.getWindow=function(){return null};this.requestAnimationFrame=function(b){b();return 0};this.cancelAnimationFrame=function(){}}Runtime.create=function(){return"undefined"!==String(typeof window)?new BrowserRuntime(window.document.getElementById("logoutput")):"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime};var runtime=Runtime.create(),core={},gui={},xmldom={},odf={},ops={},webodf={};
(function(){webodf.Version="undefined"!==String(typeof webodf_version)?webodf_version:"From Source"})();
(function(){function f(b,d,e){var f=b+"/manifest.json",c,a;runtime.log("Loading manifest: "+f);try{c=runtime.readFileSync(f,"utf-8")}catch(n){if(e)runtime.log("No loadable manifest found.");else throw console.log(String(n)),n;return}e=JSON.parse(c);for(a in e)e.hasOwnProperty(a)&&(d[a]={dir:b,deps:e[a]})}function g(b,d,e){function f(h){if(!n[h]&&!e(h)){if(a[h])throw"Circular dependency detected for "+h+".";a[h]=!0;if(!d[h])throw"Missing dependency information for class "+h+".";var b=d[h],l=b.deps,
g,k=l.length;for(g=0;g<k;g+=1)f(l[g]);a[h]=!1;n[h]=!0;c.push(b.dir+"/"+h.replace(".","/")+".js")}}var c=[],a={},n={};b.forEach(f);return c}function d(b,d){return d=d+("\n//# sourceURL="+b)+("\n//@ sourceURL="+b)}function b(b){var e,f;for(e=0;e<b.length;e+=1)f=runtime.readFileSync(b[e],"utf-8"),f=d(b[e],f),eval(f)}function e(b){b=b.split(".");var d,e=l,f=b.length;for(d=0;d<f;d+=1){if(!e.hasOwnProperty(b[d]))return!1;e=e[b[d]]}return!0}var k,l={core:core,gui:gui,xmldom:xmldom,odf:odf,ops:ops};runtime.loadClasses=
function(d,l){if(IS_COMPILED_CODE||0===d.length)return l&&l();var m;if(!(m=k)){m=[];var r=runtime.libraryPaths(),c;runtime.currentDirectory()&&-1===r.indexOf(runtime.currentDirectory())&&f(runtime.currentDirectory(),m,!0);for(c=0;c<r.length;c+=1)f(r[c],m)}k=m;d=g(d,k,e);if(0===d.length)return l&&l();if("BrowserRuntime"===runtime.type()&&l){m=d;r=document.currentScript||document.documentElement.lastChild;c=document.createDocumentFragment();var a,n;for(n=0;n<m.length;n+=1)a=document.createElement("script"),
a.type="text/javascript",a.charset="utf-8",a.async=!1,a.setAttribute("src",m[n]),c.appendChild(a);l&&(a.onload=l);r.parentNode.insertBefore(c,r)}else b(d),l&&l()};runtime.loadClass=function(b,d){runtime.loadClasses([b],d)}})();(function(){var f=function(f){return f};runtime.getTranslator=function(){return f};runtime.setTranslator=function(g){f=g};runtime.tr=function(g){var d=f(g);return d&&"string"===String(typeof d)?d:g}})();
(function(f){function g(d){if(d.length){var b=d[0];runtime.readFile(b,"utf8",function(e,f){function l(){var b;(b=eval(q))&&runtime.exit(b)}var g="",g=b.lastIndexOf("/"),q=f,g=-1!==g?b.substring(0,g):".";runtime.setCurrentDirectory(g);e?(runtime.log(e),runtime.exit(1)):null===q?(runtime.log("No code found for "+b),runtime.exit(1)):l.apply(null,d)})}}f=f?Array.prototype.slice.call(f):[];"NodeJSRuntime"===runtime.type()?g(process.argv.slice(2)):"RhinoRuntime"===runtime.type()?g(f):g(f.slice(1))})("undefined"!==
String(typeof arguments)&&arguments);(function(){core.Async=function(){return{forEach:function(f,g,d){function b(b){l!==k&&(b?(l=k,d(b)):(l+=1,l===k&&d(null)))}var e,k=f.length,l=0;for(e=0;e<k;e+=1)g(f[e],b)},destroyAll:function(f,g){function d(b,e){if(e)g(e);else if(b<f.length)f[b](function(e){d(b+1,e)});else g()}d(0,void 0)}}}()})();function makeBase64(){function f(a){var c,h=a.length,b=new Uint8Array(new ArrayBuffer(h));for(c=0;c<h;c+=1)b[c]=a.charCodeAt(c)&255;return b}function g(a){var c,h="",b,n=a.length-2;for(b=0;b<n;b+=3)c=a[b]<<16|a[b+1]<<8|a[b+2],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>18],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>12&63],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>6&63],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c&
63];b===n+1?(c=a[b]<<4,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>6],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c&63],h+="=="):b===n&&(c=a[b]<<10|a[b+1]<<2,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>12],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>6&63],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c&63],h+="=");return h}function d(a){a=a.replace(/[^A-Za-z0-9+\/]+/g,
"");var c=a.length,b=new Uint8Array(new ArrayBuffer(3*c)),n=a.length%4,d=0,e,f;for(e=0;e<c;e+=4)f=(h[a.charAt(e)]||0)<<18|(h[a.charAt(e+1)]||0)<<12|(h[a.charAt(e+2)]||0)<<6|(h[a.charAt(e+3)]||0),b[d]=f>>16,b[d+1]=f>>8&255,b[d+2]=f&255,d+=3;c=3*c-[0,0,2,1][n];return b.subarray(0,c)}function b(a){var c,h,b=a.length,n=0,d=new Uint8Array(new ArrayBuffer(3*b));for(c=0;c<b;c+=1)h=a[c],128>h?d[n++]=h:(2048>h?d[n++]=192|h>>>6:(d[n++]=224|h>>>12&15,d[n++]=128|h>>>6&63),d[n++]=128|h&63);return d.subarray(0,
n)}function e(a){var c,h,b,n,d=a.length,e=new Uint8Array(new ArrayBuffer(d)),f=0;for(c=0;c<d;c+=1)h=a[c],128>h?e[f++]=h:(c+=1,b=a[c],224>h?e[f++]=(h&31)<<6|b&63:(c+=1,n=a[c],e[f++]=(h&15)<<12|(b&63)<<6|n&63));return e.subarray(0,f)}function k(a){return g(f(a))}function l(a){return String.fromCharCode.apply(String,d(a))}function p(a){return e(f(a))}function q(a){a=e(a);for(var c="",h=0;h<a.length;)c+=String.fromCharCode.apply(String,a.subarray(h,h+45E3)),h+=45E3;return c}function m(a,c,h){var b,n,
d,e="";for(d=c;d<h;d+=1)c=a.charCodeAt(d)&255,128>c?e+=String.fromCharCode(c):(d+=1,b=a.charCodeAt(d)&255,224>c?e+=String.fromCharCode((c&31)<<6|b&63):(d+=1,n=a.charCodeAt(d)&255,e+=String.fromCharCode((c&15)<<12|(b&63)<<6|n&63)));return e}function r(a,c){function h(){var d=n+1E5;d>a.length&&(d=a.length);b+=m(a,n,d);n=d;d=n===a.length;c(b,d)&&!d&&runtime.setTimeout(h,0)}var b="",n=0;1E5>a.length?c(m(a,0,a.length),!0):("string"!==typeof a&&(a=a.slice()),h())}function c(a){return b(f(a))}function a(a){return String.fromCharCode.apply(String,
b(a))}function n(a){return String.fromCharCode.apply(String,b(f(a)))}var h=function(a){var c={},h,b;h=0;for(b=a.length;h<b;h+=1)c[a.charAt(h)]=h;return c}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),s,v,y=runtime.getWindow(),w,u;y&&y.btoa?(w=y.btoa,s=function(a){return w(n(a))}):(w=k,s=function(a){return g(c(a))});y&&y.atob?(u=y.atob,v=function(a){a=u(a);return m(a,0,a.length)}):(u=l,v=function(a){return q(d(a))});core.Base64=function(){this.convertByteArrayToBase64=this.convertUTF8ArrayToBase64=
g;this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=d;this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=b;this.convertByteArrayToUTF16Array=this.convertUTF8ArrayToUTF16Array=e;this.convertUTF8StringToBase64=k;this.convertBase64ToUTF8String=l;this.convertUTF8StringToUTF16Array=p;this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=q;this.convertUTF8StringToUTF16String=r;this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=c;this.convertUTF16ArrayToUTF8String=
a;this.convertUTF16StringToUTF8String=n;this.convertUTF16StringToBase64=s;this.convertBase64ToUTF16String=v;this.fromBase64=l;this.toBase64=k;this.atob=u;this.btoa=w;this.utob=n;this.btou=r;this.encode=s;this.encodeURI=function(a){return s(a).replace(/[+\/]/g,function(a){return"+"===a?"-":"_"}).replace(/\\=+$/,"")};this.decode=function(a){return v(a.replace(/[\-_]/g,function(a){return"-"===a?"+":"/"}))};return this};return core.Base64}core.Base64=makeBase64();core.ByteArray=function(f){this.pos=0;this.data=f;this.readUInt32LE=function(){this.pos+=4;var f=this.data,d=this.pos;return f[--d]<<24|f[--d]<<16|f[--d]<<8|f[--d]};this.readUInt16LE=function(){this.pos+=2;var f=this.data,d=this.pos;return f[--d]<<8|f[--d]}};core.ByteArrayWriter=function(f){function g(d){d>e-b&&(e=Math.max(2*e,b+d),d=new Uint8Array(new ArrayBuffer(e)),d.set(k),k=d)}var d=this,b=0,e=1024,k=new Uint8Array(new ArrayBuffer(e));this.appendByteArrayWriter=function(b){d.appendByteArray(b.getByteArray())};this.appendByteArray=function(d){var e=d.length;g(e);k.set(d,b);b+=e};this.appendArray=function(d){var e=d.length;g(e);k.set(d,b);b+=e};this.appendUInt16LE=function(b){d.appendArray([b&255,b>>8&255])};this.appendUInt32LE=function(b){d.appendArray([b&
255,b>>8&255,b>>16&255,b>>24&255])};this.appendString=function(b){d.appendByteArray(runtime.byteArrayFromString(b,f))};this.getLength=function(){return b};this.getByteArray=function(){var d=new Uint8Array(new ArrayBuffer(b));d.set(k.subarray(0,b));return d}};core.CSSUnits=function(){var f=this,g={"in":1,cm:2.54,mm:25.4,pt:72,pc:12,px:96};this.convert=function(d,b,e){return d*g[e]/g[b]};this.convertMeasure=function(d,b){var e,g;d&&b&&(e=parseFloat(d),g=d.replace(e.toString(),""),e=f.convert(e,g,b));return e};this.getUnits=function(d){return d.substr(d.length-2,d.length)}};(function(){function f(){var b,e,f,g,p,q,m,r,c;void 0===d&&(e=(b=runtime.getWindow())&&b.document,q=e.documentElement,m=e.body,d={rangeBCRIgnoresElementBCR:!1,unscaledRangeClientRects:!1,elementBCRIgnoresBodyScroll:!1},e&&(g=e.createElement("div"),g.style.position="absolute",g.style.left="-99999px",g.style.transform="scale(2)",g.style["-webkit-transform"]="scale(2)",p=e.createElement("div"),g.appendChild(p),m.appendChild(g),b=e.createRange(),b.selectNode(p),d.rangeBCRIgnoresElementBCR=0===b.getClientRects().length,
p.appendChild(e.createTextNode("Rect transform test")),e=p.getBoundingClientRect(),f=b.getBoundingClientRect(),d.unscaledRangeClientRects=2<Math.abs(e.height-f.height),g.style.transform="",g.style["-webkit-transform"]="",e=q.style.overflow,f=m.style.overflow,r=m.style.height,c=m.scrollTop,q.style.overflow="visible",m.style.overflow="visible",m.style.height="200%",m.scrollTop=m.scrollHeight,d.elementBCRIgnoresBodyScroll=b.getBoundingClientRect().top!==p.getBoundingClientRect().top,m.scrollTop=c,m.style.height=
r,m.style.overflow=f,q.style.overflow=e,b.detach(),m.removeChild(g),b=Object.keys(d).map(function(a){return a+":"+String(d[a])}).join(", "),runtime.log("Detected browser quirks - "+b)));return d}function g(b,d,f){for(b=b?b.firstElementChild:null;b;){if(b.localName===f&&b.namespaceURI===d)return b;b=b.nextElementSibling}return null}var d;core.DomUtils=function(){function b(a,c){for(var h=0,b;a.parentNode!==c;)runtime.assert(null!==a.parentNode,"parent is null"),a=a.parentNode;for(b=c.firstChild;b!==
a;)h+=1,b=b.nextSibling;return h}function d(a,c){return 0>=a.compareBoundaryPoints(Range.START_TO_START,c)&&0<=a.compareBoundaryPoints(Range.END_TO_END,c)}function k(a,c){var h=null;a.nodeType===Node.TEXT_NODE&&(0===a.length?(a.parentNode.removeChild(a),c.nodeType===Node.TEXT_NODE&&(h=c)):(c.nodeType===Node.TEXT_NODE&&(a.appendData(c.data),c.parentNode.removeChild(c)),h=a));return h}function l(a){for(var c=a.parentNode;a.firstChild;)c.insertBefore(a.firstChild,a);c.removeChild(a);return c}function p(a,
c){for(var h=a.parentNode,b=a.firstChild,d;b;)d=b.nextSibling,p(b,c),b=d;h&&c(a)&&l(a);return h}function q(a,c){return a===c||Boolean(a.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function m(a,c){return f().unscaledRangeClientRects?a:a/c}function r(a,c,h){Object.keys(c).forEach(function(b){var d=b.split(":"),e=d[1],f=h(d[0]),d=c[b],g=typeof d;"object"===g?Object.keys(d).length&&(b=f?a.getElementsByTagNameNS(f,e)[0]||a.ownerDocument.createElementNS(f,b):a.getElementsByTagName(e)[0]||
a.ownerDocument.createElement(b),a.appendChild(b),r(b,d,h)):f&&(runtime.assert("number"===g||"string"===g,"attempting to map unsupported type '"+g+"' (key: "+b+")"),a.setAttributeNS(f,b,String(d)))})}var c=null;this.splitBoundaries=function(a){var c,h=[],d,e,f;if(a.startContainer.nodeType===Node.TEXT_NODE||a.endContainer.nodeType===Node.TEXT_NODE){d=a.endContainer;e=a.endContainer.nodeType!==Node.TEXT_NODE?a.endOffset===a.endContainer.childNodes.length:!1;f=a.endOffset;c=a.endContainer;if(f<c.childNodes.length)for(c=
c.childNodes.item(f),f=0;c.firstChild;)c=c.firstChild;else for(;c.lastChild;)c=c.lastChild,f=c.nodeType===Node.TEXT_NODE?c.textContent.length:c.childNodes.length;c===d&&(d=null);a.setEnd(c,f);f=a.endContainer;0!==a.endOffset&&f.nodeType===Node.TEXT_NODE&&(c=f,a.endOffset!==c.length&&(h.push(c.splitText(a.endOffset)),h.push(c)));f=a.startContainer;0!==a.startOffset&&f.nodeType===Node.TEXT_NODE&&(c=f,a.startOffset!==c.length&&(f=c.splitText(a.startOffset),h.push(c),h.push(f),a.setStart(f,0)));if(null!==
d){for(f=a.endContainer;f.parentNode&&f.parentNode!==d;)f=f.parentNode;e=e?d.childNodes.length:b(f,d);a.setEnd(d,e)}}return h};this.containsRange=d;this.rangesIntersect=function(a,c){return 0>=a.compareBoundaryPoints(Range.END_TO_START,c)&&0<=a.compareBoundaryPoints(Range.START_TO_END,c)};this.getNodesInRange=function(a,c,h){var b=[],d=a.commonAncestorContainer,d=d.nodeType===Node.TEXT_NODE?d.parentNode:d;h=a.startContainer.ownerDocument.createTreeWalker(d,h,c,!1);var e,f;a.endContainer.childNodes[a.endOffset-
1]?(e=a.endContainer.childNodes[a.endOffset-1],f=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY):(e=a.endContainer,f=Node.DOCUMENT_POSITION_PRECEDING);a.startContainer.childNodes[a.startOffset]?(a=a.startContainer.childNodes[a.startOffset],h.currentNode=a):a.startOffset===(a.startContainer.nodeType===Node.TEXT_NODE?a.startContainer.length:a.startContainer.childNodes.length)?(a=a.startContainer,h.currentNode=a,h.lastChild(),a=h.nextNode()):(a=a.startContainer,h.currentNode=a);
if(a){a=h.currentNode;if(a!==d)for(a=a.parentNode;a&&a!==d;)c(a)===NodeFilter.FILTER_REJECT&&(h.currentNode=a),a=a.parentNode;a=h.currentNode;switch(c(a)){case NodeFilter.FILTER_REJECT:for(a=h.nextSibling();!a&&h.parentNode();)a=h.nextSibling();break;case NodeFilter.FILTER_SKIP:a=h.nextNode()}for(;a;){c=e.compareDocumentPosition(a);if(0!==c&&0===(c&f))break;b.push(a);a=h.nextNode()}}return b};this.normalizeTextNodes=function(a){a&&a.nextSibling&&(a=k(a,a.nextSibling));a&&a.previousSibling&&k(a.previousSibling,
a)};this.rangeContainsNode=function(a,c){var b=c.ownerDocument.createRange(),f=c.ownerDocument.createRange(),g;b.setStart(a.startContainer,a.startOffset);b.setEnd(a.endContainer,a.endOffset);f.selectNodeContents(c);g=d(b,f);b.detach();f.detach();return g};this.mergeIntoParent=l;this.removeUnwantedNodes=p;this.getElementsByTagNameNS=function(a,c,b){var d=[];a=a.getElementsByTagNameNS(c,b);d.length=b=a.length;for(c=0;c<b;c+=1)d[c]=a.item(c);return d};this.getElementsByTagName=function(a,c){var b=[],
d,e,f;d=a.getElementsByTagName(c);b.length=f=d.length;for(e=0;e<f;e+=1)b[e]=d.item(e);return b};this.containsNode=function(a,c){return a===c||a.contains(c)};this.comparePoints=function(a,c,h,d){if(a===h)return d-c;var e=a.compareDocumentPosition(h);2===e?e=-1:4===e?e=1:10===e?(c=b(a,h),e=c<d?1:-1):(d=b(h,a),e=d<c?-1:1);return e};this.adaptRangeDifferenceToZoomLevel=m;this.translateRect=function(a,c,b){return{top:m(a.top-c.top,b),left:m(a.left-c.left,b),bottom:m(a.bottom-c.top,b),right:m(a.right-c.left,
b),width:m(a.width,b),height:m(a.height,b)}};this.getBoundingClientRect=function(a){var b=a.ownerDocument,h=f(),d=b.body;if((!1===h.unscaledRangeClientRects||h.rangeBCRIgnoresElementBCR)&&a.nodeType===Node.ELEMENT_NODE)return a=a.getBoundingClientRect(),h.elementBCRIgnoresBodyScroll?{left:a.left+d.scrollLeft,right:a.right+d.scrollLeft,top:a.top+d.scrollTop,bottom:a.bottom+d.scrollTop,width:a.width,height:a.height}:a;var e;c?e=c:c=e=b.createRange();h=e;h.selectNode(a);return h.getBoundingClientRect()};
this.mapKeyValObjOntoNode=function(a,c,b){Object.keys(c).forEach(function(d){var e=d.split(":"),f=e[1],e=b(e[0]),g=c[d];e?(f=a.getElementsByTagNameNS(e,f)[0],f||(f=a.ownerDocument.createElementNS(e,d),a.appendChild(f)),f.textContent=g):runtime.log("Key ignored: "+d)})};this.removeKeyElementsFromNode=function(a,c,b){c.forEach(function(c){var d=c.split(":"),e=d[1];(d=b(d[0]))?(e=a.getElementsByTagNameNS(d,e)[0])?e.parentNode.removeChild(e):runtime.log("Element for "+c+" not found."):runtime.log("Property Name ignored: "+
c)})};this.getKeyValRepresentationOfNode=function(a,c){for(var b={},d=a.firstElementChild,e;d;){if(e=c(d.namespaceURI))b[e+":"+d.localName]=d.textContent;d=d.nextElementSibling}return b};this.mapObjOntoNode=r;this.getDirectChild=g;(function(a){var c,b;b=runtime.getWindow();null!==b&&(c=b.navigator.appVersion.toLowerCase(),b=-1===c.indexOf("chrome")&&(-1!==c.indexOf("applewebkit")||-1!==c.indexOf("safari")),c=c.indexOf("msie"),b||c)&&(a.containsNode=q)})(this)}})();core.Cursor=function(f,g){function d(c){c.parentNode&&(p.push(c.previousSibling),p.push(c.nextSibling),c.parentNode.removeChild(c))}function b(c,a,b){if(a.nodeType===Node.TEXT_NODE){runtime.assert(Boolean(a),"putCursorIntoTextNode: invalid container");var h=a.parentNode;runtime.assert(Boolean(h),"putCursorIntoTextNode: container without parent");runtime.assert(0<=b&&b<=a.length,"putCursorIntoTextNode: offset is out of bounds");0===b?h.insertBefore(c,a):(b!==a.length&&a.splitText(b),h.insertBefore(c,
a.nextSibling))}else a.nodeType===Node.ELEMENT_NODE&&a.insertBefore(c,a.childNodes.item(b));p.push(c.previousSibling);p.push(c.nextSibling)}var e=f.createElementNS("urn:webodf:names:cursor","cursor"),k=f.createElementNS("urn:webodf:names:cursor","anchor"),l,p=[],q=f.createRange(),m,r=new core.DomUtils;this.getNode=function(){return e};this.getAnchorNode=function(){return k.parentNode?k:e};this.getSelectedRange=function(){m?(q.setStartBefore(e),q.collapse(!0)):(q.setStartAfter(l?k:e),q.setEndBefore(l?
e:k));return q};this.setSelectedRange=function(c,a){q&&q!==c&&q.detach();q=c;l=!1!==a;(m=c.collapsed)?(d(k),d(e),b(e,c.startContainer,c.startOffset)):(d(k),d(e),b(l?e:k,c.endContainer,c.endOffset),b(l?k:e,c.startContainer,c.startOffset));p.forEach(r.normalizeTextNodes);p.length=0};this.hasForwardSelection=function(){return l};this.remove=function(){d(e);p.forEach(r.normalizeTextNodes);p.length=0};e.setAttributeNS("urn:webodf:names:cursor","memberId",g);k.setAttributeNS("urn:webodf:names:cursor","memberId",
g)};core.Destroyable=function(){};core.Destroyable.prototype.destroy=function(f){};core.EventNotifier=function(f){function g(b){runtime.assert(!d.hasOwnProperty(b),'Duplicated event ids: "'+b+'" registered more than once.');d[b]=[]}var d={};this.emit=function(b,e){var f,g;runtime.assert(d.hasOwnProperty(b),'unknown event fired "'+b+'"');g=d[b];for(f=0;f<g.length;f+=1)g[f](e)};this.subscribe=function(b,e){runtime.assert(d.hasOwnProperty(b),'tried to subscribe to unknown event "'+b+'"');d[b].push(e)};this.unsubscribe=function(b,e){var f;runtime.assert(d.hasOwnProperty(b),'tried to unsubscribe from unknown event "'+
b+'"');f=d[b].indexOf(e);runtime.assert(-1!==f,'tried to unsubscribe unknown callback from event "'+b+'"');-1!==f&&d[b].splice(f,1)};this.register=g;f&&f.forEach(g)};core.LoopWatchDog=function(f,g){var d=Date.now(),b=0;this.check=function(){var e;if(f&&(e=Date.now(),e-d>f))throw runtime.log("alert","watchdog timeout"),"timeout!";if(0<g&&(b+=1,b>g))throw runtime.log("alert","watchdog loop overflow"),"loop overflow";}};core.PositionIterator=function(f,g,d,b){function e(){this.acceptNode=function(a){return!a||a.nodeType===n&&0===a.length?v:s}}function k(a){this.acceptNode=function(c){return!c||c.nodeType===n&&0===c.length?v:a.acceptNode(c)}}function l(){var a=r.currentNode,b=a.nodeType;c=b===n?a.length-1:b===h?1:0}function p(){if(null===r.previousSibling()){if(!r.parentNode()||r.currentNode===f)return r.firstChild(),!1;c=0}else l();return!0}function q(){var b=r.currentNode,h;h=a(b);if(b!==f)for(b=b.parentNode;b&&
b!==f;)a(b)===v&&(r.currentNode=b,h=v),b=b.parentNode;h===v?(c=1,b=m.nextPosition()):b=h===s?!0:m.nextPosition();b&&runtime.assert(a(r.currentNode)===s,"moveToAcceptedNode did not result in walker being on an accepted node");return b}var m=this,r,c,a,n=Node.TEXT_NODE,h=Node.ELEMENT_NODE,s=NodeFilter.FILTER_ACCEPT,v=NodeFilter.FILTER_REJECT;this.nextPosition=function(){var a=r.currentNode,b=a.nodeType;if(a===f)return!1;if(0===c&&b===h)null===r.firstChild()&&(c=1);else if(b===n&&c+1<a.length)c+=1;else if(null!==
r.nextSibling())c=0;else if(r.parentNode())c=1;else return!1;return!0};this.previousPosition=function(){var a=!0,b=r.currentNode;0===c?a=p():b.nodeType===n?c-=1:null!==r.lastChild()?l():b===f?a=!1:c=0;return a};this.previousNode=p;this.container=function(){var a=r.currentNode,b=a.nodeType;0===c&&b!==n&&(a=a.parentNode);return a};this.rightNode=function(){var b=r.currentNode,d=b.nodeType;if(d===n&&c===b.length)for(b=b.nextSibling;b&&a(b)!==s;)b=b.nextSibling;else d===h&&1===c&&(b=null);return b};this.leftNode=
function(){var b=r.currentNode;if(0===c)for(b=b.previousSibling;b&&a(b)!==s;)b=b.previousSibling;else if(b.nodeType===h)for(b=b.lastChild;b&&a(b)!==s;)b=b.previousSibling;return b};this.getCurrentNode=function(){return r.currentNode};this.unfilteredDomOffset=function(){if(r.currentNode.nodeType===n)return c;for(var a=0,b=r.currentNode,b=1===c?b.lastChild:b.previousSibling;b;)a+=1,b=b.previousSibling;return a};this.getPreviousSibling=function(){var a=r.currentNode,c=r.previousSibling();r.currentNode=
a;return c};this.getNextSibling=function(){var a=r.currentNode,c=r.nextSibling();r.currentNode=a;return c};this.setPositionBeforeElement=function(a){runtime.assert(Boolean(a),"setPositionBeforeElement called without element");r.currentNode=a;c=0;return q()};this.setUnfilteredPosition=function(a,b){runtime.assert(Boolean(a),"PositionIterator.setUnfilteredPosition called without container");r.currentNode=a;if(a.nodeType===n)return c=b,runtime.assert(b<=a.length,"Error in setPosition: "+b+" > "+a.length),
runtime.assert(0<=b,"Error in setPosition: "+b+" < 0"),b===a.length&&(r.nextSibling()?c=0:r.parentNode()?c=1:runtime.assert(!1,"Error in setUnfilteredPosition: position not valid.")),!0;b<a.childNodes.length?(r.currentNode=a.childNodes.item(b),c=0):c=1;return q()};this.moveToEnd=function(){r.currentNode=f;c=1};this.moveToEndOfNode=function(a){a.nodeType===n?m.setUnfilteredPosition(a,a.length):(r.currentNode=a,c=1)};this.isBeforeNode=function(){return 0===c};this.getNodeFilter=function(){return a};
a=(d?new k(d):new e).acceptNode;a.acceptNode=a;g=g||NodeFilter.SHOW_ALL;runtime.assert(f.nodeType!==Node.TEXT_NODE,"Internet Explorer doesn't allow tree walker roots to be text nodes");r=f.ownerDocument.createTreeWalker(f,g,a,b);c=0;null===r.firstChild()&&(c=1)};core.PositionFilter=function(){};core.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3};core.PositionFilter.prototype.acceptPosition=function(f){};core.PositionFilterChain=function(){var f=[],g=core.PositionFilter.FilterResult.FILTER_ACCEPT,d=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(b){var e;for(e=0;e<f.length;e+=1)if(f[e].acceptPosition(b)===d)return d;return g};this.addFilter=function(b){f.push(b)}};core.zip_HuftNode=function(){this.n=this.b=this.e=0;this.t=null};core.zip_HuftList=function(){this.list=this.next=null};
core.RawInflate=function(){function f(a,c,b,h,d,e){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;var n=Array(this.BMAX+1),f,g,l,s,k,r,m,p=Array(this.BMAX+1),M,I,D,A=new core.zip_HuftNode,v=Array(this.BMAX);s=Array(this.N_MAX);var q,L=Array(this.BMAX+1),P,T,y;y=this.root=null;for(k=0;k<n.length;k++)n[k]=0;for(k=0;k<p.length;k++)p[k]=0;for(k=0;k<v.length;k++)v[k]=null;for(k=0;k<s.length;k++)s[k]=0;for(k=0;k<L.length;k++)L[k]=0;f=256<c?a[256]:this.BMAX;M=a;I=0;k=c;do n[M[I]]++,I++;
while(0<--k);if(n[0]===c)this.root=null,this.status=this.m=0;else{for(r=1;r<=this.BMAX&&0===n[r];r++);m=r;e<r&&(e=r);for(k=this.BMAX;0!==k&&0===n[k];k--);l=k;e>k&&(e=k);for(P=1<<r;r<k;r++,P<<=1)if(P-=n[r],0>P){this.status=2;this.m=e;return}P-=n[k];if(0>P)this.status=2,this.m=e;else{n[k]+=P;L[1]=r=0;M=n;I=1;for(D=2;0<--k;)r+=M[I++],L[D++]=r;M=a;k=I=0;do r=M[I++],0!==r&&(s[L[r]++]=k);while(++k<c);c=L[l];L[0]=k=0;M=s;I=0;s=-1;q=p[0]=0;D=null;T=0;for(m=m-1+1;m<=l;m++)for(a=n[m];0<a--;){for(;m>q+p[1+s];){q+=
p[1+s];s++;T=l-q;T=T>e?e:T;r=m-q;g=1<<r;if(g>a+1)for(g-=a+1,D=m;++r<T;){g<<=1;if(g<=n[++D])break;g-=n[D]}q+r>f&&q<f&&(r=f-q);T=1<<r;p[1+s]=r;D=Array(T);for(g=0;g<T;g++)D[g]=new core.zip_HuftNode;y=null===y?this.root=new core.zip_HuftList:y.next=new core.zip_HuftList;y.next=null;y.list=D;v[s]=D;0<s&&(L[s]=k,A.b=p[s],A.e=16+r,A.t=D,r=(k&(1<<q)-1)>>q-p[s],v[s-1][r].e=A.e,v[s-1][r].b=A.b,v[s-1][r].n=A.n,v[s-1][r].t=A.t)}A.b=m-q;I>=c?A.e=99:M[I]<b?(A.e=256>M[I]?16:15,A.n=M[I++]):(A.e=d[M[I]-b],A.n=h[M[I++]-
b]);g=1<<m-q;for(r=k>>q;r<T;r+=g)D[r].e=A.e,D[r].b=A.b,D[r].n=A.n,D[r].t=A.t;for(r=1<<m-1;0!==(k&r);r>>=1)k^=r;for(k^=r;(k&(1<<q)-1)!==L[s];)q-=p[s],s--}this.m=p[1];this.status=0!==P&&1!==l?1:0}}}function g(b){for(;a<b;){var h=c,d;d=t.length===E?-1:t[E++];c=h|d<<a;a+=8}}function d(a){return c&A[a]}function b(b){c>>=b;a-=b}function e(a,c,h){var e,f,k;if(0===h)return 0;for(k=0;;){g(u);f=y.list[d(u)];for(e=f.e;16<e;){if(99===e)return-1;b(f.b);e-=16;g(e);f=f.t[d(e)];e=f.e}b(f.b);if(16===e)p&=32767,a[c+
k++]=l[p++]=f.n;else{if(15===e)break;g(e);s=f.n+d(e);b(e);g(x);f=w.list[d(x)];for(e=f.e;16<e;){if(99===e)return-1;b(f.b);e-=16;g(e);f=f.t[d(e)];e=f.e}b(f.b);g(e);v=p-f.n-d(e);for(b(e);0<s&&k<h;)s--,v&=32767,p&=32767,a[c+k++]=l[p++]=l[v++]}if(k===h)return h}n=-1;return k}function k(a,c,h){var n,k,l,s,r,m,p,A=Array(316);for(n=0;n<A.length;n++)A[n]=0;g(5);m=257+d(5);b(5);g(5);p=1+d(5);b(5);g(4);n=4+d(4);b(4);if(286<m||30<p)return-1;for(k=0;k<n;k++)g(3),A[M[k]]=d(3),b(3);for(k=n;19>k;k++)A[M[k]]=0;u=
7;k=new f(A,19,19,null,null,u);if(0!==k.status)return-1;y=k.root;u=k.m;s=m+p;for(n=l=0;n<s;)if(g(u),r=y.list[d(u)],k=r.b,b(k),k=r.n,16>k)A[n++]=l=k;else if(16===k){g(2);k=3+d(2);b(2);if(n+k>s)return-1;for(;0<k--;)A[n++]=l}else{17===k?(g(3),k=3+d(3),b(3)):(g(7),k=11+d(7),b(7));if(n+k>s)return-1;for(;0<k--;)A[n++]=0;l=0}u=9;k=new f(A,m,257,D,L,u);0===u&&(k.status=1);if(0!==k.status)return-1;y=k.root;u=k.m;for(n=0;n<p;n++)A[n]=A[n+m];x=6;k=new f(A,p,0,I,P,x);w=k.root;x=k.m;return 0===x&&257<m||0!==k.status?
-1:e(a,c,h)}var l=[],p,q=null,m,r,c,a,n,h,s,v,y,w,u,x,t,E,A=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],I=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[16,17,18,0,8,7,9,6,
10,5,11,4,12,3,13,2,14,1,15],T;this.inflate=function(A,M){l.length=65536;a=c=p=0;n=-1;h=!1;s=v=0;y=null;t=A;E=0;var V=new Uint8Array(new ArrayBuffer(M));a:for(var F=0,W;F<M&&(!h||-1!==n);){if(0<s){if(0!==n)for(;0<s&&F<M;)s--,v&=32767,p&=32767,V[0+F]=l[p]=l[v],F+=1,p+=1,v+=1;else{for(;0<s&&F<M;)s-=1,p&=32767,g(8),V[0+F]=l[p]=d(8),F+=1,p+=1,b(8);0===s&&(n=-1)}if(F===M)break}if(-1===n){if(h)break;g(1);0!==d(1)&&(h=!0);b(1);g(2);n=d(2);b(2);y=null;s=0}switch(n){case 0:W=V;var ha=0+F,ga=M-F,U=void 0,U=
a&7;b(U);g(16);U=d(16);b(16);g(16);if(U!==(~c&65535))W=-1;else{b(16);s=U;for(U=0;0<s&&U<ga;)s--,p&=32767,g(8),W[ha+U++]=l[p++]=d(8),b(8);0===s&&(n=-1);W=U}break;case 1:if(null!==y)W=e(V,0+F,M-F);else b:{W=V;ha=0+F;ga=M-F;if(null===q){for(var B=void 0,U=Array(288),B=void 0,B=0;144>B;B++)U[B]=8;for(B=144;256>B;B++)U[B]=9;for(B=256;280>B;B++)U[B]=7;for(B=280;288>B;B++)U[B]=8;r=7;B=new f(U,288,257,D,L,r);if(0!==B.status){alert("HufBuild error: "+B.status);W=-1;break b}q=B.root;r=B.m;for(B=0;30>B;B++)U[B]=
5;T=5;B=new f(U,30,0,I,P,T);if(1<B.status){q=null;alert("HufBuild error: "+B.status);W=-1;break b}m=B.root;T=B.m}y=q;w=m;u=r;x=T;W=e(W,ha,ga)}break;case 2:W=null!==y?e(V,0+F,M-F):k(V,0+F,M-F);break;default:W=-1}if(-1===W)break a;F+=W}t=new Uint8Array(new ArrayBuffer(0));return V}};core.ScheduledTask=function(f,g,d){function b(){l&&(d(k),l=!1)}function e(){b();f.apply(void 0,p);p=null}var k,l=!1,p=[],q=!1;this.trigger=function(){runtime.assert(!1===q,"Can't trigger destroyed ScheduledTask instance");p=Array.prototype.slice.call(arguments);l||(l=!0,k=g(e))};this.triggerImmediate=function(){runtime.assert(!1===q,"Can't trigger destroyed ScheduledTask instance");p=Array.prototype.slice.call(arguments);e()};this.processRequests=function(){l&&e()};this.cancel=b;this.destroy=function(d){b();
q=!0;d()}};core.StepDirection={PREVIOUS:1,NEXT:2};core.StepIterator=function(f,g){function d(){r=null;a=c=void 0}function b(){void 0===a&&(a=f.acceptPosition(g)===m);return a}function e(a,c){d();return g.setUnfilteredPosition(a,c)}function k(){r||(r=g.container());return r}function l(){void 0===c&&(c=g.unfilteredDomOffset());return c}function p(){for(d();g.nextPosition();)if(d(),b())return!0;return!1}function q(){for(d();g.previousPosition();)if(d(),b())return!0;return!1}var m=core.PositionFilter.FilterResult.FILTER_ACCEPT,r,c,a;this.isStep=b;this.setPosition=
e;this.container=k;this.offset=l;this.nextStep=p;this.previousStep=q;this.advanceStep=function(a){return a===core.StepDirection.NEXT?p():q()};this.roundToClosestStep=function(){var a=k(),c=l(),d=b();d||(d=q(),d||(e(a,c),d=p()));return d};this.roundToPreviousStep=function(){var a=b();a||(a=q());return a};this.roundToNextStep=function(){var a=b();a||(a=p());return a};this.leftNode=function(){return g.leftNode()}};(function(){var f;core.Task={};core.Task.SUPPRESS_MANUAL_PROCESSING=!1;core.Task.processTasks=function(){core.Task.SUPPRESS_MANUAL_PROCESSING||f.performRedraw()};core.Task.createRedrawTask=function(g){return new core.ScheduledTask(g,f.requestRedrawTask,f.cancelRedrawTask)};core.Task.createTimeoutTask=function(f,d){return new core.ScheduledTask(f,function(b){return runtime.setTimeout(b,d)},runtime.clearTimeout)};f=new function(){var f={};this.requestRedrawTask=function(d){var b=runtime.requestAnimationFrame(function(){d();
delete f[b]});f[b]=d;return b};this.performRedraw=function(){Object.keys(f).forEach(function(d){f[d]();runtime.cancelAnimationFrame(parseInt(d,10))});f={}};this.cancelRedrawTask=function(d){runtime.cancelAnimationFrame(d);delete f[d]}}})();core.UnitTest=function(){};core.UnitTest.prototype.setUp=function(){};core.UnitTest.prototype.tearDown=function(){};core.UnitTest.prototype.description=function(){};core.UnitTest.prototype.tests=function(){};core.UnitTest.prototype.asyncTests=function(){};
core.UnitTest.provideTestAreaDiv=function(){var f=runtime.getWindow().document,g=f.getElementById("testarea");runtime.assert(!g,'Unclean test environment, found a div with id "testarea".');g=f.createElement("div");g.setAttribute("id","testarea");f.body.appendChild(g);return g};
core.UnitTest.cleanupTestAreaDiv=function(){var f=runtime.getWindow().document,g=f.getElementById("testarea");runtime.assert(!!g&&g.parentNode===f.body,'Test environment broken, found no div with id "testarea" below body.');f.body.removeChild(g)};core.UnitTest.createXmlDocument=function(f,g,d){var b="<?xml version='1.0' encoding='UTF-8'?>",b=b+("<"+f);Object.keys(d).forEach(function(e){b+=" xmlns:"+e+'="'+d[e]+'"'});b+=">";b+=g;b+="</"+f+">";return runtime.parseXML(b)};
core.UnitTest.createOdtDocument=function(f,g){return core.UnitTest.createXmlDocument("office:document",f,g)};
core.UnitTestLogger=function(){var f=[],g=0,d=0,b="",e="";this.startTest=function(k,l){f=[];g=0;b=k;e=l;d=Date.now()};this.endTest=function(){var k=Date.now();return{description:e,suite:[b,e],success:0===g,log:f,time:k-d}};this.debug=function(b){f.push({category:"debug",message:b})};this.fail=function(b){g+=1;f.push({category:"fail",message:b})};this.pass=function(b){f.push({category:"pass",message:b})}};
core.UnitTestRunner=function(f,g){function d(a){q+=1;c?g.debug(a):g.fail(a)}function b(a,c){var b;try{if(a.length!==c.length)return d("array of length "+a.length+" should be "+c.length+" long"),!1;for(b=0;b<a.length;b+=1)if(a[b]!==c[b])return d(a[b]+" should be "+c[b]+" at array index "+b),!1}catch(e){return!1}return!0}function e(a,c,b){var f=a.attributes,g=f.length,k,l,r;for(k=0;k<g;k+=1)if(l=f.item(k),"xmlns"!==l.prefix&&"urn:webodf:names:steps"!==l.namespaceURI){r=c.getAttributeNS(l.namespaceURI,
l.localName);if(!c.hasAttributeNS(l.namespaceURI,l.localName))return d("Attribute "+l.localName+" with value "+l.value+" was not present"),!1;if(r!==l.value)return d("Attribute "+l.localName+" was "+r+" should be "+l.value),!1}return b?!0:e(c,a,!0)}function k(a,c){var b,f;b=a.nodeType;f=c.nodeType;if(b!==f)return d("Nodetype '"+b+"' should be '"+f+"'"),!1;if(b===Node.TEXT_NODE){if(a.data===c.data)return!0;d("Textnode data '"+a.data+"' should be '"+c.data+"'");return!1}runtime.assert(b===Node.ELEMENT_NODE,
"Only textnodes and elements supported.");if(a.namespaceURI!==c.namespaceURI)return d("namespace '"+a.namespaceURI+"' should be '"+c.namespaceURI+"'"),!1;if(a.localName!==c.localName)return d("localName '"+a.localName+"' should be '"+c.localName+"'"),!1;if(!e(a,c,!1))return!1;b=a.firstChild;for(f=c.firstChild;b;){if(!f)return d("Nodetype '"+b.nodeType+"' is unexpected here."),!1;if(!k(b,f))return!1;b=b.nextSibling;f=f.nextSibling}return f?(d("Nodetype '"+f.nodeType+"' is missing here."),!1):!0}function l(a,
c,d){if(0===c)return a===c&&1/a===1/c;if(a===c)return!0;if(null===a||null===c)return!1;if("number"===typeof c&&isNaN(c))return"number"===typeof a&&isNaN(a);if("number"===typeof c&&"number"===typeof a){if(a===c)return!0;void 0===d&&(d=1E-4);runtime.assert("number"===typeof d,"Absolute tolerance not given as number.");runtime.assert(0<=d,"Absolute tolerance should be given as positive number, was "+d);a=Math.abs(a-c);return a<=d}return Object.prototype.toString.call(c)===Object.prototype.toString.call([])?
b(a,c):"object"===typeof c&&"object"===typeof a?c.constructor===Element||c.constructor===Node?k(a,c):r(a,c):!1}function p(a,c,b,e){"string"===typeof c&&"string"===typeof b||g.debug("WARN: shouldBe() expects string arguments");var f,k;try{k=eval(c)}catch(r){f=r}a=eval(b);f?d(c+" should be "+a+". Threw exception "+f):l(k,a,e)?g.pass(c+" is "+b):String(typeof k)===String(typeof a)?(b=0===k&&0>1/k?"-0":String(k),d(c+" should be "+a+". Was "+b+".")):d(c+" should be "+a+" (of type "+typeof a+"). Was "+
k+" (of type "+typeof k+").")}var q=0,m,r,c=!1;this.resourcePrefix=function(){return f};this.beginExpectFail=function(){m=q;c=!0};this.endExpectFail=function(){var a=m===q;c=!1;q=m;a&&(q+=1,g.fail("Expected at least one failed test, but none registered."))};r=function(a,c){var h=Object.keys(a),e=Object.keys(c);h.sort();e.sort();return b(h,e)&&Object.keys(a).every(function(b){var h=a[b],e=c[b];return l(h,e)?!0:(d(h+" should be "+e+" for key "+b),!1)})};this.areNodesEqual=k;this.shouldBeNull=function(a,
c){p(a,c,"null")};this.shouldBeNonNull=function(a,c){var b,e;try{e=eval(c)}catch(f){b=f}b?d(c+" should be non-null. Threw exception "+b):null!==e?g.pass(c+" is non-null."):d(c+" should be non-null. Was "+e)};this.shouldBe=p;this.testFailed=d;this.countFailedTests=function(){return q};this.name=function(a){var c,b,d=[],e=a.length;d.length=e;for(c=0;c<e;c+=1){b=Runtime.getFunctionName(a[c])||"";if(""===b)throw"Found a function without a name.";d[c]={f:a[c],name:b}}return d}};
core.UnitTester=function(){function f(b,d){return"<span style='color:blue;cursor:pointer' onclick='"+d+"'>"+b+"</span>"}function g(b){d.reporter&&d.reporter(b)}var d=this,b=0,e=new core.UnitTestLogger,k={},l="BrowserRuntime"===runtime.type();this.resourcePrefix="";this.reporter=function(b){var d,e;l?runtime.log("<span>Running "+f(b.description,'runTest("'+b.suite[0]+'","'+b.description+'")')+"</span>"):runtime.log("Running "+b.description);if(!b.success)for(d=0;d<b.log.length;d+=1)e=b.log[d],runtime.log(e.category,
e.message)};this.runTests=function(p,q,m){function r(d){function f(){s&&a.endExpectFail();g(e.endTest());n.tearDown();h[l]=u===a.countFailedTests();r(d.slice(1))}var l,s;if(0===d.length)k[c]=h,b+=a.countFailedTests(),q();else if(v=d[0].f,l=d[0].name,s=!0===d[0].expectFail,u=a.countFailedTests(),m.length&&-1===m.indexOf(l))r(d.slice(1));else{n.setUp();e.startTest(c,l);s&&a.beginExpectFail();try{v(f)}catch(p){a.testFailed("Unexpected exception encountered: "+p.toString()+"\n"+p.stack),f()}}}var c=Runtime.getFunctionName(p)||
"",a=new core.UnitTestRunner(d.resourcePrefix,e),n=new p(a),h={},s,v,y,w,u;if(k.hasOwnProperty(c))runtime.log("Test "+c+" has already run.");else{l?runtime.log("<span>Running "+f(c,'runSuite("'+c+'");')+": "+n.description()+"</span>"):runtime.log("Running "+c+": "+n.description);y=n.tests();for(s=0;s<y.length;s+=1)if(v=y[s].f,p=y[s].name,w=!0===y[s].expectFail,!m.length||-1!==m.indexOf(p)){u=a.countFailedTests();n.setUp();e.startTest(c,p);w&&a.beginExpectFail();try{v()}catch(x){a.testFailed("Unexpected exception encountered: "+
x.toString()+"\n"+x.stack)}w&&a.endExpectFail();g(e.endTest());n.tearDown();h[p]=u===a.countFailedTests()}r(n.asyncTests())}};this.failedTestsCount=function(){return b};this.results=function(){return k}};core.Utils=function(){function f(g,d){if(d&&Array.isArray(d)){g=g||[];if(!Array.isArray(g))throw"Destination is not an array.";g=g.concat(d.map(function(b){return f(null,b)}))}else if(d&&"object"===typeof d){g=g||{};if("object"!==typeof g)throw"Destination is not an object.";Object.keys(d).forEach(function(b){g[b]=f(g[b],d[b])})}else g=d;return g}this.hashString=function(f){var d=0,b,e;b=0;for(e=f.length;b<e;b+=1)d=(d<<5)-d+f.charCodeAt(b),d|=0;return d};this.mergeObjects=function(g,d){Object.keys(d).forEach(function(b){g[b]=
f(g[b],d[b])});return g}};core.Zip=function(f,g){function d(a){var c=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,
853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,
4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,
225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,
2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,
2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],b,d,h=a.length,e=0,e=0;b=-1;for(d=0;d<h;d+=1)e=(b^a[d])&255,e=c[e],b=b>>>8^e;return b^-1}function b(a){return new Date((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&15,a>>5&63,(a&31)<<1)}function e(a){var c=a.getFullYear();return 1980>c?0:c-1980<<
25|a.getMonth()+1<<21|a.getDate()<<16|a.getHours()<<11|a.getMinutes()<<5|a.getSeconds()>>1}function k(a,c){var d,e,f,n,k,g,l,r=this;this.load=function(c){if(null!==r.data)c(null,r.data);else{var b=k+34+e+f+256;b+l>h&&(b=h-l);runtime.read(a,l,b,function(b,d){if(b||null===d)c(b,d);else a:{var h=d,e=new core.ByteArray(h),f=e.readUInt32LE(),l;if(67324752!==f)c("File entry signature is wrong."+f.toString()+" "+h.length.toString(),null);else{e.pos+=22;f=e.readUInt16LE();l=e.readUInt16LE();e.pos+=f+l;if(n){h=
h.subarray(e.pos,e.pos+k);if(k!==h.length){c("The amount of compressed bytes read was "+h.length.toString()+" instead of "+k.toString()+" for "+r.filename+" in "+a+".",null);break a}h=v(h,g)}else h=h.subarray(e.pos,e.pos+g);g!==h.length?c("The amount of bytes read was "+h.length.toString()+" instead of "+g.toString()+" for "+r.filename+" in "+a+".",null):(r.data=h,c(null,h))}}})}};this.set=function(a,c,b,d){r.filename=a;r.data=c;r.compressed=b;r.date=d};this.error=null;c&&(d=c.readUInt32LE(),33639248!==
d?this.error="Central directory entry has wrong signature at position "+(c.pos-4).toString()+' for file "'+a+'": '+c.data.length.toString():(c.pos+=6,n=c.readUInt16LE(),this.date=b(c.readUInt32LE()),c.readUInt32LE(),k=c.readUInt32LE(),g=c.readUInt32LE(),e=c.readUInt16LE(),f=c.readUInt16LE(),d=c.readUInt16LE(),c.pos+=8,l=c.readUInt32LE(),this.filename=runtime.byteArrayToString(c.data.subarray(c.pos,c.pos+e),"utf8"),this.data=null,c.pos+=e+f+d))}function l(a,c){if(22!==a.length)c("Central directory length should be 22.",
y);else{var b=new core.ByteArray(a),d;d=b.readUInt32LE();101010256!==d?c("Central directory signature is wrong: "+d.toString(),y):(d=b.readUInt16LE(),0!==d?c("Zip files with non-zero disk numbers are not supported.",y):(d=b.readUInt16LE(),0!==d?c("Zip files with non-zero disk numbers are not supported.",y):(d=b.readUInt16LE(),s=b.readUInt16LE(),d!==s?c("Number of entries is inconsistent.",y):(d=b.readUInt32LE(),b=b.readUInt16LE(),b=h-22-d,runtime.read(f,b,h-b,function(a,b){if(a||null===b)c(a,y);else a:{var d=
new core.ByteArray(b),h,e;n=[];for(h=0;h<s;h+=1){e=new k(f,d);if(e.error){c(e.error,y);break a}n[n.length]=e}c(null,y)}})))))}}function p(a,c){var b=null,d,h;for(h=0;h<n.length;h+=1)if(d=n[h],d.filename===a){b=d;break}b?b.data?c(null,b.data):b.load(c):c(a+" not found.",null)}function q(a){var c=new core.ByteArrayWriter("utf8"),b=0;c.appendArray([80,75,3,4,20,0,0,0,0,0]);a.data&&(b=a.data.length);c.appendUInt32LE(e(a.date));c.appendUInt32LE(a.data?d(a.data):0);c.appendUInt32LE(b);c.appendUInt32LE(b);
c.appendUInt16LE(a.filename.length);c.appendUInt16LE(0);c.appendString(a.filename);a.data&&c.appendByteArray(a.data);return c}function m(a,c){var b=new core.ByteArrayWriter("utf8"),h=0;b.appendArray([80,75,1,2,20,0,20,0,0,0,0,0]);a.data&&(h=a.data.length);b.appendUInt32LE(e(a.date));b.appendUInt32LE(a.data?d(a.data):0);b.appendUInt32LE(h);b.appendUInt32LE(h);b.appendUInt16LE(a.filename.length);b.appendArray([0,0,0,0,0,0,0,0,0,0,0,0]);b.appendUInt32LE(c);b.appendString(a.filename);return b}function r(a,
c){if(a===n.length)c(null);else{var b=n[a];null!==b.data?r(a+1,c):b.load(function(b){b?c(b):r(a+1,c)})}}function c(a,c){r(0,function(b){if(b)c(b);else{var d,h,e=new core.ByteArrayWriter("utf8"),f=[0];for(d=0;d<n.length;d+=1)e.appendByteArrayWriter(q(n[d])),f.push(e.getLength());b=e.getLength();for(d=0;d<n.length;d+=1)h=n[d],e.appendByteArrayWriter(m(h,f[d]));d=e.getLength()-b;e.appendArray([80,75,5,6,0,0,0,0]);e.appendUInt16LE(n.length);e.appendUInt16LE(n.length);e.appendUInt32LE(d);e.appendUInt32LE(b);
e.appendArray([0,0]);a(e.getByteArray())}})}function a(a,b){c(function(c){runtime.writeFile(a,c,b)},b)}var n,h,s,v=(new core.RawInflate).inflate,y=this,w=new core.Base64;this.load=p;this.save=function(a,c,b,d){var h,e;for(h=0;h<n.length;h+=1)if(e=n[h],e.filename===a){e.set(a,c,b,d);return}e=new k(f);e.set(a,c,b,d);n.push(e)};this.remove=function(a){var c,b;for(c=0;c<n.length;c+=1)if(b=n[c],b.filename===a)return n.splice(c,1),!0;return!1};this.write=function(c){a(f,c)};this.writeAs=a;this.createByteArray=
c;this.loadContentXmlAsFragments=function(a,c){y.loadAsString(a,function(a,b){if(a)return c.rootElementReady(a);c.rootElementReady(null,b,!0)})};this.loadAsString=function(a,c){p(a,function(a,b){if(a||null===b)return c(a,null);var d=runtime.byteArrayToString(b,"utf8");c(null,d)})};this.loadAsDOM=function(a,c){y.loadAsString(a,function(a,b){if(a||null===b)c(a,null);else{var d=(new DOMParser).parseFromString(b,"text/xml");c(null,d)}})};this.loadAsDataURL=function(a,c,b){p(a,function(a,d){if(a||!d)return b(a,
null);var h=0,e;c||(c=80===d[1]&&78===d[2]&&71===d[3]?"image/png":255===d[0]&&216===d[1]&&255===d[2]?"image/jpeg":71===d[0]&&73===d[1]&&70===d[2]?"image/gif":"");for(e="data:"+c+";base64,";h<d.length;)e+=w.convertUTF8ArrayToBase64(d.subarray(h,Math.min(h+45E3,d.length))),h+=45E3;b(null,e)})};this.getEntries=function(){return n.slice()};h=-1;null===g?n=[]:runtime.getFileSize(f,function(a){h=a;0>h?g("File '"+f+"' cannot be read.",y):runtime.read(f,h-22,22,function(a,c){a||null===g||null===c?g(a,y):
l(c,g)})})};gui.CommonConstraints={EDIT:{ANNOTATIONS:{ONLY_DELETE_OWN:"onlyDeleteOwn"},REVIEW_MODE:"reviewMode"}};gui.SessionConstraints=function(){function f(b){g.hasOwnProperty(b)||(g[b]=!1,d.register(b))}var g={},d=new core.EventNotifier;this.registerConstraint=f;this.subscribe=function(b,e){f(b);d.subscribe(b,e)};this.unsubscribe=function(b,e){d.unsubscribe(b,e)};this.setState=function(b,e){runtime.assert(!0===g.hasOwnProperty(b),"No such constraint");g[b]!==e&&(g[b]=e,d.emit(b,e))};this.getState=function(b){runtime.assert(!0===g.hasOwnProperty(b),"No such constraint");return g[b]}};xmldom.LSSerializerFilter=function(){};xmldom.LSSerializerFilter.prototype.acceptNode=function(f){};odf.OdfNodeFilter=function(){this.acceptNode=function(f){return"http://www.w3.org/1999/xhtml"===f.namespaceURI?NodeFilter.FILTER_SKIP:f.namespaceURI&&f.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}};odf.Namespaces={namespaceMap:{db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",meta:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",number:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",
office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},prefixMap:{},dbns:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",
dcns:"http://purl.org/dc/elements/1.1/",dr3dns:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",drawns:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chartns:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fons:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",formns:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",metans:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",officens:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
presentationns:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",stylens:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svgns:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",tablens:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",textns:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/XML/1998/namespace"};
(function(){var f=odf.Namespaces.namespaceMap,g=odf.Namespaces.prefixMap,d;for(d in f)f.hasOwnProperty(d)&&(g[f[d]]=d)})();odf.Namespaces.forEachPrefix=function(f){var g=odf.Namespaces.namespaceMap,d;for(d in g)g.hasOwnProperty(d)&&f(d,g[d])};odf.Namespaces.lookupNamespaceURI=function(f){var g=null;odf.Namespaces.namespaceMap.hasOwnProperty(f)&&(g=odf.Namespaces.namespaceMap[f]);return g};odf.Namespaces.lookupPrefix=function(f){var g=odf.Namespaces.prefixMap;return g.hasOwnProperty(f)?g[f]:null};
odf.Namespaces.lookupNamespaceURI.lookupNamespaceURI=odf.Namespaces.lookupNamespaceURI;xmldom.XPathIterator=function(){};xmldom.XPathIterator.prototype.next=function(){};xmldom.XPathIterator.prototype.reset=function(){};
function createXPathSingleton(){function f(b,c,a){return-1!==b&&(b<c||-1===c)&&(b<a||-1===a)}function g(b){for(var c=[],a=0,d=b.length,h;a<d;){var e=b,k=d,g=c,l="",p=[],q=e.indexOf("[",a),t=e.indexOf("/",a),E=e.indexOf("=",a);f(t,q,E)?(l=e.substring(a,t),a=t+1):f(q,t,E)?(l=e.substring(a,q),a=m(e,q,p)):f(E,t,q)?(l=e.substring(a,E),a=E):(l=e.substring(a,k),a=k);g.push({location:l,predicates:p});if(a<d&&"="===b[a]){h=b.substring(a+1,d);if(2<h.length&&("'"===h[0]||'"'===h[0]))h=h.slice(1,h.length-1);
else try{h=parseInt(h,10)}catch(A){}a=d}}return{steps:c,value:h}}function d(){var b=null,c=!1;this.setNode=function(a){b=a};this.reset=function(){c=!1};this.next=function(){var a=c?null:b;c=!0;return a}}function b(b,c,a){this.reset=function(){b.reset()};this.next=function(){for(var d=b.next();d;){d.nodeType===Node.ELEMENT_NODE&&(d=d.getAttributeNodeNS(c,a));if(d)break;d=b.next()}return d}}function e(b,c){var a=b.next(),d=null;this.reset=function(){b.reset();a=b.next();d=null};this.next=function(){for(;a;){if(d)if(c&&
d.firstChild)d=d.firstChild;else{for(;!d.nextSibling&&d!==a;)d=d.parentNode;d===a?a=b.next():d=d.nextSibling}else{do(d=a.firstChild)||(a=b.next());while(a&&!d)}if(d&&d.nodeType===Node.ELEMENT_NODE)return d}return null}}function k(b,c){this.reset=function(){b.reset()};this.next=function(){for(var a=b.next();a&&!c(a);)a=b.next();return a}}function l(b,c,a){c=c.split(":",2);var d=a(c[0]),h=c[1];return new k(b,function(a){return a.localName===h&&a.namespaceURI===d})}function p(b,c,a){var e=new d,h=q(e,
c,a),f=c.value;return void 0===f?new k(b,function(a){e.setNode(a);h.reset();return null!==h.next()}):new k(b,function(a){e.setNode(a);h.reset();return(a=h.next())?a.nodeValue===f:!1})}var q,m;m=function(b,c,a){for(var d=c,h=b.length,e=0;d<h;)"]"===b[d]?(e-=1,0>=e&&a.push(g(b.substring(c,d)))):"["===b[d]&&(0>=e&&(c=d+1),e+=1),d+=1;return d};q=function(d,c,a){var f,h,k,g;for(f=0;f<c.steps.length;f+=1){k=c.steps[f];h=k.location;if(""===h)d=new e(d,!1);else if("@"===h[0]){h=h.substr(1).split(":",2);g=
a(h[0]);if(!g)throw"No namespace associated with the prefix "+h[0];d=new b(d,g,h[1])}else"."!==h&&(d=new e(d,!1),-1!==h.indexOf(":")&&(d=l(d,h,a)));for(h=0;h<k.predicates.length;h+=1)g=k.predicates[h],d=p(d,g,a)}return d};return{getODFElementsWithXPath:function(b,c,a){var e=b.ownerDocument,h=[],f=null;if(e&&"function"===typeof e.evaluate)for(a=e.evaluate(c,b,a,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),f=a.iterateNext();null!==f;)f.nodeType===Node.ELEMENT_NODE&&h.push(f),f=a.iterateNext();else{h=
new d;h.setNode(b);b=g(c);h=q(h,b,a);b=[];for(a=h.next();a;)b.push(a),a=h.next();h=b}return h}}}xmldom.XPath=createXPathSingleton();odf.StyleInfo=function(){function f(a,c){var b,d,h,e,k,n=0;if(b=D[a.localName])if(h=b[a.namespaceURI])n=h.length;for(b=0;b<n;b+=1)d=h[b],e=d.ns,k=d.localname,(d=a.getAttributeNS(e,k))&&a.setAttributeNS(e,E[e]+k,c+d);for(h=a.firstElementChild;h;)f(h,c),h=h.nextElementSibling}function g(a,c){var b,d,h,e,f,k=0;if(b=D[a.localName])if(h=b[a.namespaceURI])k=h.length;for(b=0;b<k;b+=1)if(d=h[b],e=d.ns,f=d.localname,d=a.getAttributeNS(e,f))d=d.replace(c,""),a.setAttributeNS(e,E[e]+f,d);for(h=a.firstElementChild;h;)g(h,
c),h=h.nextElementSibling}function d(a,c){var b,d,h,e,f,k=0;if(b=D[a.localName])if(h=b[a.namespaceURI])k=h.length;for(b=0;b<k;b+=1)if(e=h[b],d=e.ns,f=e.localname,d=a.getAttributeNS(d,f))c=c||{},e=e.keyname,c.hasOwnProperty(e)?c[e][d]=1:(f={},f[d]=1,c[e]=f);return c}function b(a,c){var h,e;d(a,c);for(h=a.firstChild;h;)h.nodeType===Node.ELEMENT_NODE&&(e=h,b(e,c)),h=h.nextSibling}function e(a,c,b){this.key=a;this.name=c;this.family=b;this.requires={}}function k(a,c,b){var d=a+'"'+c,h=b[d];h||(h=b[d]=
new e(d,a,c));return h}function l(a,c,b){var d,h,e,f,n,g=0;d=a.getAttributeNS(u,"name");f=a.getAttributeNS(u,"family");d&&f&&(c=k(d,f,b));if(c){if(d=D[a.localName])if(e=d[a.namespaceURI])g=e.length;for(d=0;d<g;d+=1)if(f=e[d],h=f.ns,n=f.localname,h=a.getAttributeNS(h,n))f=f.keyname,f=k(h,f,b),c.requires[f.key]=f}for(a=a.firstElementChild;a;)l(a,c,b),a=a.nextElementSibling;return b}function p(a,c){var b=c[a.family];b||(b=c[a.family]={});b[a.name]=1;Object.keys(a.requires).forEach(function(b){p(a.requires[b],
c)})}function q(a,c){var b=l(a,null,{});Object.keys(b).forEach(function(a){a=b[a];var d=c[a.family];d&&d.hasOwnProperty(a.name)&&p(a,c)})}function m(a,c){function b(c){(c=e.getAttributeNS(u,c))&&(a[c]=!0)}var d=["font-name","font-name-asian","font-name-complex"],h,e;for(h=c&&c.firstElementChild;h;)e=h,d.forEach(b),m(a,e),h=h.nextElementSibling}function r(a,c){function b(a){var d=e.getAttributeNS(u,a);d&&c.hasOwnProperty(d)&&e.setAttributeNS(u,"style:"+a,c[d])}var d=["font-name","font-name-asian",
"font-name-complex"],h,e;for(h=a&&a.firstElementChild;h;)e=h,d.forEach(b),r(e,c),h=h.nextElementSibling}var c=odf.Namespaces.chartns,a=odf.Namespaces.dbns,n=odf.Namespaces.dr3dns,h=odf.Namespaces.drawns,s=odf.Namespaces.formns,v=odf.Namespaces.numberns,y=odf.Namespaces.officens,w=odf.Namespaces.presentationns,u=odf.Namespaces.stylens,x=odf.Namespaces.tablens,t=odf.Namespaces.textns,E={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:",
"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:",
"urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},A={text:[{ens:u,en:"tab-stop",ans:u,a:"leader-text-style"},{ens:u,en:"drop-cap",ans:u,a:"style-name"},{ens:t,en:"notes-configuration",ans:t,a:"citation-body-style-name"},{ens:t,en:"notes-configuration",ans:t,a:"citation-style-name"},{ens:t,en:"a",ans:t,a:"style-name"},{ens:t,en:"alphabetical-index",ans:t,a:"style-name"},{ens:t,en:"linenumbering-configuration",
ans:t,a:"style-name"},{ens:t,en:"list-level-style-number",ans:t,a:"style-name"},{ens:t,en:"ruby-text",ans:t,a:"style-name"},{ens:t,en:"span",ans:t,a:"style-name"},{ens:t,en:"a",ans:t,a:"visited-style-name"},{ens:u,en:"text-properties",ans:u,a:"text-line-through-text-style"},{ens:t,en:"alphabetical-index-source",ans:t,a:"main-entry-style-name"},{ens:t,en:"index-entry-bibliography",ans:t,a:"style-name"},{ens:t,en:"index-entry-chapter",ans:t,a:"style-name"},{ens:t,en:"index-entry-link-end",ans:t,a:"style-name"},
{ens:t,en:"index-entry-link-start",ans:t,a:"style-name"},{ens:t,en:"index-entry-page-number",ans:t,a:"style-name"},{ens:t,en:"index-entry-span",ans:t,a:"style-name"},{ens:t,en:"index-entry-tab-stop",ans:t,a:"style-name"},{ens:t,en:"index-entry-text",ans:t,a:"style-name"},{ens:t,en:"index-title-template",ans:t,a:"style-name"},{ens:t,en:"list-level-style-bullet",ans:t,a:"style-name"},{ens:t,en:"outline-level-style",ans:t,a:"style-name"}],paragraph:[{ens:h,en:"caption",ans:h,a:"text-style-name"},{ens:h,
en:"circle",ans:h,a:"text-style-name"},{ens:h,en:"connector",ans:h,a:"text-style-name"},{ens:h,en:"control",ans:h,a:"text-style-name"},{ens:h,en:"custom-shape",ans:h,a:"text-style-name"},{ens:h,en:"ellipse",ans:h,a:"text-style-name"},{ens:h,en:"frame",ans:h,a:"text-style-name"},{ens:h,en:"line",ans:h,a:"text-style-name"},{ens:h,en:"measure",ans:h,a:"text-style-name"},{ens:h,en:"path",ans:h,a:"text-style-name"},{ens:h,en:"polygon",ans:h,a:"text-style-name"},{ens:h,en:"polyline",ans:h,a:"text-style-name"},
{ens:h,en:"rect",ans:h,a:"text-style-name"},{ens:h,en:"regular-polygon",ans:h,a:"text-style-name"},{ens:y,en:"annotation",ans:h,a:"text-style-name"},{ens:s,en:"column",ans:s,a:"text-style-name"},{ens:u,en:"style",ans:u,a:"next-style-name"},{ens:x,en:"body",ans:x,a:"paragraph-style-name"},{ens:x,en:"even-columns",ans:x,a:"paragraph-style-name"},{ens:x,en:"even-rows",ans:x,a:"paragraph-style-name"},{ens:x,en:"first-column",ans:x,a:"paragraph-style-name"},{ens:x,en:"first-row",ans:x,a:"paragraph-style-name"},
{ens:x,en:"last-column",ans:x,a:"paragraph-style-name"},{ens:x,en:"last-row",ans:x,a:"paragraph-style-name"},{ens:x,en:"odd-columns",ans:x,a:"paragraph-style-name"},{ens:x,en:"odd-rows",ans:x,a:"paragraph-style-name"},{ens:t,en:"notes-configuration",ans:t,a:"default-style-name"},{ens:t,en:"alphabetical-index-entry-template",ans:t,a:"style-name"},{ens:t,en:"bibliography-entry-template",ans:t,a:"style-name"},{ens:t,en:"h",ans:t,a:"style-name"},{ens:t,en:"illustration-index-entry-template",ans:t,a:"style-name"},
{ens:t,en:"index-source-style",ans:t,a:"style-name"},{ens:t,en:"object-index-entry-template",ans:t,a:"style-name"},{ens:t,en:"p",ans:t,a:"style-name"},{ens:t,en:"table-index-entry-template",ans:t,a:"style-name"},{ens:t,en:"table-of-content-entry-template",ans:t,a:"style-name"},{ens:t,en:"table-index-entry-template",ans:t,a:"style-name"},{ens:t,en:"user-index-entry-template",ans:t,a:"style-name"},{ens:u,en:"page-layout-properties",ans:u,a:"register-truth-ref-style-name"}],chart:[{ens:c,en:"axis",ans:c,
a:"style-name"},{ens:c,en:"chart",ans:c,a:"style-name"},{ens:c,en:"data-label",ans:c,a:"style-name"},{ens:c,en:"data-point",ans:c,a:"style-name"},{ens:c,en:"equation",ans:c,a:"style-name"},{ens:c,en:"error-indicator",ans:c,a:"style-name"},{ens:c,en:"floor",ans:c,a:"style-name"},{ens:c,en:"footer",ans:c,a:"style-name"},{ens:c,en:"grid",ans:c,a:"style-name"},{ens:c,en:"legend",ans:c,a:"style-name"},{ens:c,en:"mean-value",ans:c,a:"style-name"},{ens:c,en:"plot-area",ans:c,a:"style-name"},{ens:c,en:"regression-curve",
ans:c,a:"style-name"},{ens:c,en:"series",ans:c,a:"style-name"},{ens:c,en:"stock-gain-marker",ans:c,a:"style-name"},{ens:c,en:"stock-loss-marker",ans:c,a:"style-name"},{ens:c,en:"stock-range-line",ans:c,a:"style-name"},{ens:c,en:"subtitle",ans:c,a:"style-name"},{ens:c,en:"title",ans:c,a:"style-name"},{ens:c,en:"wall",ans:c,a:"style-name"}],section:[{ens:t,en:"alphabetical-index",ans:t,a:"style-name"},{ens:t,en:"bibliography",ans:t,a:"style-name"},{ens:t,en:"illustration-index",ans:t,a:"style-name"},
{ens:t,en:"index-title",ans:t,a:"style-name"},{ens:t,en:"object-index",ans:t,a:"style-name"},{ens:t,en:"section",ans:t,a:"style-name"},{ens:t,en:"table-of-content",ans:t,a:"style-name"},{ens:t,en:"table-index",ans:t,a:"style-name"},{ens:t,en:"user-index",ans:t,a:"style-name"}],ruby:[{ens:t,en:"ruby",ans:t,a:"style-name"}],table:[{ens:a,en:"query",ans:a,a:"style-name"},{ens:a,en:"table-representation",ans:a,a:"style-name"},{ens:x,en:"background",ans:x,a:"style-name"},{ens:x,en:"table",ans:x,a:"style-name"}],
"table-column":[{ens:a,en:"column",ans:a,a:"style-name"},{ens:x,en:"table-column",ans:x,a:"style-name"}],"table-row":[{ens:a,en:"query",ans:a,a:"default-row-style-name"},{ens:a,en:"table-representation",ans:a,a:"default-row-style-name"},{ens:x,en:"table-row",ans:x,a:"style-name"}],"table-cell":[{ens:a,en:"column",ans:a,a:"default-cell-style-name"},{ens:x,en:"table-column",ans:x,a:"default-cell-style-name"},{ens:x,en:"table-row",ans:x,a:"default-cell-style-name"},{ens:x,en:"body",ans:x,a:"style-name"},
{ens:x,en:"covered-table-cell",ans:x,a:"style-name"},{ens:x,en:"even-columns",ans:x,a:"style-name"},{ens:x,en:"covered-table-cell",ans:x,a:"style-name"},{ens:x,en:"even-columns",ans:x,a:"style-name"},{ens:x,en:"even-rows",ans:x,a:"style-name"},{ens:x,en:"first-column",ans:x,a:"style-name"},{ens:x,en:"first-row",ans:x,a:"style-name"},{ens:x,en:"last-column",ans:x,a:"style-name"},{ens:x,en:"last-row",ans:x,a:"style-name"},{ens:x,en:"odd-columns",ans:x,a:"style-name"},{ens:x,en:"odd-rows",ans:x,a:"style-name"},
{ens:x,en:"table-cell",ans:x,a:"style-name"}],graphic:[{ens:n,en:"cube",ans:h,a:"style-name"},{ens:n,en:"extrude",ans:h,a:"style-name"},{ens:n,en:"rotate",ans:h,a:"style-name"},{ens:n,en:"scene",ans:h,a:"style-name"},{ens:n,en:"sphere",ans:h,a:"style-name"},{ens:h,en:"caption",ans:h,a:"style-name"},{ens:h,en:"circle",ans:h,a:"style-name"},{ens:h,en:"connector",ans:h,a:"style-name"},{ens:h,en:"control",ans:h,a:"style-name"},{ens:h,en:"custom-shape",ans:h,a:"style-name"},{ens:h,en:"ellipse",ans:h,a:"style-name"},
{ens:h,en:"frame",ans:h,a:"style-name"},{ens:h,en:"g",ans:h,a:"style-name"},{ens:h,en:"line",ans:h,a:"style-name"},{ens:h,en:"measure",ans:h,a:"style-name"},{ens:h,en:"page-thumbnail",ans:h,a:"style-name"},{ens:h,en:"path",ans:h,a:"style-name"},{ens:h,en:"polygon",ans:h,a:"style-name"},{ens:h,en:"polyline",ans:h,a:"style-name"},{ens:h,en:"rect",ans:h,a:"style-name"},{ens:h,en:"regular-polygon",ans:h,a:"style-name"},{ens:y,en:"annotation",ans:h,a:"style-name"}],presentation:[{ens:n,en:"cube",ans:w,
a:"style-name"},{ens:n,en:"extrude",ans:w,a:"style-name"},{ens:n,en:"rotate",ans:w,a:"style-name"},{ens:n,en:"scene",ans:w,a:"style-name"},{ens:n,en:"sphere",ans:w,a:"style-name"},{ens:h,en:"caption",ans:w,a:"style-name"},{ens:h,en:"circle",ans:w,a:"style-name"},{ens:h,en:"connector",ans:w,a:"style-name"},{ens:h,en:"control",ans:w,a:"style-name"},{ens:h,en:"custom-shape",ans:w,a:"style-name"},{ens:h,en:"ellipse",ans:w,a:"style-name"},{ens:h,en:"frame",ans:w,a:"style-name"},{ens:h,en:"g",ans:w,a:"style-name"},
{ens:h,en:"line",ans:w,a:"style-name"},{ens:h,en:"measure",ans:w,a:"style-name"},{ens:h,en:"page-thumbnail",ans:w,a:"style-name"},{ens:h,en:"path",ans:w,a:"style-name"},{ens:h,en:"polygon",ans:w,a:"style-name"},{ens:h,en:"polyline",ans:w,a:"style-name"},{ens:h,en:"rect",ans:w,a:"style-name"},{ens:h,en:"regular-polygon",ans:w,a:"style-name"},{ens:y,en:"annotation",ans:w,a:"style-name"}],"drawing-page":[{ens:h,en:"page",ans:h,a:"style-name"},{ens:w,en:"notes",ans:h,a:"style-name"},{ens:u,en:"handout-master",
ans:h,a:"style-name"},{ens:u,en:"master-page",ans:h,a:"style-name"}],"list-style":[{ens:t,en:"list",ans:t,a:"style-name"},{ens:t,en:"numbered-paragraph",ans:t,a:"style-name"},{ens:t,en:"list-item",ans:t,a:"style-override"},{ens:u,en:"style",ans:u,a:"list-style-name"}],data:[{ens:u,en:"style",ans:u,a:"data-style-name"},{ens:u,en:"style",ans:u,a:"percentage-data-style-name"},{ens:w,en:"date-time-decl",ans:u,a:"data-style-name"},{ens:t,en:"creation-date",ans:u,a:"data-style-name"},{ens:t,en:"creation-time",
ans:u,a:"data-style-name"},{ens:t,en:"database-display",ans:u,a:"data-style-name"},{ens:t,en:"date",ans:u,a:"data-style-name"},{ens:t,en:"editing-duration",ans:u,a:"data-style-name"},{ens:t,en:"expression",ans:u,a:"data-style-name"},{ens:t,en:"meta-field",ans:u,a:"data-style-name"},{ens:t,en:"modification-date",ans:u,a:"data-style-name"},{ens:t,en:"modification-time",ans:u,a:"data-style-name"},{ens:t,en:"print-date",ans:u,a:"data-style-name"},{ens:t,en:"print-time",ans:u,a:"data-style-name"},{ens:t,
en:"table-formula",ans:u,a:"data-style-name"},{ens:t,en:"time",ans:u,a:"data-style-name"},{ens:t,en:"user-defined",ans:u,a:"data-style-name"},{ens:t,en:"user-field-get",ans:u,a:"data-style-name"},{ens:t,en:"user-field-input",ans:u,a:"data-style-name"},{ens:t,en:"variable-get",ans:u,a:"data-style-name"},{ens:t,en:"variable-input",ans:u,a:"data-style-name"},{ens:t,en:"variable-set",ans:u,a:"data-style-name"}],"page-layout":[{ens:w,en:"notes",ans:u,a:"page-layout-name"},{ens:u,en:"handout-master",ans:u,
a:"page-layout-name"},{ens:u,en:"master-page",ans:u,a:"page-layout-name"}]},D,L=xmldom.XPath;this.collectUsedFontFaces=m;this.changeFontFaceNames=r;this.UsedStyleList=function(a,c){var d={};this.uses=function(a){var c=a.localName,b=a.getAttributeNS(h,"name")||a.getAttributeNS(u,"name");a="style"===c?a.getAttributeNS(u,"family"):a.namespaceURI===v?"data":c;return(a=d[a])?0<a[b]:!1};b(a,d);c&&q(c,d)};this.getStyleName=function(a,c){var b,d,h=D[c.localName];if(h&&(h=h[c.namespaceURI]))for(d=0;d<h.length;d+=
1)if(h[d].keyname===a&&(h=h[d],c.hasAttributeNS(h.ns,h.localname))){b=c.getAttributeNS(h.ns,h.localname);break}return b};this.hasDerivedStyles=function(a,c,b){var d=b.getAttributeNS(u,"name");b=b.getAttributeNS(u,"family");return L.getODFElementsWithXPath(a,"//style:*[@style:parent-style-name='"+d+"'][@style:family='"+b+"']",c).length?!0:!1};this.prefixStyleNames=function(a,c,b){var d;if(a){for(d=a.firstChild;d;){if(d.nodeType===Node.ELEMENT_NODE){var e=d,k=c,n=e.getAttributeNS(h,"name"),g=void 0;
n?g=h:(n=e.getAttributeNS(u,"name"))&&(g=u);g&&e.setAttributeNS(g,E[g]+"name",k+n)}d=d.nextSibling}f(a,c);b&&f(b,c)}};this.removePrefixFromStyleNames=function(a,c,b){var d=RegExp("^"+c);if(a){for(c=a.firstChild;c;){if(c.nodeType===Node.ELEMENT_NODE){var e=c,f=d,k=e.getAttributeNS(h,"name"),n=void 0;k?n=h:(k=e.getAttributeNS(u,"name"))&&(n=u);n&&(k=k.replace(f,""),e.setAttributeNS(n,E[n]+"name",k))}c=c.nextSibling}g(a,d);b&&g(b,d)}};this.determineStylesForNode=d;D=function(){var a,c,b,d,h,e={},f,k,
n,g;for(b in A)if(A.hasOwnProperty(b))for(d=A[b],c=d.length,a=0;a<c;a+=1)h=d[a],n=h.en,g=h.ens,e.hasOwnProperty(n)?f=e[n]:e[n]=f={},f.hasOwnProperty(g)?k=f[g]:f[g]=k=[],k.push({ns:h.ans,localname:h.a,keyname:b});return e}()};"function"!==typeof Object.create&&(Object.create=function(f){var g=function(){};g.prototype=f;return new g});
xmldom.LSSerializer=function(){function f(b){var d=b||{},f=function(b){var c={},a;for(a in b)b.hasOwnProperty(a)&&(c[b[a]]=a);return c}(b),g=[d],q=[f],m=0;this.push=function(){m+=1;d=g[m]=Object.create(d);f=q[m]=Object.create(f)};this.pop=function(){g.pop();q.pop();m-=1;d=g[m];f=q[m]};this.getLocalNamespaceDefinitions=function(){return f};this.getQName=function(b){var c=b.namespaceURI,a=0,e;if(!c)return b.localName;if(e=f[c])return e+":"+b.localName;do{e||!b.prefix?(e="ns"+a,a+=1):e=b.prefix;if(d[e]===
c)break;if(!d[e]){d[e]=c;f[c]=e;break}e=null}while(null===e);return e+":"+b.localName}}function g(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function d(e,f){var l="",p=b.filter?b.filter.acceptNode(f):NodeFilter.FILTER_ACCEPT,q;if(p===NodeFilter.FILTER_ACCEPT&&f.nodeType===Node.ELEMENT_NODE){e.push();q=e.getQName(f);var m,r=f.attributes,c,a,n,h="",s;m="<"+q;c=r.length;for(a=0;a<c;a+=1)n=r.item(a),"http://www.w3.org/2000/xmlns/"!==
n.namespaceURI&&(s=b.filter?b.filter.acceptNode(n):NodeFilter.FILTER_ACCEPT,s===NodeFilter.FILTER_ACCEPT&&(s=e.getQName(n),n="string"===typeof n.value?g(n.value):n.value,h+=" "+(s+'="'+n+'"')));c=e.getLocalNamespaceDefinitions();for(a in c)c.hasOwnProperty(a)&&((r=c[a])?"xmlns"!==r&&(m+=" xmlns:"+c[a]+'="'+a+'"'):m+=' xmlns="'+a+'"');l+=m+(h+">")}if(p===NodeFilter.FILTER_ACCEPT||p===NodeFilter.FILTER_SKIP){for(p=f.firstChild;p;)l+=d(e,p),p=p.nextSibling;f.nodeValue&&(l+=g(f.nodeValue))}q&&(l+="</"+
q+">",e.pop());return l}var b=this;this.filter=null;this.writeToString=function(b,k){if(!b)return"";var g=new f(k);return d(g,b)}};(function(){function f(b){var c,a=p.length;for(c=0;c<a;c+=1)if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===b.namespaceURI&&b.localName===p[c])return c;return-1}function g(b,c){var a=new e.UsedStyleList(b,c),d=new odf.OdfNodeFilter;this.acceptNode=function(b){var e=d.acceptNode(b);e===NodeFilter.FILTER_ACCEPT&&b.parentNode===c&&b.nodeType===Node.ELEMENT_NODE&&(e=a.uses(b)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);return e}}function d(b,c){var a=new g(b,c);this.acceptNode=function(c){var b=
a.acceptNode(c);b!==NodeFilter.FILTER_ACCEPT||!c.parentNode||c.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==c.parentNode.localName&&"tab"!==c.parentNode.localName||(b=NodeFilter.FILTER_REJECT);return b}}function b(b,c){if(c){var a=f(c),d,h=b.firstChild;if(-1!==a){for(;h;){d=f(h);if(-1!==d&&d>a)break;h=h.nextSibling}b.insertBefore(c,h)}}}var e=new odf.StyleInfo,k=new core.DomUtils,l=odf.Namespaces.stylens,p="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),
q=Date.now()+"_webodf_",m=new core.Base64;odf.ODFElement=function(){};odf.ODFDocumentElement=function(){};odf.ODFDocumentElement.prototype=new odf.ODFElement;odf.ODFDocumentElement.prototype.constructor=odf.ODFDocumentElement;odf.ODFDocumentElement.prototype.fontFaceDecls=null;odf.ODFDocumentElement.prototype.manifest=null;odf.ODFDocumentElement.prototype.settings=null;odf.ODFDocumentElement.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0";odf.ODFDocumentElement.localName="document";
odf.AnnotationElement=function(){};odf.OdfPart=function(b,c,a,d){var h=this;this.size=0;this.type=null;this.name=b;this.container=a;this.url=null;this.mimetype=c;this.onstatereadychange=this.document=null;this.EMPTY=0;this.LOADING=1;this.DONE=2;this.state=this.EMPTY;this.data="";this.load=function(){null!==d&&(this.mimetype=c,d.loadAsDataURL(b,c,function(a,c){a&&runtime.log(a);h.url=c;if(h.onchange)h.onchange(h);if(h.onstatereadychange)h.onstatereadychange(h)}))}};odf.OdfPart.prototype.load=function(){};
odf.OdfPart.prototype.getUrl=function(){return this.data?"data:;base64,"+m.toBase64(this.data):null};odf.OdfContainer=function c(a,f){function h(a){for(var c=a.firstChild,b;c;)b=c.nextSibling,c.nodeType===Node.ELEMENT_NODE?h(c):c.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&a.removeChild(c),c=b}function s(a){var c={},b,d,h=a.ownerDocument.createNodeIterator(a,NodeFilter.SHOW_ELEMENT,null,!1);for(a=h.nextNode();a;)"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&("annotation"===
a.localName?(b=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))&&(c.hasOwnProperty(b)?runtime.log("Warning: annotation name used more than once with <office:annotation/>: '"+b+"'"):c[b]=a):"annotation-end"===a.localName&&((b=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))?c.hasOwnProperty(b)?(d=c[b],d.annotationEndElement?runtime.log("Warning: annotation name used more than once with <office:annotation-end/>: '"+b+"'"):d.annotationEndElement=
a):runtime.log("Warning: annotation end without an annotation start, name: '"+b+"'"):runtime.log("Warning: annotation end without a name found"))),a=h.nextNode()}function p(a,c){for(var b=a&&a.firstChild;b;)b.nodeType===Node.ELEMENT_NODE&&b.setAttributeNS("urn:webodf:names:scope","scope",c),b=b.nextSibling}function y(a,c){for(var b=J.rootElement.meta,b=b&&b.firstChild;b&&(b.namespaceURI!==a||b.localName!==c);)b=b.nextSibling;for(b=b&&b.firstChild;b&&b.nodeType!==Node.TEXT_NODE;)b=b.nextSibling;return b?
b.data:null}function w(a){var b={},c;for(a=a.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&a.namespaceURI===l&&"font-face"===a.localName&&(c=a.getAttributeNS(l,"name"),b[c]=a),a=a.nextSibling;return b}function u(a,b){var c=null,d,h,e;if(a)for(c=a.cloneNode(!0),d=c.firstElementChild;d;)h=d.nextElementSibling,(e=d.getAttributeNS("urn:webodf:names:scope","scope"))&&e!==b&&c.removeChild(d),d=h;return c}function x(a,b){var c,d,h,f=null,g={};if(a)for(b.forEach(function(a){e.collectUsedFontFaces(g,a)}),
f=a.cloneNode(!0),c=f.firstElementChild;c;)d=c.nextElementSibling,h=c.getAttributeNS(l,"name"),g[h]||f.removeChild(c),c=d;return f}function t(a){var b=J.rootElement.ownerDocument,c;if(a){h(a.documentElement);try{c=b.importNode(a.documentElement,!0)}catch(d){}}return c}function E(a){J.state=a;if(J.onchange)J.onchange(J);if(J.onstatereadychange)J.onstatereadychange(J)}function A(a){Z=null;J.rootElement=a;a.fontFaceDecls=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");
a.styles=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles");a.automaticStyles=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");a.masterStyles=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles");a.body=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");a.meta=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta");a.settings=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"settings");a.scripts=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","scripts");s(a)}function D(a){var d=t(a),h=J.rootElement,f;d&&"document-styles"===d.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===d.namespaceURI?(h.fontFaceDecls=k.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),b(h,h.fontFaceDecls),f=k.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),h.styles=f||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"styles"),b(h,h.styles),f=k.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),h.automaticStyles=f||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),p(h.automaticStyles,"document-styles"),b(h,h.automaticStyles),d=k.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),h.masterStyles=d||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),b(h,h.masterStyles),
e.prefixStyleNames(h.automaticStyles,q,h.masterStyles)):E(c.INVALID)}function L(a){a=t(a);var d,h,f,g;if(a&&"document-content"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI){d=J.rootElement;f=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");if(d.fontFaceDecls&&f){g=d.fontFaceDecls;var n,m,s,q,A={};h=w(g);q=w(f);for(f=f.firstElementChild;f;){n=f.nextElementSibling;if(f.namespaceURI===l&&"font-face"===f.localName)if(m=f.getAttributeNS(l,
"name"),h.hasOwnProperty(m)){if(!f.isEqualNode(h[m])){s=m;for(var D=h,M=q,I=0,ga=void 0,ga=s=s.replace(/\d+$/,"");D.hasOwnProperty(ga)||M.hasOwnProperty(ga);)I+=1,ga=s+I;s=ga;f.setAttributeNS(l,"style:name",s);g.appendChild(f);h[s]=f;delete q[m];A[m]=s}}else g.appendChild(f),h[m]=f,delete q[m];f=n}g=A}else f&&(d.fontFaceDecls=f,b(d,f));h=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");p(h,"document-content");g&&e.changeFontFaceNames(h,g);if(d.automaticStyles&&
h)for(g=h.firstChild;g;)d.automaticStyles.appendChild(g),g=h.firstChild;else h&&(d.automaticStyles=h,b(d,h));a=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");if(null===a)throw"<office:body/> tag is mising.";d.body=a;b(d,d.body)}else E(c.INVALID)}function I(a){a=t(a);var c;a&&"document-meta"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(c=J.rootElement,c.meta=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"meta"),b(c,c.meta))}function P(a){a=t(a);var c;a&&"document-settings"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(c=J.rootElement,c.settings=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),b(c,c.settings))}function M(a){a=t(a);var c;if(a&&"manifest"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===a.namespaceURI)for(c=J.rootElement,c.manifest=a,a=c.manifest.firstElementChild;a;)"file-entry"===a.localName&&
"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===a.namespaceURI&&(aa[a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),a=a.nextElementSibling}function T(a,c,b){a=k.getElementsByTagName(a,c);var d;for(d=0;d<a.length;d+=1)c=a[d],b.hasOwnProperty(c.namespaceURI)||c.parentNode.removeChild(c)}function C(a){T(a,"script",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:office:1.0":!0,
"urn:oasis:names:tc:opendocument:xmlns:table:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:text:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":!0});T(a,"style",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:style:1.0":!0})}function Q(a){var c=a.firstElementChild,b=[],d,h,e,f=a.attributes,g=f.length;for(d=0;d<g;d+=1)e=f.item(d),h=e.localName.substr(0,2).toLowerCase(),null===
e.namespaceURI&&"on"===h&&b.push(e);g=b.length;for(d=0;d<g;d+=1)a.removeAttributeNode(b[d]);for(;c;)Q(c),c=c.nextElementSibling}function V(a){var b=a.shift();b?X.loadAsDOM(b.path,function(d,h){h&&(C(h),Q(h.documentElement));b.handler(h);J.state===c.INVALID?d?runtime.log("ERROR: Unable to load "+b.path+" - "+d):runtime.log("ERROR: Unable to load "+b.path):(d&&runtime.log("DEBUG: Unable to load "+b.path+" - "+d),V(a))}):(s(J.rootElement),E(c.DONE))}function F(a){var c="";odf.Namespaces.forEachPrefix(function(a,
b){c+=" xmlns:"+a+'="'+b+'"'});return'<?xml version="1.0" encoding="UTF-8"?><office:'+a+" "+c+' office:version="1.2">'}function W(){var a=new xmldom.LSSerializer,c=F("document-meta");a.filter=new odf.OdfNodeFilter;c+=a.writeToString(J.rootElement.meta,odf.Namespaces.namespaceMap);return c+"</office:document-meta>"}function ha(a,c){var b=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:file-entry");b.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0",
"manifest:full-path",a);b.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:media-type",c);return b}function ga(){var a=runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),c=a.documentElement,b=new xmldom.LSSerializer,d;for(d in aa)aa.hasOwnProperty(d)&&c.appendChild(ha(d,aa[d]));b.filter=new odf.OdfNodeFilter;return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+
b.writeToString(a,odf.Namespaces.namespaceMap)}function U(){var a,c,b,d=odf.Namespaces.namespaceMap,h=new xmldom.LSSerializer,f=F("document-styles");c=u(J.rootElement.automaticStyles,"document-styles");b=J.rootElement.masterStyles.cloneNode(!0);a=x(J.rootElement.fontFaceDecls,[b,J.rootElement.styles,c]);e.removePrefixFromStyleNames(c,q,b);h.filter=new g(b,c);f+=h.writeToString(a,d);f+=h.writeToString(J.rootElement.styles,d);f+=h.writeToString(c,d);f+=h.writeToString(b,d);return f+"</office:document-styles>"}
function B(){var a,c,b=odf.Namespaces.namespaceMap,h=new xmldom.LSSerializer,e=F("document-content");c=u(J.rootElement.automaticStyles,"document-content");a=x(J.rootElement.fontFaceDecls,[c]);h.filter=new d(J.rootElement.body,c);e+=h.writeToString(a,b);e+=h.writeToString(c,b);e+=h.writeToString(J.rootElement.body,b);return e+"</office:document-content>"}function O(a,b){runtime.loadXML(a,function(a,d){if(a)b(a);else if(d){C(d);Q(d.documentElement);var h=t(d);h&&"document"===h.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===
h.namespaceURI?(A(h),E(c.DONE)):E(c.INVALID)}else b("No DOM was loaded.")})}function z(a,c){var d;d=J.rootElement;var h=d.meta;h||(d.meta=h=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),b(d,h));d=h;a&&k.mapKeyValObjOntoNode(d,a,odf.Namespaces.lookupNamespaceURI);c&&k.removeKeyElementsFromNode(d,c,odf.Namespaces.lookupNamespaceURI)}function S(a){function b(a,c){var d;c||(c=a);d=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",c);e[a]=
d;e.appendChild(d)}var d=new core.Zip("",null),h=runtime.byteArrayFromString("application/vnd.oasis.opendocument."+a,"utf8"),e=J.rootElement,f=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",a);d.save("mimetype",h,!1,new Date);b("meta");b("settings");b("scripts");b("fontFaceDecls","font-face-decls");b("styles");b("automaticStyles","automatic-styles");b("masterStyles","master-styles");b("body");e.body.appendChild(f);aa["/"]="application/vnd.oasis.opendocument."+a;aa["settings.xml"]=
"text/xml";aa["meta.xml"]="text/xml";aa["styles.xml"]="text/xml";aa["content.xml"]="text/xml";E(c.DONE);return d}function K(){var a,c=new Date,b="";J.rootElement.settings&&J.rootElement.settings.firstElementChild&&(a=new xmldom.LSSerializer,b=F("document-settings"),a.filter=new odf.OdfNodeFilter,b+=a.writeToString(J.rootElement.settings,odf.Namespaces.namespaceMap),b+="</office:document-settings>");(a=b)?(a=runtime.byteArrayFromString(a,"utf8"),X.save("settings.xml",a,!0,c)):X.remove("settings.xml");
b=runtime.getWindow();a="WebODF/"+webodf.Version;b&&(a=a+" "+b.navigator.userAgent);z({"meta:generator":a},null);a=runtime.byteArrayFromString(W(),"utf8");X.save("meta.xml",a,!0,c);a=runtime.byteArrayFromString(U(),"utf8");X.save("styles.xml",a,!0,c);a=runtime.byteArrayFromString(B(),"utf8");X.save("content.xml",a,!0,c);a=runtime.byteArrayFromString(ga(),"utf8");X.save("META-INF/manifest.xml",a,!0,c)}function Y(a,c){K();X.writeAs(a,function(a){c(a)})}var J=this,X,aa={},Z,$="";this.onstatereadychange=
f;this.state=this.onchange=null;this.getMetadata=y;this.setRootElement=A;this.getContentElement=function(){var a;Z||(a=J.rootElement.body,Z=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","text")||k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")||k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet"));if(!Z)throw"Could not find content element in <office:body/>.";return Z};this.getDocumentType=function(){var a=
J.getContentElement();return a&&a.localName};this.getPart=function(a){return new odf.OdfPart(a,aa[a],J,X)};this.getPartData=function(a,c){X.load(a,c)};this.setMetadata=z;this.incrementEditingCycles=function(){var a=y(odf.Namespaces.metans,"editing-cycles"),a=a?parseInt(a,10):0;isNaN(a)&&(a=0);z({"meta:editing-cycles":a+1},null);return a+1};this.createByteArray=function(a,c){K();X.createByteArray(a,c)};this.saveAs=Y;this.save=function(a){Y($,a)};this.getUrl=function(){return $};this.setBlob=function(a,
c,b){b=m.convertBase64ToByteArray(b);X.save(a,b,!1,new Date);aa.hasOwnProperty(a)&&runtime.log(a+" has been overwritten.");aa[a]=c};this.removeBlob=function(a){var c=X.remove(a);runtime.assert(c,"file is not found: "+a);delete aa[a]};this.state=c.LOADING;this.rootElement=function(a){var c=document.createElementNS(a.namespaceURI,a.localName),b;a=new a.Type;for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c}({Type:odf.ODFDocumentElement,namespaceURI:odf.ODFDocumentElement.namespaceURI,localName:odf.ODFDocumentElement.localName});
a===odf.OdfContainer.DocumentType.TEXT?X=S("text"):a===odf.OdfContainer.DocumentType.PRESENTATION?X=S("presentation"):a===odf.OdfContainer.DocumentType.SPREADSHEET?X=S("spreadsheet"):($=a,X=new core.Zip($,function(a,b){X=b;a?O($,function(b){a&&(X.error=a+"\n"+b,E(c.INVALID))}):V([{path:"styles.xml",handler:D},{path:"content.xml",handler:L},{path:"meta.xml",handler:I},{path:"settings.xml",handler:P},{path:"META-INF/manifest.xml",handler:M}])}))};odf.OdfContainer.EMPTY=0;odf.OdfContainer.LOADING=1;
odf.OdfContainer.DONE=2;odf.OdfContainer.INVALID=3;odf.OdfContainer.SAVING=4;odf.OdfContainer.MODIFIED=5;odf.OdfContainer.getContainer=function(c){return new odf.OdfContainer(c,null)}})();odf.OdfContainer.DocumentType={TEXT:1,PRESENTATION:2,SPREADSHEET:3};odf.OdfUtils=function(){function f(a){return"image"===(a&&a.localName)&&a.namespaceURI===Q}function g(a){return null!==a&&a.nodeType===Node.ELEMENT_NODE&&"frame"===a.localName&&a.namespaceURI===Q&&"as-char"===a.getAttributeNS(C,"anchor-type")}function d(a){var c;(c="annotation"===(a&&a.localName)&&a.namespaceURI===odf.Namespaces.officens)||(c="div"===(a&&a.localName)&&"annotationWrapper"===a.className);return c}function b(a){return"a"===(a&&a.localName)&&a.namespaceURI===C}function e(a){var c=a&&
a.localName;return("p"===c||"h"===c)&&a.namespaceURI===C}function k(a){for(;a&&!e(a);)a=a.parentNode;return a}function l(a,c){for(;a&&a!==c;){if(a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName)return a;a=a.parentElement}return null}function p(a){return/^[ \t\r\n]+$/.test(a)}function q(a){if(null===a||a.nodeType!==Node.ELEMENT_NODE)return!1;var c=a.localName;return/^(span|p|h|a|meta)$/.test(c)&&a.namespaceURI===C||"span"===c&&"webodf-annotationHighlight"===a.className}function m(a){var c=
a&&a.localName,b=!1;c&&(a=a.namespaceURI,a===C&&(b="s"===c||"tab"===c||"line-break"===c));return b}function r(a){return m(a)||g(a)||d(a)}function c(a){var c=a&&a.localName,b=!1;c&&(a=a.namespaceURI,a===C&&(b="s"===c));return b}function a(a){return-1!==ha.indexOf(a.namespaceURI)}function n(c){if(m(c))return!1;if(a(c.parentNode)&&c.nodeType===Node.TEXT_NODE)return 0===c.textContent.length;for(c=c.firstChild;c;){if(a(c)||!n(c))return!1;c=c.nextSibling}return!0}function h(a){for(;null!==a.firstChild&&
q(a);)a=a.firstChild;return a}function s(a){for(;null!==a.lastChild&&q(a);)a=a.lastChild;return a}function v(a){for(;!e(a)&&null===a.previousSibling;)a=a.parentNode;return e(a)?null:s(a.previousSibling)}function y(a){for(;!e(a)&&null===a.nextSibling;)a=a.parentNode;return e(a)?null:h(a.nextSibling)}function w(a){for(var b=!1;a;)if(a.nodeType===Node.TEXT_NODE)if(0===a.length)a=v(a);else return!p(a.data.substr(a.length-1,1));else r(a)?(b=!1===c(a),a=null):a=v(a);return b}function u(a){var c=!1,b;for(a=
a&&h(a);a;){b=a.nodeType===Node.TEXT_NODE?a.length:0;if(0<b&&!p(a.data)){c=!0;break}if(r(a)){c=!0;break}a=y(a)}return c}function x(a,c){return p(a.data.substr(c))?!u(y(a)):!1}function t(a,c){var b=a.data,d;if(!p(b[c])||r(a.parentNode))return!1;0<c?p(b[c-1])||(d=!0):w(v(a))&&(d=!0);return!0===d?x(a,c)?!1:!0:!1}function E(a){return(a=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(a))?{value:parseFloat(a[1]),unit:a[3]}:null}function A(a){return(a=
E(a))&&(0>a.value||"%"===a.unit)?null:a}function D(a){return(a=E(a))&&"%"!==a.unit?null:a}function L(a){switch(a.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return!1;case odf.Namespaces.textns:switch(a.localName){case "note-body":case "ruby-text":return!1}break;case odf.Namespaces.officens:switch(a.localName){case "annotation":case "binary-data":case "event-listeners":return!1}break;default:switch(a.localName){case "cursor":case "editinfo":return!1}}return!0}
function I(a,c){for(;0<c.length&&!W.rangeContainsNode(a,c[0]);)c.shift();for(;0<c.length&&!W.rangeContainsNode(a,c[c.length-1]);)c.pop()}function P(a,c,b){var h;h=W.getNodesInRange(a,function(a){var c=NodeFilter.FILTER_REJECT;if(m(a.parentNode)||d(a))c=NodeFilter.FILTER_REJECT;else if(a.nodeType===Node.TEXT_NODE){if(b||Boolean(k(a)&&(!p(a.textContent)||t(a,0))))c=NodeFilter.FILTER_ACCEPT}else if(r(a))c=NodeFilter.FILTER_ACCEPT;else if(L(a)||q(a))c=NodeFilter.FILTER_SKIP;return c},NodeFilter.SHOW_ELEMENT|
NodeFilter.SHOW_TEXT);c||I(a,h);return h}function M(a,c,b){for(;a;){if(b(a)){c[0]!==a&&c.unshift(a);break}if(d(a))break;a=a.parentNode}}function T(a,c){var b=a;if(c<b.childNodes.length-1)b=b.childNodes[c+1];else{for(;!b.nextSibling;)b=b.parentNode;b=b.nextSibling}for(;b.firstChild;)b=b.firstChild;return b}var C=odf.Namespaces.textns,Q=odf.Namespaces.drawns,V=odf.Namespaces.xlinkns,F=/^\s*$/,W=new core.DomUtils,ha=[odf.Namespaces.dbns,odf.Namespaces.dcns,odf.Namespaces.dr3dns,odf.Namespaces.drawns,
odf.Namespaces.chartns,odf.Namespaces.formns,odf.Namespaces.numberns,odf.Namespaces.officens,odf.Namespaces.presentationns,odf.Namespaces.stylens,odf.Namespaces.svgns,odf.Namespaces.tablens,odf.Namespaces.textns];this.isImage=f;this.isCharacterFrame=g;this.isInlineRoot=d;this.isTextSpan=function(a){return"span"===(a&&a.localName)&&a.namespaceURI===C};this.isHyperlink=b;this.getHyperlinkTarget=function(a){return a.getAttributeNS(V,"href")||""};this.isParagraph=e;this.getParagraphElement=k;this.isWithinTrackedChanges=
function(a,c){for(;a&&a!==c;){if(a.namespaceURI===C&&"tracked-changes"===a.localName)return!0;a=a.parentNode}return!1};this.getParentAnnotation=l;this.isWithinAnnotation=function(a,c){return Boolean(l(a,c))};this.getAnnotationCreator=function(a){return a.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0].textContent};this.isListItem=function(a){return"list-item"===(a&&a.localName)&&a.namespaceURI===C};this.isLineBreak=function(a){return"line-break"===(a&&a.localName)&&a.namespaceURI===C};this.isODFWhitespace=
p;this.isGroupingElement=q;this.isCharacterElement=m;this.isAnchoredAsCharacterElement=r;this.isSpaceElement=c;this.isODFNode=a;this.hasNoODFContent=n;this.firstChild=h;this.lastChild=s;this.previousNode=v;this.nextNode=y;this.scanLeftForNonSpace=w;this.lookLeftForCharacter=function(a){var c,b=c=0;a.nodeType===Node.TEXT_NODE&&(b=a.length);0<b?(c=a.data,c=p(c.substr(b-1,1))?1===b?w(v(a))?2:0:p(c.substr(b-2,1))?0:2:1):r(a)&&(c=1);return c};this.lookRightForCharacter=function(a){var c=!1,b=0;a&&a.nodeType===
Node.TEXT_NODE&&(b=a.length);0<b?c=!p(a.data.substr(0,1)):r(a)&&(c=!0);return c};this.scanLeftForAnyCharacter=function(a){var c=!1,b;for(a=a&&s(a);a;){b=a.nodeType===Node.TEXT_NODE?a.length:0;if(0<b&&!p(a.data)){c=!0;break}if(r(a)){c=!0;break}a=v(a)}return c};this.scanRightForAnyCharacter=u;this.isTrailingWhitespace=x;this.isSignificantWhitespace=t;this.isDowngradableSpaceElement=function(a){return c(a)?w(v(a))&&u(y(a)):!1};this.getFirstNonWhitespaceChild=function(a){for(a=a&&a.firstChild;a&&a.nodeType===
Node.TEXT_NODE&&F.test(a.nodeValue);)a=a.nextSibling;return a};this.parseLength=E;this.parseNonNegativeLength=A;this.parseFoFontSize=function(a){var c;c=(c=E(a))&&(0>=c.value||"%"===c.unit)?null:c;return c||D(a)};this.parseFoLineHeight=function(a){return A(a)||D(a)};this.isTextContentContainingNode=L;this.getTextNodes=function(a,c){var b;b=W.getNodesInRange(a,function(a){var c=NodeFilter.FILTER_REJECT;a.nodeType===Node.TEXT_NODE?Boolean(k(a)&&(!p(a.textContent)||t(a,0)))&&(c=NodeFilter.FILTER_ACCEPT):
L(a)&&(c=NodeFilter.FILTER_SKIP);return c},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);c||I(a,b);return b};this.getTextElements=P;this.getParagraphElements=function(a){var c;c=W.getNodesInRange(a,function(a){var c=NodeFilter.FILTER_REJECT;if(e(a))c=NodeFilter.FILTER_ACCEPT;else if(L(a)||q(a))c=NodeFilter.FILTER_SKIP;return c},NodeFilter.SHOW_ELEMENT);M(a.startContainer,c,e);return c};this.getImageElements=function(a){var c;c=W.getNodesInRange(a,function(a){var c=NodeFilter.FILTER_SKIP;f(a)&&(c=
NodeFilter.FILTER_ACCEPT);return c},NodeFilter.SHOW_ELEMENT);M(a.startContainer,c,f);return c};this.getHyperlinkElements=function(a){var c=[],d=a.cloneRange();a.collapsed&&a.endContainer.nodeType===Node.ELEMENT_NODE&&(a=T(a.endContainer,a.endOffset),a.nodeType===Node.TEXT_NODE&&d.setEnd(a,1));P(d,!0,!1).forEach(function(a){for(a=a.parentNode;!e(a);){if(b(a)&&-1===c.indexOf(a)){c.push(a);break}a=a.parentNode}});d.detach();return c};this.getNormalizedFontFamilyName=function(a){/^(["'])(?:.|[\n\r])*?\1$/.test(a)||
(a=a.replace(/^[ \t\r\n\f]*((?:.|[\n\r])*?)[ \t\r\n\f]*$/,"$1"),/[ \t\r\n\f]/.test(a)&&(a="'"+a.replace(/[ \t\r\n\f]+/g," ")+"'"));return a}};gui.AnnotatableCanvas=function(){};gui.AnnotatableCanvas.prototype.refreshSize=function(){};gui.AnnotatableCanvas.prototype.getZoomLevel=function(){};gui.AnnotatableCanvas.prototype.getSizer=function(){};
gui.AnnotationViewManager=function(f,g,d,b){function e(a){var c=a.annotationEndElement,b=m.createRange(),d=a.getAttributeNS(odf.Namespaces.officens,"name");c&&(b.setStart(a,a.childNodes.length),b.setEnd(c,0),a=r.getTextNodes(b,!1),a.forEach(function(a){var c=m.createElement("span");c.className="webodf-annotationHighlight";c.setAttribute("annotation",d);a.parentNode.insertBefore(c,a);c.appendChild(a)}));b.detach()}function k(a){var b=f.getSizer();a?(d.style.display="inline-block",b.style.paddingRight=
c.getComputedStyle(d).width):(d.style.display="none",b.style.paddingRight=0);f.refreshSize()}function l(){q.sort(function(a,c){return 0!==(a.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_FOLLOWING)?-1:1})}function p(){var a;for(a=0;a<q.length;a+=1){var c=q[a],b=c.parentNode,e=b.nextElementSibling,g=e.nextElementSibling,k=b.parentNode,l=0,l=q[q.indexOf(c)-1],m=void 0,c=f.getZoomLevel();b.style.left=(d.getBoundingClientRect().left-k.getBoundingClientRect().left)/c+"px";b.style.width=d.getBoundingClientRect().width/
c+"px";e.style.width=parseFloat(b.style.left)-30+"px";l&&(m=l.parentNode.getBoundingClientRect(),20>=(k.getBoundingClientRect().top-m.bottom)/c?b.style.top=Math.abs(k.getBoundingClientRect().top-m.bottom)/c+20+"px":b.style.top="0px");g.style.left=e.getBoundingClientRect().width/c+"px";var e=g.style,k=g.getBoundingClientRect().left/c,l=g.getBoundingClientRect().top/c,m=b.getBoundingClientRect().left/c,r=b.getBoundingClientRect().top/c,p=0,E=0,p=m-k,p=p*p,E=r-l,E=E*E,k=Math.sqrt(p+E);e.width=k+"px";
l=Math.asin((b.getBoundingClientRect().top-g.getBoundingClientRect().top)/(c*parseFloat(g.style.width)));g.style.transform="rotate("+l+"rad)";g.style.MozTransform="rotate("+l+"rad)";g.style.WebkitTransform="rotate("+l+"rad)";g.style.msTransform="rotate("+l+"rad)"}}var q=[],m=g.ownerDocument,r=new odf.OdfUtils,c=runtime.getWindow();runtime.assert(Boolean(c),"Expected to be run in an environment which has a global window, like a browser.");this.rerenderAnnotations=p;this.getMinimumHeightForAnnotationPane=
function(){return"none"!==d.style.display&&0<q.length?(q[q.length-1].parentNode.getBoundingClientRect().bottom-d.getBoundingClientRect().top)/f.getZoomLevel()+"px":null};this.addAnnotation=function(a){k(!0);q.push(a);l();var c=m.createElement("div"),d=m.createElement("div"),f=m.createElement("div"),g=m.createElement("div"),y;c.className="annotationWrapper";c.setAttribute("creator",r.getAnnotationCreator(a));a.parentNode.insertBefore(c,a);d.className="annotationNote";d.appendChild(a);b&&(y=m.createElement("div"),
y.className="annotationRemoveButton",d.appendChild(y));f.className="annotationConnector horizontal";g.className="annotationConnector angular";c.appendChild(d);c.appendChild(f);c.appendChild(g);a.annotationEndElement&&e(a);p()};this.forgetAnnotations=function(){for(;q.length;){var a=q[0],c=q.indexOf(a),b=a.parentNode.parentNode;"div"===b.localName&&(b.parentNode.insertBefore(a,b),b.parentNode.removeChild(b));for(var a=a.getAttributeNS(odf.Namespaces.officens,"name"),a=m.querySelectorAll('span.webodf-annotationHighlight[annotation="'+
a+'"]'),d=b=void 0,b=0;b<a.length;b+=1){for(d=a.item(b);d.firstChild;)d.parentNode.insertBefore(d.firstChild,d);d.parentNode.removeChild(d)}-1!==c&&q.splice(c,1);0===q.length&&k(!1)}}};(function(){function f(d,g,l,p,q){var m,r=0,c;for(c in d)if(d.hasOwnProperty(c)){if(r===l){m=c;break}r+=1}m?g.getPartData(d[m].href,function(a,c){if(a)runtime.log(a);else if(c){var h="@font-face { font-family: "+(d[m].family||m)+"; src: url(data:application/x-font-ttf;charset=binary;base64,"+b.convertUTF8ArrayToBase64(c)+') format("truetype"); }';try{p.insertRule(h,p.cssRules.length)}catch(r){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(r)+"\nRule: "+h)}}else runtime.log("missing font data for "+
d[m].href);f(d,g,l+1,p,q)}):q&&q()}var g=xmldom.XPath,d=new odf.OdfUtils,b=new core.Base64;odf.FontLoader=function(){this.loadFonts=function(b,k){for(var l=b.rootElement.fontFaceDecls;k.cssRules.length;)k.deleteRule(k.cssRules.length-1);if(l){var p={},q,m,r,c;if(l)for(l=g.getODFElementsWithXPath(l,"style:font-face[svg:font-face-src]",odf.Namespaces.lookupNamespaceURI),q=0;q<l.length;q+=1)m=l[q],r=m.getAttributeNS(odf.Namespaces.stylens,"name"),c=d.getNormalizedFontFamilyName(m.getAttributeNS(odf.Namespaces.svgns,
"font-family")),m=g.getODFElementsWithXPath(m,"svg:font-face-src/svg:font-face-uri",odf.Namespaces.lookupNamespaceURI),0<m.length&&(m=m[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),p[r]={href:m,family:c});f(p,b,0,k)}}}})();odf.Formatting=function(){function f(a){return(a=E[a])?x.mergeObjects({},a):{}}function g(){for(var a=c.rootElement.fontFaceDecls,b={},d,e,a=a&&a.firstElementChild;a;){if(d=a.getAttributeNS(h,"name"))if((e=a.getAttributeNS(n,"font-family"))||0<a.getElementsByTagNameNS(n,"font-face-uri").length)b[d]=e;a=a.nextElementSibling}return b}function d(a){for(var b=c.rootElement.styles.firstElementChild;b;){if(b.namespaceURI===h&&"default-style"===b.localName&&b.getAttributeNS(h,"family")===a)return b;b=b.nextElementSibling}return null}
function b(a,b,d){var e,f,g;d=d||[c.rootElement.automaticStyles,c.rootElement.styles];for(g=0;g<d.length;g+=1)for(e=d[g],e=e.firstElementChild;e;){f=e.getAttributeNS(h,"name");if(e.namespaceURI===h&&"style"===e.localName&&e.getAttributeNS(h,"family")===b&&f===a||"list-style"===b&&e.namespaceURI===s&&"list-style"===e.localName&&f===a||"data"===b&&e.namespaceURI===v&&f===a)return e;e=e.nextElementSibling}return null}function e(a){for(var c,b,d,e,f={},g=a.firstElementChild;g;){if(g.namespaceURI===h)for(d=
f[g.nodeName]={},b=g.attributes,c=0;c<b.length;c+=1)e=b.item(c),d[e.name]=e.value;g=g.nextElementSibling}b=a.attributes;for(c=0;c<b.length;c+=1)e=b.item(c),f[e.name]=e.value;return f}function k(a,g){for(var k=c.rootElement.styles,l,n={},m=a.getAttributeNS(h,"family"),p=a;p;)l=e(p),n=x.mergeObjects(l,n),p=(l=p.getAttributeNS(h,"parent-style-name"))?b(l,m,[k]):null;if(p=d(m))l=e(p),n=x.mergeObjects(l,n);!1!==g&&(l=f(m),n=x.mergeObjects(l,n));return n}function l(c,b){function d(a){Object.keys(a).forEach(function(c){Object.keys(a[c]).forEach(function(a){g+=
"|"+c+":"+a+"|"})})}for(var h=c.nodeType===Node.TEXT_NODE?c.parentNode:c,e,f=[],g="",k=!1;h;)!k&&w.isGroupingElement(h)&&(k=!0),(e=a.determineStylesForNode(h))&&f.push(e),h=h.parentNode;k&&(f.forEach(d),b&&(b[g]=f));return k?f:void 0}function p(a){var d={orderedStyles:[]};a.forEach(function(a){Object.keys(a).forEach(function(e){var f=Object.keys(a[e])[0],g={name:f,family:e,displayName:void 0,isCommonStyle:!1},l;(l=b(f,e))?(e=k(l),d=x.mergeObjects(e,d),g.displayName=l.getAttributeNS(h,"display-name")||
void 0,g.isCommonStyle=l.parentNode===c.rootElement.styles):runtime.log("No style element found for '"+f+"' of family '"+e+"'");d.orderedStyles.push(g)})});return d}function q(a,c){var b={},d=[];c||(c={});a.forEach(function(a){l(a,b)});Object.keys(b).forEach(function(a){c[a]||(c[a]=p(b[a]));d.push(c[a])});return d}function m(a){for(var b=c.rootElement.masterStyles.firstElementChild;b&&(b.namespaceURI!==h||"master-page"!==b.localName||b.getAttributeNS(h,"name")!==a);)b=b.nextElementSibling;return b}
function r(a,c){var b;a&&(b=t.convertMeasure(a,"px"));void 0===b&&c&&(b=t.convertMeasure(c,"px"));return b}var c,a=new odf.StyleInfo,n=odf.Namespaces.svgns,h=odf.Namespaces.stylens,s=odf.Namespaces.textns,v=odf.Namespaces.numberns,y=odf.Namespaces.fons,w=new odf.OdfUtils,u=new core.DomUtils,x=new core.Utils,t=new core.CSSUnits,E={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};this.getSystemDefaultStyleAttributes=f;this.setOdfContainer=function(a){c=a};this.getFontMap=g;this.getAvailableParagraphStyles=
function(){for(var a=c.rootElement.styles,b,d,e=[],a=a&&a.firstElementChild;a;)"style"===a.localName&&a.namespaceURI===h&&(b=a.getAttributeNS(h,"family"),"paragraph"===b&&(b=a.getAttributeNS(h,"name"),d=a.getAttributeNS(h,"display-name")||b,b&&d&&e.push({name:b,displayName:d}))),a=a.nextElementSibling;return e};this.isStyleUsed=function(b){var d,h=c.rootElement;d=a.hasDerivedStyles(h,odf.Namespaces.lookupNamespaceURI,b);b=(new a.UsedStyleList(h.styles)).uses(b)||(new a.UsedStyleList(h.automaticStyles)).uses(b)||
(new a.UsedStyleList(h.body)).uses(b);return d||b};this.getDefaultStyleElement=d;this.getStyleElement=b;this.getStyleAttributes=e;this.getInheritedStyleAttributes=k;this.getFirstCommonParentStyleNameOrSelf=function(a){var d=c.rootElement.styles,e;if(e=b(a,"paragraph",[c.rootElement.automaticStyles]))if(a=e.getAttributeNS(h,"parent-style-name"),!a)return null;return(e=b(a,"paragraph",[d]))?a:null};this.hasParagraphStyle=function(a){return Boolean(b(a,"paragraph"))};this.getAppliedStyles=q;this.getAppliedStylesForElement=
function(a,c){return q([a],c)[0]};this.updateStyle=function(a,b){var d,e;u.mapObjOntoNode(a,b,odf.Namespaces.lookupNamespaceURI);(d=b["style:text-properties"]&&b["style:text-properties"]["style:font-name"])&&!g().hasOwnProperty(d)&&(e=a.ownerDocument.createElementNS(h,"style:font-face"),e.setAttributeNS(h,"style:name",d),e.setAttributeNS(n,"svg:font-family",d),c.rootElement.fontFaceDecls.appendChild(e))};this.createDerivedStyleObject=function(a,d,h){var f=b(a,d);runtime.assert(Boolean(f),"No style element found for '"+
a+"' of family '"+d+"'");a=f.parentNode===c.rootElement.styles?{"style:parent-style-name":a}:e(f);a["style:family"]=d;x.mergeObjects(a,h);return a};this.getDefaultTabStopDistance=function(){for(var a=d("paragraph"),a=a&&a.firstElementChild,c;a;)a.namespaceURI===h&&"paragraph-properties"===a.localName&&(c=a.getAttributeNS(h,"tab-stop-distance")),a=a.nextElementSibling;c||(c="1.25cm");return w.parseNonNegativeLength(c)};this.getMasterPageElement=m;this.getContentSize=function(a,d){var e,f,g,k,l,n,p,
s,q,v;a:{f=b(a,d);runtime.assert("paragraph"===d||"table"===d,"styleFamily must be either paragraph or table");if(f){if(f=f.getAttributeNS(h,"master-page-name"))(e=m(f))||runtime.log("WARN: No master page definition found for "+f);e||(e=m("Standard"));e||(e=c.rootElement.masterStyles.getElementsByTagNameNS(h,"master-page")[0])||runtime.log("WARN: Document has no master pages defined");if(e)for(f=e.getAttributeNS(h,"page-layout-name"),g=u.getElementsByTagNameNS(c.rootElement.automaticStyles,h,"page-layout"),
k=0;k<g.length;k+=1)if(e=g[k],e.getAttributeNS(h,"name")===f)break a}e=null}e||(e=u.getDirectChild(c.rootElement.styles,h,"default-page-layout"));(e=u.getDirectChild(e,h,"page-layout-properties"))?("landscape"===e.getAttributeNS(h,"print-orientation")?(f="29.7cm",g="21.001cm"):(f="21.001cm",g="29.7cm"),f=r(e.getAttributeNS(y,"page-width"),f),g=r(e.getAttributeNS(y,"page-height"),g),k=r(e.getAttributeNS(y,"margin")),void 0===k?(k=r(e.getAttributeNS(y,"margin-left"),"2cm"),l=r(e.getAttributeNS(y,"margin-right"),
"2cm"),n=r(e.getAttributeNS(y,"margin-top"),"2cm"),p=r(e.getAttributeNS(y,"margin-bottom"),"2cm")):k=l=n=p=k,s=r(e.getAttributeNS(y,"padding")),void 0===s?(s=r(e.getAttributeNS(y,"padding-left"),"0cm"),q=r(e.getAttributeNS(y,"padding-right"),"0cm"),v=r(e.getAttributeNS(y,"padding-top"),"0cm"),e=r(e.getAttributeNS(y,"padding-bottom"),"0cm")):s=q=v=e=s):(f=r("21.001cm"),g=r("29.7cm"),k=l=n=p=k=r("2cm"),s=q=v=e=s=r("0cm"));return{width:f-k-l-s-q,height:g-n-p-v-e}}};(function(){var f=odf.Namespaces.stylens,g=odf.Namespaces.textns,d={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"};odf.StyleTreeNode=function(b){this.derivedStyles={};this.element=b};odf.StyleTree=function(b,e){function k(b){var c,a,d,e={};if(!b)return e;for(b=b.firstElementChild;b;){if(a=b.namespaceURI!==f||"style"!==b.localName&&
"default-style"!==b.localName?b.namespaceURI===g&&"list-style"===b.localName?"list":b.namespaceURI!==f||"page-layout"!==b.localName&&"default-page-layout"!==b.localName?void 0:"page":b.getAttributeNS(f,"family"))(c=b.getAttributeNS(f,"name"))||(c=""),e.hasOwnProperty(a)?d=e[a]:e[a]=d={},d[c]=b;b=b.nextElementSibling}return e}function l(b,c){if(b.hasOwnProperty(c))return b[c];var a=null,d=Object.keys(b),e;for(e=0;e<d.length&&!(a=l(b[d[e]].derivedStyles,c));e+=1);return a}function p(b,c,a){var d,e,
g;if(!c.hasOwnProperty(b))return null;d=new odf.StyleTreeNode(c[b]);e=d.element.getAttributeNS(f,"parent-style-name");g=null;e&&(g=l(a,e)||p(e,c,a));g?g.derivedStyles[b]=d:a[b]=d;delete c[b];return d}function q(b,c){b&&Object.keys(b).forEach(function(a){p(a,b,c)})}var m={};this.getStyleTree=function(){return m};(function(){var f,c,a;c=k(b);a=k(e);Object.keys(d).forEach(function(b){f=m[b]={};q(c[b],f);q(a[b],f)})})()}})();(function(){var f=odf.Namespaces.fons,g=odf.Namespaces.stylens,d=odf.Namespaces.textns,b={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"};odf.ListStyleToCss=function(){function e(b){var c=m.parseLength(b);return c?q.convert(c.value,c.unit,"px"):(runtime.log("Could not parse value '"+b+"'."),0)}function k(b,c){try{b.insertRule(c,b.cssRules.length)}catch(a){runtime.log("cannot load rule: "+c+" - "+a)}}function l(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function p(b,
c,a,l){c='text|list[text|style-name="'+c+'"]';var h=a.getAttributeNS(d,"level"),m;m=a.getElementsByTagNameNS(g,"list-level-properties")[0];a=m.getAttributeNS(d,"list-level-position-and-space-mode");for(var p=m.getElementsByTagNameNS(g,"list-level-label-alignment")[0],q,w,u,x,t,h=h&&parseInt(h,10);1<h;)c+=" > text|list-item > text|list",h-=1;h=m.getAttributeNS(f,"text-align")||"left";switch(h){case "end":h="right";break;case "start":h="left"}"label-alignment"===a?(q=p.getAttributeNS(f,"margin-left")||
"0px",x=p.getAttributeNS(f,"text-indent")||"0px",t=p.getAttributeNS(d,"label-followed-by"),p=e(q)):(q=m.getAttributeNS(d,"space-before")||"0px",w=m.getAttributeNS(d,"min-label-width")||"0px",u=m.getAttributeNS(d,"min-label-distance")||"0px",p=e(q)+e(w));m=c+" > text|list-item{";m+="margin-left: "+p+"px;";m+="}";k(b,m);m=c+" > text|list-item > text|list{";m+="margin-left: "+-p+"px;";m+="}";k(b,m);m=c+" > text|list-item > *:not(text|list):first-child:before{";m+="text-align: "+h+";";m+="counter-increment:list;";
m+="display: inline-block;";"label-alignment"===a?(m+="margin-left: "+x+";","space"===t?l+=" '\\a0'":"listtab"===t&&(m+="padding-right: 0.2cm;")):(m+="min-width: "+w+";",m+="margin-left: -"+w+";",m+="padding-right: "+u+";");m+="\n"+l+";\n";m+="}";k(b,m)}var q=new core.CSSUnits,m=new odf.OdfUtils;this.applyListStyles=function(e,c){var a,f;(a=c.list)&&Object.keys(a).forEach(function(c){f=a[c];for(var k=f.element.firstChild,m,q;k;){if(k.namespaceURI===d)if(m=k,"list-level-style-number"===k.localName){var w=
m;q=w.getAttributeNS(g,"num-format");var u=w.getAttributeNS(g,"num-suffix")||"",w=w.getAttributeNS(g,"num-prefix")||"",x="";w&&(x+='"'+l(w)+'"\n');x=b.hasOwnProperty(q)?x+(" counter(list, "+b[q]+")"):q?x+(' "'+q+'"'):x+' ""';q="content:"+x+' "'+l(u)+'"';p(e,c,m,q)}else"list-level-style-image"===k.localName?(q="content: none",p(e,c,m,q)):"list-level-style-bullet"===k.localName&&(q=m.getAttributeNS(d,"bullet-char"),q='content: "'+l(q)+'"',p(e,c,m,q));k=k.nextSibling}})}}})();odf.Style2CSS=function(){function f(a,c,b){var d=[];b=b.derivedStyles;var e;var g=h[a],k;void 0===g?c=null:(k=c?"["+g+'|style-name="'+c+'"]':"","presentation"===g&&(g="draw",k=c?'[presentation|style-name="'+c+'"]':""),c=g+"|"+s[a].join(k+","+g+"|")+k);null!==c&&d.push(c);for(e in b)b.hasOwnProperty(e)&&(c=f(a,e,b[e]),d=d.concat(c));return d}function g(a,c){var b="",d,e,h;for(d=0;d<c.length;d+=1)if(e=c[d],h=a.getAttributeNS(e[0],e[1])){h=h.trim();if(I.hasOwnProperty(e[1])){var f=h.indexOf(" "),g=void 0,
k=void 0;-1!==f?(g=h.substring(0,f),k=h.substring(f)):(g=h,k="");(g=M.parseLength(g))&&"pt"===g.unit&&0.75>g.value&&(h="0.75pt"+k)}e[2]&&(b+=e[2]+":"+h+";")}return b}function d(a){return(a=n.getDirectChild(a,q,"text-properties"))?M.parseFoFontSize(a.getAttributeNS(l,"font-size")):null}function b(a,c,b,d){return c+c+b+b+d+d}function e(h,m,s,I){if("page"===m){var B=I.element;s="";var O,z;z=O="";var S=n.getDirectChild(B,q,"page-layout-properties"),K;if(S)if(K=B.getAttributeNS(q,"name"),s+=g(S,D),(O=
n.getDirectChild(S,q,"background-image"))&&(z=O.getAttributeNS(c,"href"))&&(s=s+("background-image: url('odfkit:"+z+"');")+g(O,y)),"presentation"===T)for(B=(B=n.getDirectChild(B.parentNode.parentNode,p,"master-styles"))&&B.firstElementChild;B;)B.namespaceURI===q&&"master-page"===B.localName&&B.getAttributeNS(q,"page-layout-name")===K&&(z=B.getAttributeNS(q,"name"),O="draw|page[draw|master-page-name="+z+"] {"+s+"}",z="office|body, draw|page[draw|master-page-name="+z+"] {"+g(S,L)+" }",h.insertRule(O,
h.cssRules.length),h.insertRule(z,h.cssRules.length)),B=B.nextElementSibling;else"text"===T&&(O="office|text {"+s+"}",z="office|body {width: "+S.getAttributeNS(l,"page-width")+";}",h.insertRule(O,h.cssRules.length),h.insertRule(z,h.cssRules.length))}else{s=f(m,s,I).join(",");S="";if(K=n.getDirectChild(I.element,q,"text-properties")){z=K;var Y,J,B=Y="";O=1;K=""+g(z,v);J=z.getAttributeNS(q,"text-underline-style");"solid"===J&&(Y+=" underline");J=z.getAttributeNS(q,"text-line-through-style");"solid"===
J&&(Y+=" line-through");Y.length&&(K+="text-decoration:"+Y+";");if(Y=z.getAttributeNS(q,"font-name")||z.getAttributeNS(l,"font-family"))J=P[Y],K+="font-family: "+(J||Y)+";";J=z.parentNode;if(z=d(J)){for(;J;){if(z=d(J)){if("%"!==z.unit){B="font-size: "+z.value*O+z.unit+";";break}O*=z.value/100}z=J;Y=J="";J=null;"default-style"===z.localName?J=null:(J=z.getAttributeNS(q,"parent-style-name"),Y=z.getAttributeNS(q,"family"),J=V.getODFElementsWithXPath(C,J?"//style:*[@style:name='"+J+"'][@style:family='"+
Y+"']":"//style:default-style[@style:family='"+Y+"']",odf.Namespaces.lookupNamespaceURI)[0])}B||(B="font-size: "+parseFloat(Q)*O+F.getUnits(Q)+";");K+=B}S+=K}if(K=n.getDirectChild(I.element,q,"paragraph-properties"))B=K,K=""+g(B,w),(O=n.getDirectChild(B,q,"background-image"))&&(z=O.getAttributeNS(c,"href"))&&(K=K+("background-image: url('odfkit:"+z+"');")+g(O,y)),(B=B.getAttributeNS(l,"line-height"))&&"normal"!==B&&(B=M.parseFoLineHeight(B),K="%"!==B.unit?K+("line-height: "+B.value+B.unit+";"):K+
("line-height: "+B.value/100+";")),S+=K;if(K=n.getDirectChild(I.element,q,"graphic-properties"))z=K,K=""+g(z,u),B=z.getAttributeNS(k,"opacity"),O=z.getAttributeNS(k,"fill"),z=z.getAttributeNS(k,"fill-color"),"solid"===O||"hatch"===O?z&&"none"!==z?(B=isNaN(parseFloat(B))?1:parseFloat(B)/100,O=z.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,b),(z=(O=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(O))?{r:parseInt(O[1],16),g:parseInt(O[2],16),b:parseInt(O[3],16)}:null)&&(K+="background-color: rgba("+z.r+
","+z.g+","+z.b+","+B+");")):K+="background: none;":"none"===O&&(K+="background: none;"),S+=K;if(K=n.getDirectChild(I.element,q,"drawing-page-properties"))B=""+g(K,u),"true"===K.getAttributeNS(a,"background-visible")&&(B+="background: none;"),S+=B;if(K=n.getDirectChild(I.element,q,"table-cell-properties"))K=""+g(K,x),S+=K;if(K=n.getDirectChild(I.element,q,"table-row-properties"))K=""+g(K,E),S+=K;if(K=n.getDirectChild(I.element,q,"table-column-properties"))K=""+g(K,t),S+=K;if(K=n.getDirectChild(I.element,
q,"table-properties"))B=K,K=""+g(B,A),B=B.getAttributeNS(r,"border-model"),"collapsing"===B?K+="border-collapse:collapse;":"separating"===B&&(K+="border-collapse:separate;"),S+=K;0!==S.length&&h.insertRule(s+"{"+S+"}",h.cssRules.length)}for(var X in I.derivedStyles)I.derivedStyles.hasOwnProperty(X)&&e(h,m,X,I.derivedStyles[X])}var k=odf.Namespaces.drawns,l=odf.Namespaces.fons,p=odf.Namespaces.officens,q=odf.Namespaces.stylens,m=odf.Namespaces.svgns,r=odf.Namespaces.tablens,c=odf.Namespaces.xlinkns,
a=odf.Namespaces.presentationns,n=new core.DomUtils,h={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"},s={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),
presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background",
"table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),
list:["list-item"]},v=[[l,"color","color"],[l,"background-color","background-color"],[l,"font-weight","font-weight"],[l,"font-style","font-style"]],y=[[q,"repeat","background-repeat"]],w=[[l,"background-color","background-color"],[l,"text-align","text-align"],[l,"text-indent","text-indent"],[l,"padding","padding"],[l,"padding-left","padding-left"],[l,"padding-right","padding-right"],[l,"padding-top","padding-top"],[l,"padding-bottom","padding-bottom"],[l,"border-left","border-left"],[l,"border-right",
"border-right"],[l,"border-top","border-top"],[l,"border-bottom","border-bottom"],[l,"margin","margin"],[l,"margin-left","margin-left"],[l,"margin-right","margin-right"],[l,"margin-top","margin-top"],[l,"margin-bottom","margin-bottom"],[l,"border","border"]],u=[[l,"background-color","background-color"],[l,"min-height","min-height"],[k,"stroke","border"],[m,"stroke-color","border-color"],[m,"stroke-width","border-width"],[l,"border","border"],[l,"border-left","border-left"],[l,"border-right","border-right"],
[l,"border-top","border-top"],[l,"border-bottom","border-bottom"]],x=[[l,"background-color","background-color"],[l,"border-left","border-left"],[l,"border-right","border-right"],[l,"border-top","border-top"],[l,"border-bottom","border-bottom"],[l,"border","border"]],t=[[q,"column-width","width"]],E=[[q,"row-height","height"],[l,"keep-together",null]],A=[[q,"width","width"],[l,"margin-left","margin-left"],[l,"margin-right","margin-right"],[l,"margin-top","margin-top"],[l,"margin-bottom","margin-bottom"]],
D=[[l,"background-color","background-color"],[l,"padding","padding"],[l,"padding-left","padding-left"],[l,"padding-right","padding-right"],[l,"padding-top","padding-top"],[l,"padding-bottom","padding-bottom"],[l,"border","border"],[l,"border-left","border-left"],[l,"border-right","border-right"],[l,"border-top","border-top"],[l,"border-bottom","border-bottom"],[l,"margin","margin"],[l,"margin-left","margin-left"],[l,"margin-right","margin-right"],[l,"margin-top","margin-top"],[l,"margin-bottom","margin-bottom"]],
L=[[l,"page-width","width"],[l,"page-height","height"]],I={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,"stroke-width":!0},P={},M=new odf.OdfUtils,T,C,Q,V=xmldom.XPath,F=new core.CSSUnits;this.style2css=function(a,c,b,d,f){var g,k,l;for(C=c;b.cssRules.length;)b.deleteRule(b.cssRules.length-1);odf.Namespaces.forEachPrefix(function(a,c){g="@namespace "+a+" url("+c+");";try{b.insertRule(g,b.cssRules.length)}catch(d){}});P=d;T=a;Q=runtime.getWindow().getComputedStyle(document.body,
null).getPropertyValue("font-size")||"12pt";for(l in h)if(h.hasOwnProperty(l))for(k in a=f[l],a)a.hasOwnProperty(k)&&e(b,l,k,a[k])}};(function(){function f(g,d){var b=this;this.getDistance=function(d){var f=b.x-d.x;d=b.y-d.y;return Math.sqrt(f*f+d*d)};this.getCenter=function(d){return new f((b.x+d.x)/2,(b.y+d.y)/2)};b.x=g;b.y=d}gui.ZoomHelper=function(){function g(c,b,d,e){c=e?"translate3d("+c+"px, "+b+"px, 0) scale3d("+d+", "+d+", 1)":"translate("+c+"px, "+b+"px) scale("+d+")";a.style.WebkitTransform=c;a.style.MozTransform=c;a.style.msTransform=c;a.style.OTransform=c;a.style.transform=c}function d(a){a?g(-n.x,-n.y,v,!0):(g(0,
0,v,!0),g(0,0,v,!1))}function b(a){if(u&&D){var c=u.style.overflow,b=u.classList.contains("webodf-customScrollbars");a&&b||!a&&!b||(a?(u.classList.add("webodf-customScrollbars"),u.style.overflow="hidden",runtime.requestAnimationFrame(function(){u.style.overflow=c})):u.classList.remove("webodf-customScrollbars"))}}function e(){g(-n.x,-n.y,v,!0);u.scrollLeft=0;u.scrollTop=0;L=x.style.overflow;x.style.overflow="visible";b(!1)}function k(){g(0,0,v,!0);u.scrollLeft=n.x;u.scrollTop=n.y;x.style.overflow=
L||"";b(!0)}function l(c){return new f(c.pageX-a.offsetLeft,c.pageY-a.offsetTop)}function p(c){h&&(n.x-=c.x-h.x,n.y-=c.y-h.y,n=new f(Math.min(Math.max(n.x,a.offsetLeft),(a.offsetLeft+a.offsetWidth)*v-u.clientWidth),Math.min(Math.max(n.y,a.offsetTop),(a.offsetTop+a.offsetHeight)*v-u.clientHeight)));h=c}function q(a){var c=a.touches.length,b=0<c?l(a.touches[0]):null;a=1<c?l(a.touches[1]):null;b&&a?(s=b.getDistance(a),y=v,h=b.getCenter(a),e(),A=E.PINCH):b&&(h=b,A=E.SCROLL)}function m(c){var b=c.touches.length,
h=0<b?l(c.touches[0]):null,b=1<b?l(c.touches[1]):null;if(h&&b)if(c.preventDefault(),A===E.SCROLL)A=E.PINCH,e(),s=h.getDistance(b);else{c=h.getCenter(b);h=h.getDistance(b)/s;p(c);var b=v,f=Math.min(w,a.offsetParent.clientWidth/a.offsetWidth);v=y*h;v=Math.min(Math.max(v,f),w);h=v/b;n.x+=(h-1)*(c.x+n.x);n.y+=(h-1)*(c.y+n.y);d(!0)}else h&&(A===E.PINCH?(A=E.SCROLL,k()):p(h))}function r(){A===E.PINCH&&(t.emit(gui.ZoomHelper.signalZoomChanged,v),k(),d(!1));A=E.NONE}function c(){u&&(u.removeEventListener("touchstart",
q,!1),u.removeEventListener("touchmove",m,!1),u.removeEventListener("touchend",r,!1))}var a,n,h,s,v,y,w=4,u,x,t=new core.EventNotifier([gui.ZoomHelper.signalZoomChanged]),E={NONE:0,SCROLL:1,PINCH:2},A=E.NONE,D=runtime.getWindow().hasOwnProperty("ontouchstart"),L="";this.subscribe=function(a,c){t.subscribe(a,c)};this.unsubscribe=function(a,c){t.unsubscribe(a,c)};this.getZoomLevel=function(){return v};this.setZoomLevel=function(c){a&&(v=c,d(!1),t.emit(gui.ZoomHelper.signalZoomChanged,v))};this.destroy=
function(a){c();b(!1);a()};this.setZoomableElement=function(e){c();a=e;u=a.offsetParent;x=a.parentElement;d(!1);u&&(u.addEventListener("touchstart",q,!1),u.addEventListener("touchmove",m,!1),u.addEventListener("touchend",r,!1));b(!0)};y=v=1;n=new f(0,0)};gui.ZoomHelper.signalZoomChanged="zoomChanged"})();ops.Canvas=function(){};ops.Canvas.prototype.getZoomLevel=function(){};ops.Canvas.prototype.getElement=function(){};ops.Canvas.prototype.getSizer=function(){};ops.Canvas.prototype.getZoomHelper=function(){};(function(){function f(){function a(d){b=!0;runtime.setTimeout(function(){try{d()}catch(e){runtime.log(String(e))}b=!1;0<c.length&&a(c.pop())},10)}var c=[],b=!1;this.clearQueue=function(){c.length=0};this.addToQueue=function(d){if(0===c.length&&!b)return a(d);c.push(d)}}function g(a){function c(){for(;0<b.cssRules.length;)b.deleteRule(0);b.insertRule("#shadowContent draw|page {display:none;}",0);b.insertRule("office|presentation draw|page {display:none;}",1);b.insertRule("#shadowContent draw|page:nth-of-type("+
d+") {display:block;}",2);b.insertRule("office|presentation draw|page:nth-of-type("+d+") {display:block;}",3)}var b=a.sheet,d=1;this.showFirstPage=function(){d=1;c()};this.showNextPage=function(){d+=1;c()};this.showPreviousPage=function(){1<d&&(d-=1,c())};this.showPage=function(a){0<a&&(d=a,c())};this.css=a;this.destroy=function(c){a.parentNode.removeChild(a);c()}}function d(a){for(;a.firstChild;)a.removeChild(a.firstChild)}function b(a){a=a.sheet;for(var c=a.cssRules;c.length;)a.deleteRule(c.length-
1)}function e(a,c,b){var d=new odf.Style2CSS,e=new odf.ListStyleToCss;b=b.sheet;var h=(new odf.StyleTree(a.rootElement.styles,a.rootElement.automaticStyles)).getStyleTree();d.style2css(a.getDocumentType(),a.rootElement,b,c.getFontMap(),h);e.applyListStyles(b,h)}function k(a,c){(new odf.FontLoader).loadFonts(a,c.sheet)}function l(a,c,b){var d=null;a=a.rootElement.body.getElementsByTagNameNS(T,b+"-decl");b=c.getAttributeNS(T,"use-"+b+"-name");var e;if(b&&0<a.length)for(c=0;c<a.length;c+=1)if(e=a[c],
e.getAttributeNS(T,"name")===b){d=e.textContent;break}return d}function p(a,c,b,e){var h=a.ownerDocument;c=a.getElementsByTagNameNS(c,b);for(a=0;a<c.length;a+=1)d(c[a]),e&&(b=c[a],b.appendChild(h.createTextNode(e)))}function q(a,c,b){c.setAttributeNS("urn:webodf:names:helper","styleid",a);var d,e=c.getAttributeNS(I,"anchor-type"),h=c.getAttributeNS(D,"x"),f=c.getAttributeNS(D,"y"),g=c.getAttributeNS(D,"width"),k=c.getAttributeNS(D,"height"),l=c.getAttributeNS(t,"min-height"),n=c.getAttributeNS(t,
"min-width");if("as-char"===e)d="display: inline-block;";else if(e||h||f)d="position: absolute;";else if(g||k||l||n)d="display: block;";h&&(d+="left: "+h+";");f&&(d+="top: "+f+";");g&&(d+="width: "+g+";");k&&(d+="height: "+k+";");l&&(d+="min-height: "+l+";");n&&(d+="min-width: "+n+";");d&&(d="draw|"+c.localName+'[webodfhelper|styleid="'+a+'"] {'+d+"}",b.insertRule(d,b.cssRules.length))}function m(a){for(a=a.firstChild;a;){if(a.namespaceURI===E&&"binary-data"===a.localName)return"data:image/png;base64,"+
a.textContent.replace(/[\r\n\s]/g,"");a=a.nextSibling}return""}function r(a,c,b,d){function e(c){c&&(c='draw|image[webodfhelper|styleid="'+a+'"] {'+("background-image: url("+c+");")+"}",d.insertRule(c,d.cssRules.length))}function h(a){e(a.url)}b.setAttributeNS("urn:webodf:names:helper","styleid",a);var f=b.getAttributeNS(P,"href"),g;if(f)try{g=c.getPart(f),g.onchange=h,g.load()}catch(k){runtime.log("slight problem: "+String(k))}else f=m(b),e(f)}function c(a){var c=a.ownerDocument;F.getElementsByTagNameNS(a,
I,"line-break").forEach(function(a){a.hasChildNodes()||a.appendChild(c.createElement("br"))})}function a(a){var c=a.ownerDocument;F.getElementsByTagNameNS(a,I,"s").forEach(function(a){for(var b,d;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(c.createTextNode(" "));d=parseInt(a.getAttributeNS(I,"c"),10);if(1<d)for(a.removeAttributeNS(I,"c"),b=1;b<d;b+=1)a.parentNode.insertBefore(a.cloneNode(!0),a)})}function n(a){F.getElementsByTagNameNS(a,I,"tab").forEach(function(a){a.textContent="\t"})}
function h(a,c){function b(a,d){var f=g.documentElement.namespaceURI;"video/"===d.substr(0,6)?(e=g.createElementNS(f,"video"),e.setAttribute("controls","controls"),h=g.createElementNS(f,"source"),a&&h.setAttribute("src",a),h.setAttribute("type",d),e.appendChild(h),c.parentNode.appendChild(e)):c.innerHtml="Unrecognised Plugin"}function d(a){b(a.url,a.mimetype)}var e,h,f,g=c.ownerDocument,k;if(f=c.getAttributeNS(P,"href"))try{k=a.getPart(f),k.onchange=d,k.load()}catch(l){runtime.log("slight problem: "+
String(l))}else runtime.log("using MP4 data fallback"),f=m(c),b(f,"video/mp4")}function s(a,c){try{a.insertRule(c,a.cssRules.length)}catch(b){runtime.log("cannot load rule: "+c+" - "+b)}}function v(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function y(a){var c=a.getElementsByTagName("head")[0],b,d;b=a.styleSheets.length;for(d=c.firstElementChild;d&&("style"!==d.localName||!d.hasAttribute("webodfcss"));)d=d.nextElementSibling;if(d)return b=parseInt(d.getAttribute("webodfcss"),10),d.setAttribute("webodfcss",
b+1),d;"string"===String(typeof webodf_css)?b=webodf_css:(d="webodf.css",runtime.currentDirectory&&(d=runtime.currentDirectory(),0<d.length&&"/"!==d.substr(-1)&&(d+="/"),d+="../webodf.css"),b=runtime.readFileSync(d,"utf-8"));d=a.createElementNS(c.namespaceURI,"style");d.setAttribute("media","screen, print, handheld, projection");d.setAttribute("type","text/css");d.setAttribute("webodfcss","1");d.appendChild(a.createTextNode(b));c.appendChild(d);return d}function w(a){var c=parseInt(a.getAttribute("webodfcss"),
10);1===c?a.parentNode.removeChild(a):a.setAttribute("count",c-1)}function u(a){var c=a.getElementsByTagName("head")[0],b=a.createElementNS(c.namespaceURI,"style"),d="";b.setAttribute("type","text/css");b.setAttribute("media","screen, print, handheld, projection");odf.Namespaces.forEachPrefix(function(a,c){d+="@namespace "+a+" url("+c+");\n"});d+="@namespace webodfhelper url(urn:webodf:names:helper);\n";b.appendChild(a.createTextNode(d));c.appendChild(b);return b}var x=odf.Namespaces.drawns,t=odf.Namespaces.fons,
E=odf.Namespaces.officens,A=odf.Namespaces.stylens,D=odf.Namespaces.svgns,L=odf.Namespaces.tablens,I=odf.Namespaces.textns,P=odf.Namespaces.xlinkns,M=odf.Namespaces.xmlns,T=odf.Namespaces.presentationns,C=runtime.getWindow(),Q=xmldom.XPath,V=new odf.OdfUtils,F=new core.DomUtils;odf.OdfCanvas=function(m){function D(a,c,b){function d(a,c,b,e){la.addToQueue(function(){r(a,c,b,e)})}var e,h;e=c.getElementsByTagNameNS(x,"image");for(c=0;c<e.length;c+=1)h=e.item(c),d("image"+String(c),a,h,b)}function P(a,
c){function b(a,c){la.addToQueue(function(){h(a,c)})}var d,e,f;e=c.getElementsByTagNameNS(x,"plugin");for(d=0;d<e.length;d+=1)f=e.item(d),b(a,f)}function t(){var a;a=Z.firstChild;var c=ea.getZoomLevel();a&&(Z.style.WebkitTransformOrigin="0% 0%",Z.style.MozTransformOrigin="0% 0%",Z.style.msTransformOrigin="0% 0%",Z.style.OTransformOrigin="0% 0%",Z.style.transformOrigin="0% 0%",ba&&((a=ba.getMinimumHeightForAnnotationPane())?Z.style.minHeight=a:Z.style.removeProperty("min-height")),m.style.width=Math.round(c*
Z.offsetWidth)+"px",m.style.height=Math.round(c*Z.offsetHeight)+"px",m.style.display="inline-block")}function B(b,e){var h=ja.sheet;d(m);Z=Y.createElementNS(m.namespaceURI,"div");Z.style.display="inline-block";Z.style.background="white";Z.style.setProperty("float","left","important");Z.appendChild(e);m.appendChild(Z);$=Y.createElementNS(m.namespaceURI,"div");$.id="annotationsPane";fa=Y.createElementNS(m.namespaceURI,"div");fa.id="shadowContent";fa.style.position="absolute";fa.style.top=0;fa.style.left=
0;b.getContentElement().appendChild(fa);var f=e.body,g,k=[],r;for(g=f.firstElementChild;g&&g!==f;)if(g.namespaceURI===x&&(k[k.length]=g),g.firstElementChild)g=g.firstElementChild;else{for(;g&&g!==f&&!g.nextElementSibling;)g=g.parentNode;g&&g.nextElementSibling&&(g=g.nextElementSibling)}for(r=0;r<k.length;r+=1)g=k[r],q("frame"+String(r),g,h);k=Q.getODFElementsWithXPath(f,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.lookupNamespaceURI);for(g=0;g<k.length;g+=1)f=k[g],f.setAttributeNS&&f.setAttributeNS("urn:webodf:names:helper",
"containsparagraphanchor",!0);f=X;g=fa;var y,t,w,u;u=0;var z,F;r=b.rootElement.ownerDocument;if((k=e.body.firstElementChild)&&k.namespaceURI===E&&("presentation"===k.localName||"drawing"===k.localName))for(k=k.firstElementChild;k;){if(y=(y=k.getAttributeNS(x,"master-page-name"))?f.getMasterPageElement(y):null){t=k.getAttributeNS("urn:webodf:names:helper","styleid");w=r.createElementNS(x,"draw:page");F=y.firstElementChild;for(z=0;F;)"true"!==F.getAttributeNS(T,"placeholder")&&(u=F.cloneNode(!0),w.appendChild(u),
q(t+"_"+z,u,h)),F=F.nextElementSibling,z+=1;F=z=u=void 0;var S=w.getElementsByTagNameNS(x,"frame");for(u=0;u<S.length;u+=1)z=S[u],(F=z.getAttributeNS(T,"class"))&&!/^(date-time|footer|header|page-number)$/.test(F)&&z.parentNode.removeChild(z);g.appendChild(w);u=String(g.getElementsByTagNameNS(x,"page").length);p(w,I,"page-number",u);p(w,T,"header",l(b,k,"header"));p(w,T,"footer",l(b,k,"footer"));q(t,w,h);w.setAttributeNS(x,"draw:master-page-name",y.getAttributeNS(A,"name"))}k=k.nextElementSibling}f=
m.namespaceURI;k=e.body.getElementsByTagNameNS(L,"table-cell");for(g=0;g<k.length;g+=1)r=k.item(g),r.hasAttributeNS(L,"number-columns-spanned")&&r.setAttributeNS(f,"colspan",r.getAttributeNS(L,"number-columns-spanned")),r.hasAttributeNS(L,"number-rows-spanned")&&r.setAttributeNS(f,"rowspan",r.getAttributeNS(L,"number-rows-spanned"));c(e.body);a(e.body);n(e.body);D(b,e.body,h);P(b,e.body);y=e.body;f=m.namespaceURI;k={};r={};var B;t=C.document.getElementsByTagNameNS(I,"list-style");for(g=0;g<t.length;g+=
1)z=t.item(g),(F=z.getAttributeNS(A,"name"))&&(r[F]=z);y=y.getElementsByTagNameNS(I,"list");for(g=0;g<y.length;g+=1)if(z=y.item(g),t=z.getAttributeNS(M,"id")){w=z.getAttributeNS(I,"continue-list");z.setAttributeNS(f,"id",t);u="text|list#"+t+" > text|list-item > *:first-child:before {";if(F=z.getAttributeNS(I,"style-name")){z=r[F];B=V.getFirstNonWhitespaceChild(z);z=void 0;if(B)if("list-level-style-number"===B.localName){F=B;B=F.getAttributeNS(A,"num-format");z=F.getAttributeNS(A,"num-suffix")||"";
F=F.getAttributeNS(A,"num-prefix")||"";var S="",S={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"},K=void 0;F&&(K='"'+v(F)+'"\n');K=S.hasOwnProperty(B)?K+(" counter(list, "+S[B]+")"):B?K+("'"+B+"';"):K+' ""';z&&(K+=' "'+v(z)+'"');z=S="content:"+K+";"}else"list-level-style-image"===B.localName?z="content: none;":"list-level-style-bullet"===B.localName&&(B=B.getAttributeNS(I,"bullet-char"),z='content: "'+v(B)+'"\n;');B=z;B="\n"+B+"\n"}if(w){for(z=k[w];z;)z=k[z];u+="counter-increment:"+
w+";";B?(B=B.replace("list",w),u+=B):u+="content:counter("+w+");"}else w="",B?(B=B.replace("list",t),u+=B):u+="content: counter("+t+");",u+="counter-increment:"+t+";",s(h,"text|list#"+t+" {counter-reset:"+t+"}");u+="}";k[t]=w;u&&s(h,u)}Z.insertBefore(fa,Z.firstChild);ea.setZoomableElement(Z)}function O(a){N?($.parentNode||Z.appendChild($),ba&&ba.forgetAnnotations(),ba=new gui.AnnotationViewManager(K,a.body,$,na),F.getElementsByTagNameNS(a.body,E,"annotation").forEach(ba.addAnnotation),ba.rerenderAnnotations(),
t()):$.parentNode&&(Z.removeChild($),ba.forgetAnnotations(),t())}function z(a){function c(){b(da);b(qa);b(ja);d(m);m.style.display="inline-block";var h=J.rootElement;m.ownerDocument.importNode(h,!0);X.setOdfContainer(J);k(J,da);e(J,X,qa);B(J,h);O(h);a||la.addToQueue(function(){var a=[J];if(ka.hasOwnProperty("statereadychange")){var c=ka.statereadychange,b;for(b=0;b<c.length;b+=1)c[b].apply(null,a)}})}J.state===odf.OdfContainer.DONE?c():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),
oa=runtime.setTimeout(function H(){J.state===odf.OdfContainer.DONE?c():(runtime.log("will be back later..."),oa=runtime.setTimeout(H,500))},100))}function S(a){la.clearQueue();m.innerHTML=runtime.tr("Loading")+" "+a+"...";m.removeAttribute("style");J=new odf.OdfContainer(a,function(a){J=a;z(!1)})}runtime.assert(null!==m&&void 0!==m,"odf.OdfCanvas constructor needs DOM element");runtime.assert(null!==m.ownerDocument&&void 0!==m.ownerDocument,"odf.OdfCanvas constructor needs DOM");var K=this,Y=m.ownerDocument,
J,X=new odf.Formatting,aa,Z=null,$=null,N=!1,na=!1,ba=null,ca,da,qa,ja,fa,ka={},oa,pa,ia=!1,ma=!1,la=new f,ea=new gui.ZoomHelper;this.refreshCSS=function(){ia=!0;pa.trigger()};this.refreshSize=function(){pa.trigger()};this.odfContainer=function(){return J};this.setOdfContainer=function(a,c){J=a;z(!0===c)};this.load=this.load=S;this.save=function(a){J.save(a)};this.addListener=function(a,c){switch(a){case "click":var b=m,d=a;b.addEventListener?b.addEventListener(d,c,!1):b.attachEvent?b.attachEvent("on"+
d,c):b["on"+d]=c;break;default:b=ka.hasOwnProperty(a)?ka[a]:ka[a]=[],c&&-1===b.indexOf(c)&&b.push(c)}};this.getFormatting=function(){return X};this.getAnnotationViewManager=function(){return ba};this.refreshAnnotations=function(){O(J.rootElement)};this.rerenderAnnotations=function(){ba&&(ma=!0,pa.trigger())};this.getSizer=function(){return Z};this.enableAnnotations=function(a,c){a!==N&&(N=a,na=c,J&&O(J.rootElement))};this.addAnnotation=function(a){ba&&(ba.addAnnotation(a),t())};this.forgetAnnotations=
function(){ba&&(ba.forgetAnnotations(),t())};this.getZoomHelper=function(){return ea};this.setZoomLevel=function(a){ea.setZoomLevel(a)};this.getZoomLevel=function(){return ea.getZoomLevel()};this.fitToContainingElement=function(a,c){var b=ea.getZoomLevel(),d=m.offsetHeight/b,b=a/(m.offsetWidth/b);c/d<b&&(b=c/d);ea.setZoomLevel(b)};this.fitToWidth=function(a){var c=m.offsetWidth/ea.getZoomLevel();ea.setZoomLevel(a/c)};this.fitSmart=function(a,c){var b,d;d=ea.getZoomLevel();b=m.offsetWidth/d;d=m.offsetHeight/
d;b=a/b;void 0!==c&&c/d<b&&(b=c/d);ea.setZoomLevel(Math.min(1,b))};this.fitToHeight=function(a){var c=m.offsetHeight/ea.getZoomLevel();ea.setZoomLevel(a/c)};this.showFirstPage=function(){aa.showFirstPage()};this.showNextPage=function(){aa.showNextPage()};this.showPreviousPage=function(){aa.showPreviousPage()};this.showPage=function(a){aa.showPage(a);t()};this.getElement=function(){return m};this.addCssForFrameWithImage=function(a){var c=a.getAttributeNS(x,"name"),b=a.firstElementChild;q(c,a,ja.sheet);
b&&r(c+"img",J,b,ja.sheet)};this.destroy=function(a){var c=Y.getElementsByTagName("head")[0],b=[aa.destroy,pa.destroy];runtime.clearTimeout(oa);$&&$.parentNode&&$.parentNode.removeChild($);ea.destroy(function(){Z&&(m.removeChild(Z),Z=null)});w(ca);c.removeChild(da);c.removeChild(qa);c.removeChild(ja);core.Async.destroyAll(b,a)};ca=y(Y);aa=new g(u(Y));da=u(Y);qa=u(Y);ja=u(Y);pa=core.Task.createRedrawTask(function(){ia&&(e(J,X,qa),ia=!1);ma&&(ba&&ba.rerenderAnnotations(),ma=!1);t()});ea.subscribe(gui.ZoomHelper.signalZoomChanged,
t)}})();odf.StepUtils=function(){this.getContentBounds=function(f){var g=f.container(),d,b;runtime.assert(f.isStep(),"Step iterator must be on a step");g.nodeType===Node.TEXT_NODE&&0<f.offset()?d=f.offset():(g=f.leftNode())&&g.nodeType===Node.TEXT_NODE&&(d=g.length);g&&(g.nodeType===Node.TEXT_NODE?(runtime.assert(0<d,"Empty text node found"),b={container:g,startOffset:d-1,endOffset:d}):b={container:g,startOffset:0,endOffset:g.childNodes.length});return b}};ops.MemberProperties=function(){};
ops.Member=function(f,g){var d=new ops.MemberProperties;this.getMemberId=function(){return f};this.getProperties=function(){return d};this.setProperties=function(b){Object.keys(b).forEach(function(e){d[e]=b[e]})};this.removeProperties=function(b){Object.keys(b).forEach(function(b){"fullName"!==b&&"color"!==b&&"imageUrl"!==b&&d.hasOwnProperty(b)&&delete d[b]})};runtime.assert(Boolean(f),"No memberId was supplied!");g.fullName||(g.fullName=runtime.tr("Unknown Author"));g.color||(g.color="black");g.imageUrl||
(g.imageUrl="avatar-joe.png");d=g};gui.SelectionMover=function(f,g){function d(){r.setUnfilteredPosition(f.getNode(),0);return r}function b(a,c){var b,d=null;a&&0<a.length&&(b=c?a.item(a.length-1):a.item(0));b&&(d={top:b.top,left:c?b.right:b.left,bottom:b.bottom});return d}function e(a,c,d,f){var k=a.nodeType;d.setStart(a,c);d.collapse(!f);f=b(d.getClientRects(),!0===f);!f&&0<c&&(d.setStart(a,c-1),d.setEnd(a,c),f=b(d.getClientRects(),!0));f||(k===Node.ELEMENT_NODE&&0<c&&a.childNodes.length>=c?f=e(a,c-1,d,!0):a.nodeType===Node.TEXT_NODE&&
0<c?f=e(a,c-1,d,!0):a.previousSibling?f=e(a.previousSibling,a.previousSibling.nodeType===Node.TEXT_NODE?a.previousSibling.textContent.length:a.previousSibling.childNodes.length,d,!0):a.parentNode&&a.parentNode!==g?f=e(a.parentNode,0,d,!1):(d.selectNode(g),f=b(d.getClientRects(),!1)));runtime.assert(Boolean(f),"No visible rectangle found");return f}function k(a,b,e){for(var f=d(),g=new core.LoopWatchDog(1E4),k=0,l=0;0<a&&f.nextPosition();)g.check(),e.acceptPosition(f)===c&&(k+=1,b.acceptPosition(f)===
c&&(l+=k,k=0,a-=1));return l}function l(a,b,e){for(var f=d(),g=new core.LoopWatchDog(1E4),k=0,l=0;0<a&&f.previousPosition();)g.check(),e.acceptPosition(f)===c&&(k+=1,b.acceptPosition(f)===c&&(l+=k,k=0,a-=1));return l}function p(a,b){var h=d(),f=0,k=0,l=0>a?-1:1;for(a=Math.abs(a);0<a;){for(var m=b,p=l,r=h,q=r.container(),E=0,A=null,D=void 0,L=10,I=void 0,P=0,M=void 0,T=void 0,C=void 0,I=void 0,Q=g.ownerDocument.createRange(),V=new core.LoopWatchDog(1E4),I=e(q,r.unfilteredDomOffset(),Q),M=I.top,T=I.left,
C=M;!0===(0>p?r.previousPosition():r.nextPosition());)if(V.check(),m.acceptPosition(r)===c&&(E+=1,q=r.container(),I=e(q,r.unfilteredDomOffset(),Q),I.top!==M)){if(I.top!==C&&C!==M)break;C=I.top;I=Math.abs(T-I.left);if(null===A||I<L)A=q,D=r.unfilteredDomOffset(),L=I,P=E}null!==A?(r.setUnfilteredPosition(A,D),E=P):E=0;Q.detach();f+=E;if(0===f)break;k+=f;a-=1}return k*l}function q(a,b){var h,f,k,l,p=d(),r=m.getParagraphElement(p.getCurrentNode()),q=0,t=g.ownerDocument.createRange();0>a?(h=p.previousPosition,
f=-1):(h=p.nextPosition,f=1);for(k=e(p.container(),p.unfilteredDomOffset(),t);h.call(p);)if(b.acceptPosition(p)===c){if(m.getParagraphElement(p.getCurrentNode())!==r)break;l=e(p.container(),p.unfilteredDomOffset(),t);if(l.bottom!==k.bottom&&(k=l.top>=k.top&&l.bottom<k.bottom||l.top<=k.top&&l.bottom>k.bottom,!k))break;q+=f;k=l}t.detach();return q}var m=new odf.OdfUtils,r,c=core.PositionFilter.FilterResult.FILTER_ACCEPT;this.getStepCounter=function(){return{convertForwardStepsBetweenFilters:k,convertBackwardStepsBetweenFilters:l,
countLinesSteps:p,countStepsToLineBoundary:q}};(function(){r=gui.SelectionMover.createPositionIterator(g);var a=g.ownerDocument.createRange();a.setStart(r.container(),r.unfilteredDomOffset());a.collapse(!0);f.setSelectedRange(a)})()};
gui.SelectionMover.createPositionIterator=function(f){var g=new function(){this.acceptNode=function(d){return d&&"urn:webodf:names:cursor"!==d.namespaceURI&&"urn:webodf:names:editinfo"!==d.namespaceURI?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}};return new core.PositionIterator(f,5,g,!1)};ops.Document=function(){};ops.Document.prototype.getMemberIds=function(){};ops.Document.prototype.removeCursor=function(f){};ops.Document.prototype.getDocumentElement=function(){};ops.Document.prototype.getRootNode=function(){};ops.Document.prototype.getDOMDocument=function(){};ops.Document.prototype.cloneDocumentElement=function(){};ops.Document.prototype.setDocumentElement=function(f){};ops.Document.prototype.subscribe=function(f,g){};ops.Document.prototype.unsubscribe=function(f,g){};
ops.Document.prototype.getCanvas=function(){};ops.Document.prototype.createRootFilter=function(f){};ops.Document.signalCursorAdded="cursor/added";ops.Document.signalCursorRemoved="cursor/removed";ops.Document.signalCursorMoved="cursor/moved";ops.Document.signalMemberAdded="member/added";ops.Document.signalMemberUpdated="member/updated";ops.Document.signalMemberRemoved="member/removed";ops.OdtCursor=function(f,g){var d=this,b={},e,k,l,p=new core.EventNotifier([ops.OdtCursor.signalCursorUpdated]);this.removeFromDocument=function(){l.remove()};this.subscribe=function(b,d){p.subscribe(b,d)};this.unsubscribe=function(b,d){p.unsubscribe(b,d)};this.getStepCounter=function(){return k.getStepCounter()};this.getMemberId=function(){return f};this.getNode=function(){return l.getNode()};this.getAnchorNode=function(){return l.getAnchorNode()};this.getSelectedRange=function(){return l.getSelectedRange()};
this.setSelectedRange=function(b,e){l.setSelectedRange(b,e);p.emit(ops.OdtCursor.signalCursorUpdated,d)};this.hasForwardSelection=function(){return l.hasForwardSelection()};this.getDocument=function(){return g};this.getSelectionType=function(){return e};this.setSelectionType=function(d){b.hasOwnProperty(d)?e=d:runtime.log("Invalid selection type: "+d)};this.resetSelectionType=function(){d.setSelectionType(ops.OdtCursor.RangeSelection)};l=new core.Cursor(g.getDOMDocument(),f);k=new gui.SelectionMover(l,
g.getRootNode());b[ops.OdtCursor.RangeSelection]=!0;b[ops.OdtCursor.RegionSelection]=!0;d.resetSelectionType()};ops.OdtCursor.RangeSelection="Range";ops.OdtCursor.RegionSelection="Region";ops.OdtCursor.signalCursorUpdated="cursorUpdated";(function(){var f=0;ops.StepsCache=function(g,d,b){function e(a,c){var d=this;this.nodeId=a;this.steps=-1;this.node=c;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(a){a.setPositionBeforeElement(c);b(d.steps,a)}}function k(a,c,d){var e=this;this.nodeId=a;this.steps=c;this.node=d;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(a){a.setUnfilteredPosition(d,0);b(e.steps,a)}}function l(a,c){var b="["+a.nodeId;c&&(b+=" => "+c.nodeId);return b+
"]"}function p(){for(var a=y,c,b,d,e=new core.LoopWatchDog(0,1E5),f={};a;){e.check();(c=a.previousBookmark)?runtime.assert(c.nextBookmark===a,"Broken bookmark link to previous @"+l(c,a)):(runtime.assert(a===y,"Broken bookmark link @"+l(a)),runtime.assert(void 0===w||y===y||y.steps<=w,"Base point is damaged @"+l(a)));(b=a.nextBookmark)&&runtime.assert(b.previousBookmark===a,"Broken bookmark link to next @"+l(a,b));if(void 0===w||a===y||a.steps<=w)runtime.assert(v.containsNode(g,a.node),"Disconnected node is being reported as undamaged @"+
l(a)),c&&(d=a.node.compareDocumentPosition(c.node),runtime.assert(0===d||0!==(d&x),"Bookmark order with previous does not reflect DOM order @"+l(c,a))),b&&v.containsNode(g,b.node)&&(d=a.node.compareDocumentPosition(b.node),runtime.assert(0===d||0!==(d&u),"Bookmark order with next does not reflect DOM order @"+l(a,b)));a=a.nextBookmark}Object.keys(h).forEach(function(a){var c=h[a];(void 0===w||a<=w)&&runtime.assert(c.steps<=a,"Bookmark step of "+c.steps+" exceeds cached step lookup for "+a+" @"+l(c));
runtime.assert(!1===f.hasOwnProperty(c.nodeId),"Bookmark "+l(c)+" appears twice in cached step lookup at steps "+f[c.nodeId]+" and "+a);f[c.nodeId]=a})}function q(a){var c="";a.nodeType===Node.ELEMENT_NODE&&(c=a.getAttributeNS(n,"nodeId")||"");return c}function m(a){var c=f.toString();a.setAttributeNS(n,"nodeId",c);f+=1;return c}function r(a){var c,b,e=new core.LoopWatchDog(0,1E4);void 0!==w&&a>w&&(a=w);for(c=Math.floor(a/d)*d;!b&&0<=c;)b=h[c],c-=d;for(b=b||y;b.nextBookmark&&b.nextBookmark.steps<=
a;)e.check(),b=b.nextBookmark;runtime.assert(-1===a||b.steps<=a,"Bookmark @"+l(b)+" at step "+b.steps+" exceeds requested step of "+a);return b}function c(a){a.previousBookmark&&(a.previousBookmark.nextBookmark=a.nextBookmark);a.nextBookmark&&(a.nextBookmark.previousBookmark=a.previousBookmark)}function a(a){for(var c,b=null;!b&&a&&a!==g;)(c=q(a))&&(b=s[c])&&b.node!==a&&(runtime.log("Cloned node detected. Creating new bookmark"),b=null,a.removeAttributeNS(n,"nodeId")),a=a.parentNode;return b}var n=
"urn:webodf:names:steps",h={},s={},v=new core.DomUtils,y,w,u=Node.DOCUMENT_POSITION_FOLLOWING,x=Node.DOCUMENT_POSITION_PRECEDING,t;this.updateBookmark=function(a,b){var f,k=Math.ceil(a/d)*d,l,n,p;if(void 0!==w&&w<a){l=r(w);for(n=l.nextBookmark;n&&n.steps<=a;)f=n.nextBookmark,p=Math.ceil(n.steps/d)*d,h[p]===n&&delete h[p],v.containsNode(g,n.node)?n.steps=a+1:(c(n),delete s[n.nodeId]),n=f;w=a}else l=r(a);n=q(b)||m(b);f=s[n];f?f.node!==b&&(runtime.log("Cloned node detected. Creating new bookmark"),n=
m(b),f=s[n]=new e(n,b)):f=s[n]=new e(n,b);n=f;n.steps!==a&&(f=Math.ceil(n.steps/d)*d,f!==k&&h[f]===n&&delete h[f],n.steps=a);if(l!==n&&l.nextBookmark!==n){if(l.steps===n.steps)for(;0!==(n.node.compareDocumentPosition(l.node)&u)&&l!==y;)l=l.previousBookmark;l!==n&&l.nextBookmark!==n&&(c(n),f=l.nextBookmark,n.nextBookmark=l.nextBookmark,n.previousBookmark=l,l.nextBookmark=n,f&&(f.previousBookmark=n))}l=h[k];if(!l||n.steps>l.steps)h[k]=n;t()};this.setToClosestStep=function(a,c){var b;t();b=r(a);b.setIteratorPosition(c);
return b.steps};this.setToClosestDomPoint=function(c,b,d){var e,f;t();if(c===g&&0===b)e=y;else if(c===g&&b===g.childNodes.length)for(f in e=y,h)h.hasOwnProperty(f)&&(c=h[f],c.steps>e.steps&&(e=c));else if(e=a(c.childNodes.item(b)||c),!e)for(d.setUnfilteredPosition(c,b);!e&&d.previousNode();)e=a(d.getCurrentNode());e=e||y;void 0!==w&&e.steps>w&&(e=r(w));e.setIteratorPosition(d);return e.steps};this.damageCacheAfterStep=function(a){0>a&&(a=-1);void 0===w?w=a:a<w&&(w=a);t()};(function(){var a=q(g)||
m(g);y=new k(a,0,g);t=ops.StepsCache.ENABLE_CACHE_VERIFICATION?p:function(){}})()};ops.StepsCache.ENABLE_CACHE_VERIFICATION=!1;ops.StepsCache.Bookmark=function(){};ops.StepsCache.Bookmark.prototype.setIteratorPosition=function(f){}})();(function(){ops.OdtStepsTranslator=function(f,g,d,b){function e(a,c,b){var d=c.getCurrentNode();c.isBeforeNode()&&r.isParagraph(d)&&(b||(a+=1),m.updateBookmark(a,d))}function k(a,c){do{if(d.acceptPosition(c)===n){e(a,c,!0);break}e(a-1,c,!1)}while(c.nextPosition())}function l(){var c=f();c!==q&&(q&&runtime.log("Undo detected. Resetting steps cache"),q=c,m=new ops.StepsCache(q,b,k),a=g(q))}function p(a,c){if(!c||d.acceptPosition(a)===n)return!0;for(;a.previousPosition();)if(d.acceptPosition(a)===n){if(c(0,
a.container(),a.unfilteredDomOffset()))return!0;break}for(;a.nextPosition();)if(d.acceptPosition(a)===n){if(c(1,a.container(),a.unfilteredDomOffset()))return!0;break}return!1}var q,m,r=new odf.OdfUtils,c=new core.DomUtils,a,n=core.PositionFilter.FilterResult.FILTER_ACCEPT;this.convertStepsToDomPoint=function(c){var b,f;if(isNaN(c))throw new TypeError("Requested steps is not numeric ("+c+")");if(0>c)throw new RangeError("Requested steps is negative ("+c+")");l();for(b=m.setToClosestStep(c,a);b<c&&
a.nextPosition();)(f=d.acceptPosition(a)===n)&&(b+=1),e(b,a,f);if(b!==c)throw new RangeError("Requested steps ("+c+") exceeds available steps ("+b+")");return{node:a.container(),offset:a.unfilteredDomOffset()}};this.convertDomPointToSteps=function(b,f,g){var k;l();c.containsNode(q,b)||(f=0>c.comparePoints(q,0,b,f),b=q,f=f?0:q.childNodes.length);a.setUnfilteredPosition(b,f);p(a,g)||a.setUnfilteredPosition(b,f);g=a.container();f=a.unfilteredDomOffset();b=m.setToClosestDomPoint(g,f,a);if(0>c.comparePoints(a.container(),
a.unfilteredDomOffset(),g,f))return 0<b?b-1:b;for(;(a.container()!==g||a.unfilteredDomOffset()!==f)&&a.nextPosition();)(k=d.acceptPosition(a)===n)&&(b+=1),e(b,a,k);return b+0};this.prime=function(){var c,b;l();for(c=m.setToClosestStep(0,a);a.nextPosition();)(b=d.acceptPosition(a)===n)&&(c+=1),e(c,a,b)};this.handleStepsInserted=function(a){l();m.damageCacheAfterStep(a.position)};this.handleStepsRemoved=function(a){l();m.damageCacheAfterStep(a.position-1)};l()};ops.OdtStepsTranslator.PREVIOUS_STEP=
0;ops.OdtStepsTranslator.NEXT_STEP=1})();ops.Operation=function(){};ops.Operation.prototype.init=function(f){};ops.Operation.prototype.execute=function(f){};ops.Operation.prototype.spec=function(){};ops.TextPositionFilter=function(f){function g(b,e,f){var g,c;if(e){if(d.isInlineRoot(e)&&d.isGroupingElement(f))return l;g=d.lookLeftForCharacter(e);if(1===g||2===g&&(d.scanRightForAnyCharacter(f)||d.scanRightForAnyCharacter(d.nextNode(b))))return k}else if(d.isInlineRoot(b.previousSibling)&&d.isGroupingElement(b))return k;g=null===e&&d.isParagraph(b);c=d.lookRightForCharacter(f);if(g)return c?k:d.scanRightForAnyCharacter(f)?l:k;if(!c)return l;e=e||d.previousNode(b);return d.scanLeftForAnyCharacter(e)?
l:k}var d=new odf.OdfUtils,b=Node.ELEMENT_NODE,e=Node.TEXT_NODE,k=core.PositionFilter.FilterResult.FILTER_ACCEPT,l=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(p){var q=p.container(),m=q.nodeType,r,c,a;if(m!==b&&m!==e)return l;if(m===e){if(!d.isGroupingElement(q.parentNode)||d.isWithinTrackedChanges(q.parentNode,f()))return l;m=p.unfilteredDomOffset();r=q.data;runtime.assert(m!==r.length,"Unexpected offset.");if(0<m){p=r[m-1];if(!d.isODFWhitespace(p))return k;if(1<m)if(p=
r[m-2],!d.isODFWhitespace(p))c=k;else{if(!d.isODFWhitespace(r.substr(0,m)))return l}else a=d.previousNode(q),d.scanLeftForNonSpace(a)&&(c=k);if(c===k)return d.isTrailingWhitespace(q,m)?l:k;c=r[m];return d.isODFWhitespace(c)?l:d.scanLeftForAnyCharacter(d.previousNode(q))?l:k}a=p.leftNode();c=q;q=q.parentNode;c=g(q,a,c)}else!d.isGroupingElement(q)||d.isWithinTrackedChanges(q,f())?c=l:(a=p.leftNode(),c=p.rightNode(),c=g(q,a,c));return c}};ops.OdtDocument=function(f){function g(){var a=f.odfContainer().getContentElement(),c=a&&a.localName;runtime.assert("text"===c,"Unsupported content element type '"+c+"' for OdtDocument");return a}function d(){return c.getDocumentElement().ownerDocument}function b(a){for(;a&&!(a.namespaceURI===odf.Namespaces.officens&&"text"===a.localName||a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName);)a=a.parentNode;return a}function e(a){this.acceptPosition=function(c){c=c.container();var d;
d="string"===typeof a?s[a].getNode():a;return b(c)===b(d)?w:u}}function k(a,c,b,d){d=gui.SelectionMover.createPositionIterator(d);var e;1===b.length?e=b[0]:(e=new core.PositionFilterChain,b.forEach(e.addFilter));b=new core.StepIterator(e,d);b.setPosition(a,c);return b}function l(a){var c=gui.SelectionMover.createPositionIterator(g());a=t.convertStepsToDomPoint(a);c.setUnfilteredPosition(a.node,a.offset);return c}function p(a){return n.getParagraphElement(a)}function q(a,c){return f.getFormatting().getStyleElement(a,
c)}function m(a){return q(a,"paragraph")}function r(a,c,b){a=a.childNodes.item(c)||a;return(a=p(a))&&h.containsNode(b,a)?a:b}var c=this,a,n,h,s={},v={},y=new core.EventNotifier([ops.Document.signalMemberAdded,ops.Document.signalMemberUpdated,ops.Document.signalMemberRemoved,ops.Document.signalCursorAdded,ops.Document.signalCursorRemoved,ops.Document.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,
ops.OdtDocument.signalTableAdded,ops.OdtDocument.signalOperationStart,ops.OdtDocument.signalOperationEnd,ops.OdtDocument.signalProcessingBatchStart,ops.OdtDocument.signalProcessingBatchEnd,ops.OdtDocument.signalUndoStackChanged,ops.OdtDocument.signalStepsInserted,ops.OdtDocument.signalStepsRemoved,ops.OdtDocument.signalMetadataUpdated]),w=core.PositionFilter.FilterResult.FILTER_ACCEPT,u=core.PositionFilter.FilterResult.FILTER_REJECT,x,t,E;this.getDocumentElement=function(){return f.odfContainer().rootElement};
this.getDOMDocument=function(){return this.getDocumentElement().ownerDocument};this.cloneDocumentElement=function(){var a=c.getDocumentElement(),b=f.getAnnotationViewManager();b&&b.forgetAnnotations();a=a.cloneNode(!0);f.refreshAnnotations();return a};this.setDocumentElement=function(a){var c=f.odfContainer();c.setRootElement(a);f.setOdfContainer(c,!0);f.refreshCSS()};this.getDOMDocument=d;this.getRootElement=b;this.createStepIterator=k;this.getIteratorAtPosition=l;this.convertDomPointToCursorStep=
function(a,c,b){return t.convertDomPointToSteps(a,c,b)};this.convertDomToCursorRange=function(a){var c;c=t.convertDomPointToSteps(a.anchorNode,a.anchorOffset);a=a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset?c:t.convertDomPointToSteps(a.focusNode,a.focusOffset);return{position:c,length:a-c}};this.convertCursorToDomRange=function(a,c){var b=d().createRange(),e,f;e=t.convertStepsToDomPoint(a);c?(f=t.convertStepsToDomPoint(a+c),0<c?(b.setStart(e.node,e.offset),b.setEnd(f.node,f.offset)):
(b.setStart(f.node,f.offset),b.setEnd(e.node,e.offset))):b.setStart(e.node,e.offset);return b};this.getStyleElement=q;this.upgradeWhitespacesAtPosition=function(c){var b=l(c),b=new core.StepIterator(x,b),d,e=2;runtime.assert(b.isStep(),"positionIterator is not at a step (requested step: "+c+")");do{if(d=a.getContentBounds(b))if(c=d.container,d=d.startOffset,c.nodeType===Node.TEXT_NODE&&n.isSignificantWhitespace(c,d)){runtime.assert(" "===c.data[d],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");
var f=c.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s"),h=c.parentNode,g=c;f.appendChild(c.ownerDocument.createTextNode(" "));1===c.length?h.replaceChild(f,c):(c.deleteData(d,1),0<d&&(d<c.length&&c.splitText(d),g=c.nextSibling),h.insertBefore(f,g));c=f;b.setPosition(c,c.childNodes.length);b.roundToPreviousStep()}e-=1}while(0<e&&b.nextStep())};this.downgradeWhitespacesAtPosition=function(c){var b=l(c),b=new core.StepIterator(x,b),d=[],e,f=2;runtime.assert(b.isStep(),"positionIterator is not at a step (requested step: "+
c+")");do{if(c=a.getContentBounds(b))if(c=c.container,n.isDowngradableSpaceElement(c)){for(e=c.lastChild;c.firstChild;)d.push(c.firstChild),c.parentNode.insertBefore(c.firstChild,c);c.parentNode.removeChild(c);b.setPosition(e,e.nodeType===Node.TEXT_NODE?e.length:e.childNodes.length);b.roundToPreviousStep()}f-=1}while(0<f&&b.nextStep());d.forEach(h.normalizeTextNodes)};this.getParagraphStyleElement=m;this.getParagraphElement=p;this.getParagraphStyleAttributes=function(a){return(a=m(a))?f.getFormatting().getInheritedStyleAttributes(a,
!1):null};this.getTextNodeAtStep=function(a,b){var e=l(a),f=e.container(),h,g=0,k=null;f.nodeType===Node.TEXT_NODE?(h=f,g=e.unfilteredDomOffset(),0<h.length&&(0<g&&(h=h.splitText(g)),h.parentNode.insertBefore(d().createTextNode(""),h),h=h.previousSibling,g=0)):(h=d().createTextNode(""),g=0,f.insertBefore(h,e.rightNode()));if(b){if(s[b]&&c.getCursorPosition(b)===a){for(k=s[b].getNode();k.nextSibling&&"cursor"===k.nextSibling.localName;)k.parentNode.insertBefore(k.nextSibling,k);0<h.length&&h.nextSibling!==
k&&(h=d().createTextNode(""),g=0);k.parentNode.insertBefore(h,k)}}else for(;h.nextSibling&&"cursor"===h.nextSibling.localName;)h.parentNode.insertBefore(h.nextSibling,h);for(;h.previousSibling&&h.previousSibling.nodeType===Node.TEXT_NODE;)e=h.previousSibling,e.appendData(h.data),g=e.length,h=e,h.parentNode.removeChild(h.nextSibling);for(;h.nextSibling&&h.nextSibling.nodeType===Node.TEXT_NODE;)e=h.nextSibling,h.appendData(e.data),h.parentNode.removeChild(e);return{textNode:h,offset:g}};this.fixCursorPositions=
function(){Object.keys(s).forEach(function(a){var d=s[a],e=b(d.getNode()),f=c.createRootFilter(e),h,g,l,n=!1;l=d.getSelectedRange();h=r(l.startContainer,l.startOffset,e);g=k(l.startContainer,l.startOffset,[x,f],h);l.collapsed?e=g:(h=r(l.endContainer,l.endOffset,e),e=k(l.endContainer,l.endOffset,[x,f],h));g.isStep()&&e.isStep()?g.container()!==e.container()||g.offset()!==e.offset()||l.collapsed&&d.getAnchorNode()===d.getNode()||(n=!0,l.setStart(g.container(),g.offset()),l.collapse(!0)):(n=!0,runtime.assert(g.roundToClosestStep(),
"No walkable step found for cursor owned by "+a),l.setStart(g.container(),g.offset()),runtime.assert(e.roundToClosestStep(),"No walkable step found for cursor owned by "+a),l.setEnd(e.container(),e.offset()));n&&(d.setSelectedRange(l,d.hasForwardSelection()),c.emit(ops.Document.signalCursorMoved,d))})};this.getCursorPosition=function(a){return(a=s[a])?t.convertDomPointToSteps(a.getNode(),0):0};this.getCursorSelection=function(a){a=s[a];var c=0,b=0;a&&(c=t.convertDomPointToSteps(a.getNode(),0),b=t.convertDomPointToSteps(a.getAnchorNode(),
0));return{position:b,length:c-b}};this.getPositionFilter=function(){return x};this.getOdfCanvas=function(){return f};this.getCanvas=function(){return f};this.getRootNode=g;this.addMember=function(a){runtime.assert(void 0===v[a.getMemberId()],"This member already exists");v[a.getMemberId()]=a};this.getMember=function(a){return v.hasOwnProperty(a)?v[a]:null};this.removeMember=function(a){delete v[a]};this.getCursor=function(a){return s[a]};this.getMemberIds=function(){var a=[],c;for(c in s)s.hasOwnProperty(c)&&
a.push(s[c].getMemberId());return a};this.addCursor=function(a){runtime.assert(Boolean(a),"OdtDocument::addCursor without cursor");var b=a.getMemberId(),d=c.convertCursorToDomRange(0,0);runtime.assert("string"===typeof b,"OdtDocument::addCursor has cursor without memberid");runtime.assert(!s[b],"OdtDocument::addCursor is adding a duplicate cursor with memberid "+b);a.setSelectedRange(d,!0);s[b]=a};this.removeCursor=function(a){var b=s[a];return b?(b.removeFromDocument(),delete s[a],c.emit(ops.Document.signalCursorRemoved,
a),!0):!1};this.moveCursor=function(a,b,d,e){a=s[a];b=c.convertCursorToDomRange(b,d);a&&(a.setSelectedRange(b,0<=d),a.setSelectionType(e||ops.OdtCursor.RangeSelection))};this.getFormatting=function(){return f.getFormatting()};this.emit=function(a,c){y.emit(a,c)};this.subscribe=function(a,c){y.subscribe(a,c)};this.unsubscribe=function(a,c){y.unsubscribe(a,c)};this.createRootFilter=function(a){return new e(a)};this.close=function(a){a()};this.destroy=function(a){a()};x=new ops.TextPositionFilter(g);
n=new odf.OdfUtils;h=new core.DomUtils;a=new odf.StepUtils;t=new ops.OdtStepsTranslator(g,gui.SelectionMover.createPositionIterator,x,500);y.subscribe(ops.OdtDocument.signalStepsInserted,t.handleStepsInserted);y.subscribe(ops.OdtDocument.signalStepsRemoved,t.handleStepsRemoved);y.subscribe(ops.OdtDocument.signalOperationEnd,function(a){var b=a.spec(),d=b.memberid,e=(new Date(b.timestamp)).toISOString(),h=f.odfContainer(),g={setProperties:{},removedProperties:[]};a.isEdit&&("UpdateMetadata"===b.optype&&
(g.setProperties=JSON.parse(JSON.stringify(b.setProperties)),b.removedProperties&&(g.removedProperties=b.removedProperties.attributes.split(","))),b=c.getMember(d).getProperties().fullName,h.setMetadata({"dc:creator":b,"dc:date":e},null),g.setProperties["dc:creator"]=b,g.setProperties["dc:date"]=e,E||(g.setProperties["meta:editing-cycles"]=h.incrementEditingCycles(),h.setMetadata(null,["meta:editing-duration","meta:document-statistic"])),E=a,c.emit(ops.OdtDocument.signalMetadataUpdated,g))});y.subscribe(ops.OdtDocument.signalProcessingBatchEnd,
core.Task.processTasks)};ops.OdtDocument.signalParagraphChanged="paragraph/changed";ops.OdtDocument.signalTableAdded="table/added";ops.OdtDocument.signalCommonStyleCreated="style/created";ops.OdtDocument.signalCommonStyleDeleted="style/deleted";ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified";ops.OdtDocument.signalOperationStart="operation/start";ops.OdtDocument.signalOperationEnd="operation/end";ops.OdtDocument.signalProcessingBatchStart="router/batchstart";
ops.OdtDocument.signalProcessingBatchEnd="router/batchend";ops.OdtDocument.signalUndoStackChanged="undo/changed";ops.OdtDocument.signalStepsInserted="steps/inserted";ops.OdtDocument.signalStepsRemoved="steps/removed";ops.OdtDocument.signalMetadataUpdated="metadata/updated";ops.OpAddAnnotation=function(){function f(b,d,e){var f=b.getTextNodeAtStep(e,g);f&&(b=f.textNode,e=b.parentNode,f.offset!==b.length&&b.splitText(f.offset),e.insertBefore(d,b.nextSibling),0===b.length&&e.removeChild(b))}var g,d,b,e,k,l;this.init=function(f){g=f.memberid;d=parseInt(f.timestamp,10);b=parseInt(f.position,10);e=parseInt(f.length,10)||0;k=f.name};this.isEdit=!0;this.group=void 0;this.execute=function(p){var q=p.getCursor(g),m,r;r=new core.DomUtils;l=p.getDOMDocument();var c=new Date(d),
a,n,h,s;a=l.createElementNS(odf.Namespaces.officens,"office:annotation");a.setAttributeNS(odf.Namespaces.officens,"office:name",k);m=l.createElementNS(odf.Namespaces.dcns,"dc:creator");m.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g);m.textContent=p.getMember(g).getProperties().fullName;n=l.createElementNS(odf.Namespaces.dcns,"dc:date");n.appendChild(l.createTextNode(c.toISOString()));c=l.createElementNS(odf.Namespaces.textns,"text:list");h=l.createElementNS(odf.Namespaces.textns,
"text:list-item");s=l.createElementNS(odf.Namespaces.textns,"text:p");h.appendChild(s);c.appendChild(h);a.appendChild(m);a.appendChild(n);a.appendChild(c);e&&(m=l.createElementNS(odf.Namespaces.officens,"office:annotation-end"),m.setAttributeNS(odf.Namespaces.officens,"office:name",k),a.annotationEndElement=m,f(p,m,b+e));f(p,a,b);p.emit(ops.OdtDocument.signalStepsInserted,{position:b});q&&(m=l.createRange(),r=r.getElementsByTagNameNS(a,odf.Namespaces.textns,"p")[0],m.selectNodeContents(r),q.setSelectedRange(m,
!1),q.setSelectionType(ops.OdtCursor.RangeSelection),p.emit(ops.Document.signalCursorMoved,q));p.getOdfCanvas().addAnnotation(a);p.fixCursorPositions();return!0};this.spec=function(){return{optype:"AddAnnotation",memberid:g,timestamp:d,position:b,length:e,name:k}}};ops.OpAddCursor=function(){var f,g;this.init=function(d){f=d.memberid;g=d.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(d){var b=d.getCursor(f);if(b)return!1;b=new ops.OdtCursor(f,d);d.addCursor(b);d.emit(ops.Document.signalCursorAdded,b);return!0};this.spec=function(){return{optype:"AddCursor",memberid:f,timestamp:g}}};ops.OpAddMember=function(){var f,g,d;this.init=function(b){f=b.memberid;g=parseInt(b.timestamp,10);d=b.setProperties};this.isEdit=!1;this.group=void 0;this.execute=function(b){var e;if(b.getMember(f))return!1;e=new ops.Member(f,d);b.addMember(e);b.emit(ops.Document.signalMemberAdded,e);return!0};this.spec=function(){return{optype:"AddMember",memberid:f,timestamp:g,setProperties:d}}};ops.OpAddStyle=function(){var f,g,d,b,e,k,l=odf.Namespaces.stylens;this.init=function(l){f=l.memberid;g=l.timestamp;d=l.styleName;b=l.styleFamily;e="true"===l.isAutomaticStyle||!0===l.isAutomaticStyle;k=l.setProperties};this.isEdit=!0;this.group=void 0;this.execute=function(f){var g=f.getOdfCanvas().odfContainer(),m=f.getFormatting(),r=f.getDOMDocument().createElementNS(l,"style:style");if(!r)return!1;k&&m.updateStyle(r,k);r.setAttributeNS(l,"style:family",b);r.setAttributeNS(l,"style:name",d);e?
g.rootElement.automaticStyles.appendChild(r):g.rootElement.styles.appendChild(r);f.getOdfCanvas().refreshCSS();e||f.emit(ops.OdtDocument.signalCommonStyleCreated,{name:d,family:b});return!0};this.spec=function(){return{optype:"AddStyle",memberid:f,timestamp:g,styleName:d,styleFamily:b,isAutomaticStyle:e,setProperties:k}}};odf.ObjectNameGenerator=function(f,g){function d(a,c){var b={};this.generateName=function(){var d=c(),e=0,f;do f=a+e,e+=1;while(b[f]||d[f]);b[f]=!0;return f}}function b(){var a={};[f.rootElement.automaticStyles,f.rootElement.styles].forEach(function(c){for(c=c.firstElementChild;c;)c.namespaceURI===e&&"style"===c.localName&&(a[c.getAttributeNS(e,"name")]=!0),c=c.nextElementSibling});return a}var e=odf.Namespaces.stylens,k=odf.Namespaces.drawns,l=odf.Namespaces.xlinkns,p=new core.DomUtils,q=(new core.Utils).hashString(g),
m=null,r=null,c=null,a={},n={};this.generateStyleName=function(){null===m&&(m=new d("auto"+q+"_",function(){return b()}));return m.generateName()};this.generateFrameName=function(){null===r&&(p.getElementsByTagNameNS(f.rootElement.body,k,"frame").forEach(function(c){a[c.getAttributeNS(k,"name")]=!0}),r=new d("fr"+q+"_",function(){return a}));return r.generateName()};this.generateImageName=function(){null===c&&(p.getElementsByTagNameNS(f.rootElement.body,k,"image").forEach(function(a){a=a.getAttributeNS(l,
"href");a=a.substring(9,a.lastIndexOf("."));n[a]=!0}),c=new d("img"+q+"_",function(){return n}));return c.generateName()}};odf.TextStyleApplicator=function(f,g,d){function b(b){function d(a,c){return"object"===typeof a&&"object"===typeof c?Object.keys(a).every(function(b){return d(a[b],c[b])}):a===c}var c={};this.isStyleApplied=function(a){a=g.getAppliedStylesForElement(a,c);return d(b,a)}}function e(b){var e={};this.applyStyleToContainer=function(c){var a;a=c.getAttributeNS(p,"style-name");var k=c.ownerDocument;a=a||"";if(!e.hasOwnProperty(a)){var h=a,l;l=a?g.createDerivedStyleObject(a,"text",b):b;k=k.createElementNS(q,
"style:style");g.updateStyle(k,l);k.setAttributeNS(q,"style:name",f.generateStyleName());k.setAttributeNS(q,"style:family","text");k.setAttributeNS("urn:webodf:names:scope","scope","document-content");d.appendChild(k);e[h]=k}a=e[a].getAttributeNS(q,"name");c.setAttributeNS(p,"text:style-name",a)}}function k(b,d){var c=b.ownerDocument,a=b.parentNode,e,f,g,k=new core.LoopWatchDog(1E4);f=[];f.push(b);for(g=b.nextSibling;g&&l.rangeContainsNode(d,g);)k.check(),f.push(g),g=g.nextSibling;"span"!==a.localName||
a.namespaceURI!==p?(e=c.createElementNS(p,"text:span"),a.insertBefore(e,b),c=!1):(b.previousSibling&&!l.rangeContainsNode(d,a.firstChild)?(e=a.cloneNode(!1),a.parentNode.insertBefore(e,a.nextSibling)):e=a,c=!0);f.forEach(function(a){a.parentNode!==e&&e.appendChild(a)});if(g&&c)for(f=e.cloneNode(!1),e.parentNode.insertBefore(f,e.nextSibling);g;)k.check(),c=g.nextSibling,f.appendChild(g),g=c;return e}var l=new core.DomUtils,p=odf.Namespaces.textns,q=odf.Namespaces.stylens;this.applyStyle=function(d,
f,c){var a={},g,h,l,p;runtime.assert(c&&c.hasOwnProperty("style:text-properties"),"applyStyle without any text properties");a["style:text-properties"]=c["style:text-properties"];l=new e(a);p=new b(a);d.forEach(function(a){g=p.isStyleApplied(a);!1===g&&(h=k(a,f),l.applyStyleToContainer(h))})}};ops.OpApplyDirectStyling=function(){function f(b,d,e){var c=b.getOdfCanvas().odfContainer(),a=p.splitBoundaries(d),f=l.getTextNodes(d,!1);(new odf.TextStyleApplicator(new odf.ObjectNameGenerator(c,g),b.getFormatting(),c.rootElement.automaticStyles)).applyStyle(f,d,e);a.forEach(p.normalizeTextNodes)}var g,d,b,e,k,l=new odf.OdfUtils,p=new core.DomUtils;this.init=function(f){g=f.memberid;d=f.timestamp;b=parseInt(f.position,10);e=parseInt(f.length,10);k=f.setProperties};this.isEdit=!0;this.group=void 0;
this.execute=function(p){var m=p.convertCursorToDomRange(b,e),r=l.getParagraphElements(m);f(p,m,k);m.detach();p.getOdfCanvas().refreshCSS();p.fixCursorPositions();r.forEach(function(c){p.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:c,memberId:g,timeStamp:d})});p.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"ApplyDirectStyling",memberid:g,timestamp:d,position:b,length:e,setProperties:k}}};ops.OpApplyHyperlink=function(){function f(b){for(;b;){if(p.isHyperlink(b))return!0;b=b.parentNode}return!1}var g,d,b,e,k,l=new core.DomUtils,p=new odf.OdfUtils;this.init=function(f){g=f.memberid;d=f.timestamp;b=f.position;e=f.length;k=f.hyperlink};this.isEdit=!0;this.group=void 0;this.execute=function(q){var m=q.getDOMDocument(),r=q.convertCursorToDomRange(b,e),c=l.splitBoundaries(r),a=[],n=p.getTextNodes(r,!1);if(0===n.length)return!1;n.forEach(function(c){var b=p.getParagraphElement(c);runtime.assert(!1===
f(c),"The given range should not contain any link.");var d=k,e=m.createElementNS(odf.Namespaces.textns,"text:a");e.setAttributeNS(odf.Namespaces.xlinkns,"xlink:type","simple");e.setAttributeNS(odf.Namespaces.xlinkns,"xlink:href",d);c.parentNode.insertBefore(e,c);e.appendChild(c);-1===a.indexOf(b)&&a.push(b)});c.forEach(l.normalizeTextNodes);r.detach();q.getOdfCanvas().refreshSize();q.getOdfCanvas().rerenderAnnotations();a.forEach(function(a){q.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:a,
memberId:g,timeStamp:d})});return!0};this.spec=function(){return{optype:"ApplyHyperlink",memberid:g,timestamp:d,position:b,length:e,hyperlink:k}}};ops.OpInsertImage=function(){var f,g,d,b,e,k,l,p,q=odf.Namespaces.drawns,m=odf.Namespaces.svgns,r=odf.Namespaces.textns,c=odf.Namespaces.xlinkns;this.init=function(a){f=a.memberid;g=a.timestamp;d=a.position;b=a.filename;e=a.frameWidth;k=a.frameHeight;l=a.frameStyleName;p=a.frameName};this.isEdit=!0;this.group=void 0;this.execute=function(a){var n=a.getOdfCanvas(),h=a.getTextNodeAtStep(d,f),s,v;if(!h)return!1;s=h.textNode;v=a.getParagraphElement(s);var h=h.offset!==s.length?s.splitText(h.offset):s.nextSibling,
y=a.getDOMDocument(),w=y.createElementNS(q,"draw:image"),y=y.createElementNS(q,"draw:frame");w.setAttributeNS(c,"xlink:href",b);w.setAttributeNS(c,"xlink:type","simple");w.setAttributeNS(c,"xlink:show","embed");w.setAttributeNS(c,"xlink:actuate","onLoad");y.setAttributeNS(q,"draw:style-name",l);y.setAttributeNS(q,"draw:name",p);y.setAttributeNS(r,"text:anchor-type","as-char");y.setAttributeNS(m,"svg:width",e);y.setAttributeNS(m,"svg:height",k);y.appendChild(w);s.parentNode.insertBefore(y,h);a.emit(ops.OdtDocument.signalStepsInserted,
{position:d});0===s.length&&s.parentNode.removeChild(s);n.addCssForFrameWithImage(y);n.refreshCSS();a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:v,memberId:f,timeStamp:g});n.rerenderAnnotations();return!0};this.spec=function(){return{optype:"InsertImage",memberid:f,timestamp:g,filename:b,position:d,frameWidth:e,frameHeight:k,frameStyleName:l,frameName:p}}};ops.OpInsertTable=function(){function f(d,c){var a;if(1===m.length)a=m[0];else if(3===m.length)switch(d){case 0:a=m[0];break;case b-1:a=m[2];break;default:a=m[1]}else a=m[d];if(1===a.length)return a[0];if(3===a.length)switch(c){case 0:return a[0];case e-1:return a[2];default:return a[1]}return a[c]}var g,d,b,e,k,l,p,q,m;this.init=function(f){g=f.memberid;d=f.timestamp;k=f.position;b=f.initialRows;e=f.initialColumns;l=f.tableName;p=f.tableStyleName;q=f.tableColumnStyleName;m=f.tableCellStyleMatrix};
this.isEdit=!0;this.group=void 0;this.execute=function(m){var c=m.getTextNodeAtStep(k),a=m.getRootNode();if(c){var n=m.getDOMDocument(),h=n.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),s=n.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column"),v,y,w,u;p&&h.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",p);l&&h.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",l);s.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0",
"table:number-columns-repeated",e);q&&s.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",q);h.appendChild(s);for(w=0;w<b;w+=1){s=n.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row");for(u=0;u<e;u+=1)v=n.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(y=f(w,u))&&v.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",y),y=n.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0",
"text:p"),v.appendChild(y),s.appendChild(v);h.appendChild(s)}c=m.getParagraphElement(c.textNode);a.insertBefore(h,c.nextSibling);m.emit(ops.OdtDocument.signalStepsInserted,{position:k});m.getOdfCanvas().refreshSize();m.emit(ops.OdtDocument.signalTableAdded,{tableElement:h,memberId:g,timeStamp:d});m.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertTable",memberid:g,timestamp:d,position:k,initialRows:b,initialColumns:e,tableName:l,tableStyleName:p,tableColumnStyleName:q,
tableCellStyleMatrix:m}}};ops.OpInsertText=function(){var f,g,d,b,e,k=new odf.OdfUtils;this.init=function(k){f=k.memberid;g=k.timestamp;d=k.position;e=k.text;b="true"===k.moveCursor||!0===k.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(l){var p,q,m,r=null,c=l.getDOMDocument(),a,n=0,h,s=l.getCursor(f),v;l.upgradeWhitespacesAtPosition(d);if(p=l.getTextNodeAtStep(d)){q=p.textNode;r=q.nextSibling;m=q.parentNode;a=l.getParagraphElement(q);for(v=0;v<e.length;v+=1)if("\t"===e[v]||"\t"!==e[v]&&k.isODFWhitespace(e[v])&&
(0===v||v===e.length-1||"\t"!==e[v-1]&&k.isODFWhitespace(e[v-1])))0===n?(p.offset!==q.length&&(r=q.splitText(p.offset)),0<v&&q.appendData(e.substring(0,v))):n<v&&(n=e.substring(n,v),m.insertBefore(c.createTextNode(n),r)),n=v+1,"\t"===e[v]?(h=c.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:tab"),h.appendChild(c.createTextNode("\t"))):(" "!==e[v]&&runtime.log("WARN: InsertText operation contains non-tab, non-space whitespace character (character code "+e.charCodeAt(v)+")"),
h=c.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:s"),h.appendChild(c.createTextNode(" "))),m.insertBefore(h,r);0===n?q.insertData(p.offset,e):n<e.length&&(p=e.substring(n),m.insertBefore(c.createTextNode(p),r));m=q.parentNode;r=q.nextSibling;m.removeChild(q);m.insertBefore(q,r);0===q.length&&q.parentNode.removeChild(q);l.emit(ops.OdtDocument.signalStepsInserted,{position:d});s&&b&&(l.moveCursor(f,d+e.length,0),l.emit(ops.Document.signalCursorMoved,s));l.downgradeWhitespacesAtPosition(d);
l.downgradeWhitespacesAtPosition(d+e.length);l.getOdfCanvas().refreshSize();l.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:a,memberId:f,timeStamp:g});l.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertText",memberid:f,timestamp:g,position:d,text:e,moveCursor:b}}};ops.OpMoveCursor=function(){var f,g,d,b,e;this.init=function(k){f=k.memberid;g=k.timestamp;d=k.position;b=k.length||0;e=k.selectionType||ops.OdtCursor.RangeSelection};this.isEdit=!1;this.group=void 0;this.execute=function(g){var l=g.getCursor(f),p;if(!l)return!1;p=g.convertCursorToDomRange(d,b);l.setSelectedRange(p,0<=b);l.setSelectionType(e);g.emit(ops.Document.signalCursorMoved,l);return!0};this.spec=function(){return{optype:"MoveCursor",memberid:f,timestamp:g,position:d,length:b,selectionType:e}}};ops.OpRemoveAnnotation=function(){var f,g,d,b,e;this.init=function(k){f=k.memberid;g=k.timestamp;d=parseInt(k.position,10);b=parseInt(k.length,10);e=new core.DomUtils};this.isEdit=!0;this.group=void 0;this.execute=function(b){function f(b){q.parentNode.insertBefore(b,q)}for(var g=b.getIteratorAtPosition(d).container(),q;g.namespaceURI!==odf.Namespaces.officens||"annotation"!==g.localName;)g=g.parentNode;if(null===g)return!1;q=g;g=q.annotationEndElement;b.getOdfCanvas().forgetAnnotations();e.getElementsByTagNameNS(q,
"urn:webodf:names:cursor","cursor").forEach(f);e.getElementsByTagNameNS(q,"urn:webodf:names:cursor","anchor").forEach(f);q.parentNode.removeChild(q);g&&g.parentNode.removeChild(g);b.emit(ops.OdtDocument.signalStepsRemoved,{position:0<d?d-1:d});b.fixCursorPositions();b.getOdfCanvas().refreshAnnotations();return!0};this.spec=function(){return{optype:"RemoveAnnotation",memberid:f,timestamp:g,position:d,length:b}}};ops.OpRemoveBlob=function(){var f,g,d;this.init=function(b){f=b.memberid;g=b.timestamp;d=b.filename};this.isEdit=!0;this.group=void 0;this.execute=function(b){b.getOdfCanvas().odfContainer().removeBlob(d);return!0};this.spec=function(){return{optype:"RemoveBlob",memberid:f,timestamp:g,filename:d}}};ops.OpRemoveCursor=function(){var f,g;this.init=function(d){f=d.memberid;g=d.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(d){return d.removeCursor(f)?!0:!1};this.spec=function(){return{optype:"RemoveCursor",memberid:f,timestamp:g}}};ops.OpRemoveHyperlink=function(){var f,g,d,b,e=new core.DomUtils,k=new odf.OdfUtils;this.init=function(e){f=e.memberid;g=e.timestamp;d=e.position;b=e.length};this.isEdit=!0;this.group=void 0;this.execute=function(l){var p=l.convertCursorToDomRange(d,b),q=k.getHyperlinkElements(p);runtime.assert(1===q.length,"The given range should only contain a single link.");q=e.mergeIntoParent(q[0]);p.detach();l.getOdfCanvas().refreshSize();l.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:k.getParagraphElement(q),
memberId:f,timeStamp:g});l.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"RemoveHyperlink",memberid:f,timestamp:g,position:d,length:b}}};ops.OpRemoveMember=function(){var f,g;this.init=function(d){f=d.memberid;g=parseInt(d.timestamp,10)};this.isEdit=!1;this.group=void 0;this.execute=function(d){if(!d.getMember(f))return!1;d.removeMember(f);d.emit(ops.Document.signalMemberRemoved,f);return!0};this.spec=function(){return{optype:"RemoveMember",memberid:f,timestamp:g}}};ops.OpRemoveStyle=function(){var f,g,d,b;this.init=function(e){f=e.memberid;g=e.timestamp;d=e.styleName;b=e.styleFamily};this.isEdit=!0;this.group=void 0;this.execute=function(e){var f=e.getStyleElement(d,b);if(!f)return!1;f.parentNode.removeChild(f);e.getOdfCanvas().refreshCSS();e.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:d,family:b});return!0};this.spec=function(){return{optype:"RemoveStyle",memberid:f,timestamp:g,styleName:d,styleFamily:b}}};ops.OpRemoveText=function(){function f(b){function d(b){return k.isODFNode(b)||"br"===b.localName&&k.isLineBreak(b.parentNode)||b.nodeType===Node.TEXT_NODE&&k.isODFNode(b.parentNode)}function e(f){var c;f.nodeType===Node.TEXT_NODE?(c=f.parentNode,c.removeChild(f)):c=l.removeUnwantedNodes(f,d);return c&&!k.isParagraph(c)&&c!==b&&k.hasNoODFContent(c)?e(c):c}this.mergeChildrenIntoParent=e}var g,d,b,e,k,l;this.init=function(f){runtime.assert(0<=f.length,"OpRemoveText only supports positive lengths");
g=f.memberid;d=f.timestamp;b=parseInt(f.position,10);e=parseInt(f.length,10);k=new odf.OdfUtils;l=new core.DomUtils};this.isEdit=!0;this.group=void 0;this.execute=function(p){var q,m,r,c,a=p.getCursor(g),n=new f(p.getRootNode());p.upgradeWhitespacesAtPosition(b);p.upgradeWhitespacesAtPosition(b+e);m=p.convertCursorToDomRange(b,e);l.splitBoundaries(m);q=p.getParagraphElement(m.startContainer);r=k.getTextElements(m,!1,!0);c=k.getParagraphElements(m);m.detach();r.forEach(function(a){a.parentNode?n.mergeChildrenIntoParent(a):
runtime.log("WARN: text element has already been removed from it's container")});m=c.reduce(function(a,c){for(var b;c.firstChild;)b=c.firstChild,c.removeChild(b),"editinfo"!==b.localName&&a.appendChild(b);n.mergeChildrenIntoParent(c);return a});p.emit(ops.OdtDocument.signalStepsRemoved,{position:b});p.downgradeWhitespacesAtPosition(b);p.fixCursorPositions();p.getOdfCanvas().refreshSize();p.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:m||q,memberId:g,timeStamp:d});a&&(a.resetSelectionType(),
p.emit(ops.Document.signalCursorMoved,a));p.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"RemoveText",memberid:g,timestamp:d,position:b,length:e}}};ops.OpSetBlob=function(){var f,g,d,b,e;this.init=function(k){f=k.memberid;g=k.timestamp;d=k.filename;b=k.mimetype;e=k.content};this.isEdit=!0;this.group=void 0;this.execute=function(f){f.getOdfCanvas().odfContainer().setBlob(d,b,e);return!0};this.spec=function(){return{optype:"SetBlob",memberid:f,timestamp:g,filename:d,mimetype:b,content:e}}};ops.OpSetParagraphStyle=function(){var f,g,d,b;this.init=function(e){f=e.memberid;g=e.timestamp;d=e.position;b=e.styleName};this.isEdit=!0;this.group=void 0;this.execute=function(e){var k;k=e.getIteratorAtPosition(d);return(k=e.getParagraphElement(k.container()))?(""!==b?k.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",b):k.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),e.getOdfCanvas().refreshSize(),e.emit(ops.OdtDocument.signalParagraphChanged,
{paragraphElement:k,timeStamp:g,memberId:f}),e.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=function(){return{optype:"SetParagraphStyle",memberid:f,timestamp:g,position:d,styleName:b}}};ops.OpSplitParagraph=function(){var f,g,d,b,e;this.init=function(k){f=k.memberid;g=k.timestamp;d=k.position;b="true"===k.moveCursor||!0===k.moveCursor;e=new odf.OdfUtils};this.isEdit=!0;this.group=void 0;this.execute=function(k){var l,p,q,m,r,c,a,n=k.getCursor(f);k.upgradeWhitespacesAtPosition(d);l=k.getTextNodeAtStep(d);if(!l)return!1;p=k.getParagraphElement(l.textNode);if(!p)return!1;q=e.isListItem(p.parentNode)?p.parentNode:p;0===l.offset?(a=l.textNode.previousSibling,c=null):(a=l.textNode,c=l.offset>=
l.textNode.length?null:l.textNode.splitText(l.offset));for(m=l.textNode;m!==q;){m=m.parentNode;r=m.cloneNode(!1);c&&r.appendChild(c);if(a)for(;a&&a.nextSibling;)r.appendChild(a.nextSibling);else for(;m.firstChild;)r.appendChild(m.firstChild);m.parentNode.insertBefore(r,m.nextSibling);a=m;c=r}e.isListItem(c)&&(c=c.childNodes.item(0));0===l.textNode.length&&l.textNode.parentNode.removeChild(l.textNode);k.emit(ops.OdtDocument.signalStepsInserted,{position:d});n&&b&&(k.moveCursor(f,d+1,0),k.emit(ops.Document.signalCursorMoved,
n));k.fixCursorPositions();k.getOdfCanvas().refreshSize();k.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:p,memberId:f,timeStamp:g});k.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:c,memberId:f,timeStamp:g});k.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"SplitParagraph",memberid:f,timestamp:g,position:d,moveCursor:b}}};ops.OpUpdateMember=function(){function f(d){var e="//dc:creator[@editinfo:memberid='"+g+"']";d=xmldom.XPath.getODFElementsWithXPath(d.getRootNode(),e,function(b){return"editinfo"===b?"urn:webodf:names:editinfo":odf.Namespaces.lookupNamespaceURI(b)});for(e=0;e<d.length;e+=1)d[e].textContent=b.fullName}var g,d,b,e;this.init=function(f){g=f.memberid;d=parseInt(f.timestamp,10);b=f.setProperties;e=f.removedProperties};this.isEdit=!1;this.group=void 0;this.execute=function(d){var l=d.getMember(g);if(!l)return!1;
e&&l.removeProperties(e);b&&(l.setProperties(b),b.fullName&&f(d));d.emit(ops.Document.signalMemberUpdated,l);return!0};this.spec=function(){return{optype:"UpdateMember",memberid:g,timestamp:d,setProperties:b,removedProperties:e}}};ops.OpUpdateMetadata=function(){var f,g,d,b;this.init=function(e){f=e.memberid;g=parseInt(e.timestamp,10);d=e.setProperties;b=e.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(e){e=e.getOdfCanvas().odfContainer();var f=null;b&&(f=b.attributes.split(","));e.setMetadata(d,f);return!0};this.spec=function(){return{optype:"UpdateMetadata",memberid:f,timestamp:g,setProperties:d,removedProperties:b}}};ops.OpUpdateParagraphStyle=function(){function f(b,d){var e,f,c=d?d.split(","):[];for(e=0;e<c.length;e+=1)f=c[e].split(":"),b.removeAttributeNS(odf.Namespaces.lookupNamespaceURI(f[0]),f[1])}var g,d,b,e,k,l=odf.Namespaces.stylens;this.init=function(f){g=f.memberid;d=f.timestamp;b=f.styleName;e=f.setProperties;k=f.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(d){var g=d.getFormatting(),m,r,c;return(m=""!==b?d.getParagraphStyleElement(b):g.getDefaultStyleElement("paragraph"))?
(r=m.getElementsByTagNameNS(l,"paragraph-properties").item(0),c=m.getElementsByTagNameNS(l,"text-properties").item(0),e&&g.updateStyle(m,e),k&&(g=k["style:paragraph-properties"],r&&g&&(f(r,g.attributes),0===r.attributes.length&&m.removeChild(r)),g=k["style:text-properties"],c&&g&&(f(c,g.attributes),0===c.attributes.length&&m.removeChild(c)),f(m,k.attributes)),d.getOdfCanvas().refreshCSS(),d.emit(ops.OdtDocument.signalParagraphStyleModified,b),d.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=
function(){return{optype:"UpdateParagraphStyle",memberid:g,timestamp:d,styleName:b,setProperties:e,removedProperties:k}}};ops.OperationFactory=function(){function f(d){return function(b){return new d}}var g;this.register=function(d,b){g[d]=b};this.create=function(d){var b=null,e=g[d.optype];e&&(b=e(d),b.init(d));return b};g={AddMember:f(ops.OpAddMember),UpdateMember:f(ops.OpUpdateMember),RemoveMember:f(ops.OpRemoveMember),AddCursor:f(ops.OpAddCursor),ApplyDirectStyling:f(ops.OpApplyDirectStyling),SetBlob:f(ops.OpSetBlob),RemoveBlob:f(ops.OpRemoveBlob),InsertImage:f(ops.OpInsertImage),InsertTable:f(ops.OpInsertTable),
InsertText:f(ops.OpInsertText),RemoveText:f(ops.OpRemoveText),SplitParagraph:f(ops.OpSplitParagraph),SetParagraphStyle:f(ops.OpSetParagraphStyle),UpdateParagraphStyle:f(ops.OpUpdateParagraphStyle),AddStyle:f(ops.OpAddStyle),RemoveStyle:f(ops.OpRemoveStyle),MoveCursor:f(ops.OpMoveCursor),RemoveCursor:f(ops.OpRemoveCursor),AddAnnotation:f(ops.OpAddAnnotation),RemoveAnnotation:f(ops.OpRemoveAnnotation),UpdateMetadata:f(ops.OpUpdateMetadata),ApplyHyperlink:f(ops.OpApplyHyperlink),RemoveHyperlink:f(ops.OpRemoveHyperlink)}};ops.OperationRouter=function(){};ops.OperationRouter.prototype.setOperationFactory=function(f){};ops.OperationRouter.prototype.setPlaybackFunction=function(f){};ops.OperationRouter.prototype.push=function(f){};ops.OperationRouter.prototype.close=function(f){};ops.OperationRouter.prototype.subscribe=function(f,g){};ops.OperationRouter.prototype.unsubscribe=function(f,g){};ops.OperationRouter.prototype.hasLocalUnsyncedOps=function(){};ops.OperationRouter.prototype.hasSessionHostConnection=function(){};
ops.OperationRouter.signalProcessingBatchStart="router/batchstart";ops.OperationRouter.signalProcessingBatchEnd="router/batchend";ops.TrivialOperationRouter=function(){var f=new core.EventNotifier([ops.OperationRouter.signalProcessingBatchStart,ops.OperationRouter.signalProcessingBatchEnd]),g,d,b=0;this.setOperationFactory=function(b){g=b};this.setPlaybackFunction=function(b){d=b};this.push=function(e){b+=1;f.emit(ops.OperationRouter.signalProcessingBatchStart,{});e.forEach(function(e){e=e.spec();e.timestamp=Date.now();e=g.create(e);e.group="g"+b;d(e)});f.emit(ops.OperationRouter.signalProcessingBatchEnd,{})};this.close=function(b){b()};
this.subscribe=function(b,d){f.subscribe(b,d)};this.unsubscribe=function(b,d){f.unsubscribe(b,d)};this.hasLocalUnsyncedOps=function(){return!1};this.hasSessionHostConnection=function(){return!0}};ops.Session=function(f){function g(b){e.emit(ops.OdtDocument.signalProcessingBatchStart,b)}function d(b){e.emit(ops.OdtDocument.signalProcessingBatchEnd,b)}var b=new ops.OperationFactory,e=new ops.OdtDocument(f),k=null;this.setOperationFactory=function(d){b=d;k&&k.setOperationFactory(b)};this.setOperationRouter=function(f){k&&(k.unsubscribe(ops.OperationRouter.signalProcessingBatchStart,g),k.unsubscribe(ops.OperationRouter.signalProcessingBatchEnd,d));k=f;k.subscribe(ops.OperationRouter.signalProcessingBatchStart,
g);k.subscribe(ops.OperationRouter.signalProcessingBatchEnd,d);f.setPlaybackFunction(function(b){e.emit(ops.OdtDocument.signalOperationStart,b);return b.execute(e)?(e.emit(ops.OdtDocument.signalOperationEnd,b),!0):!1});f.setOperationFactory(b)};this.getOperationFactory=function(){return b};this.getOdtDocument=function(){return e};this.enqueue=function(b){k.push(b)};this.close=function(b){k.close(function(d){d?b(d):e.close(b)})};this.destroy=function(b){e.destroy(b)};this.setOperationRouter(new ops.TrivialOperationRouter)};gui.AnnotationController=function(f,g,d){function b(){var b=p.getCursor(d),b=b&&b.getNode(),a=!1;b&&(a=!r.isWithinAnnotation(b,p.getRootNode()));a!==q&&(q=a,m.emit(gui.AnnotationController.annotatableChanged,q))}function e(c){c.getMemberId()===d&&b()}function k(c){c===d&&b()}function l(c){c.getMemberId()===d&&b()}var p=f.getOdtDocument(),q=!1,m=new core.EventNotifier([gui.AnnotationController.annotatableChanged]),r=new odf.OdfUtils;this.isAnnotatable=function(){return q};this.addAnnotation=function(){var b=
new ops.OpAddAnnotation,a=p.getCursorSelection(d),e=a.length,a=a.position;q&&(a=0<=e?a:a+e,e=Math.abs(e),b.init({memberid:d,position:a,length:e,name:d+Date.now()}),f.enqueue([b]))};this.removeAnnotation=function(b){var a,e;a=p.getMember(d).getProperties().fullName;if(!0!==g.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)||a===r.getAnnotationCreator(b))a=p.convertDomPointToCursorStep(b,0)+1,e=p.convertDomPointToCursorStep(b,b.childNodes.length),b=new ops.OpRemoveAnnotation,b.init({memberid:d,
position:a,length:e-a}),e=new ops.OpMoveCursor,e.init({memberid:d,position:0<a?a-1:a,length:0}),f.enqueue([b,e])};this.subscribe=function(b,a){m.subscribe(b,a)};this.unsubscribe=function(b,a){m.unsubscribe(b,a)};this.destroy=function(b){p.unsubscribe(ops.Document.signalCursorAdded,e);p.unsubscribe(ops.Document.signalCursorRemoved,k);p.unsubscribe(ops.Document.signalCursorMoved,l);b()};g.registerConstraint(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN);p.subscribe(ops.Document.signalCursorAdded,
e);p.subscribe(ops.Document.signalCursorRemoved,k);p.subscribe(ops.Document.signalCursorMoved,l);b()};gui.AnnotationController.annotatableChanged="annotatable/changed";gui.Avatar=function(f,g){var d=this,b,e,k;this.setColor=function(b){e.style.borderColor=b};this.setImageUrl=function(b){d.isVisible()?e.src=b:k=b};this.isVisible=function(){return"block"===b.style.display};this.show=function(){k&&(e.src=k,k=void 0);b.style.display="block"};this.hide=function(){b.style.display="none"};this.markAsFocussed=function(d){d?b.classList.add("active"):b.classList.remove("active")};this.destroy=function(d){f.removeChild(b);d()};(function(){var d=f.ownerDocument,k=d.documentElement.namespaceURI;
b=d.createElementNS(k,"div");e=d.createElementNS(k,"img");e.width=64;e.height=64;b.appendChild(e);b.style.width="64px";b.style.height="70px";b.style.position="absolute";b.style.top="-80px";b.style.left="-34px";b.style.display=g?"block":"none";b.className="handle";f.appendChild(b)})()};gui.GuiStepUtils=function(){var f=new odf.OdfUtils,g=new odf.StepUtils,d=new core.DomUtils;this.getContentRect=function(b){b=g.getContentBounds(b);var e,k=null;if(b)if(b.container.nodeType===Node.TEXT_NODE)e=b.container.ownerDocument.createRange(),e.setStart(b.container,b.startOffset),e.setEnd(b.container,b.endOffset),(k=0<e.getClientRects().length?e.getBoundingClientRect():null)&&" "===b.container.data.substring(b.startOffset,b.endOffset)&&1>=k.width&&(k=null),e.detach();else if(f.isCharacterElement(b.container)||
f.isCharacterFrame(b.container))k=d.getBoundingClientRect(b.container);return k}};gui.Caret=function(f,g,d){function b(){m.style.opacity="0"===m.style.opacity?"1":"0";u.trigger()}function e(){n.selectNodeContents(a);return n.getBoundingClientRect()}function k(){Object.keys(A).forEach(function(a){D[a]=A[a]})}function l(){var a,b,g,l;if(!1===A.isShown||f.getSelectionType()!==ops.OdtCursor.RangeSelection||!d&&!f.getSelectedRange().collapsed)A.visibility="hidden",m.style.visibility="hidden",u.cancel();else{A.visibility="visible";m.style.visibility="visible";if(!1===A.isFocused)m.style.opacity=
"1",u.cancel();else{if(x||D.visibility!==A.visibility)m.style.opacity="1",u.cancel();u.trigger()}if(E||t||D.visibility!==A.visibility){a=f.getNode();var n;g=s.getBoundingClientRect(h.getSizer());l=!1;if(0<a.getClientRects().length)n=e(),l=!0;else if(y.setPosition(a,0),n=v.getContentRect(y),!n&&y.nextStep()&&(b=v.getContentRect(y))&&(n=b,l=!0),n||(a.setAttributeNS("urn:webodf:names:cursor","caret-sizer-active","true"),n=e(),l=!0),!n)for(runtime.log("WARN: No suitable client rectangle found for visual caret for "+
f.getMemberId());a;){if(0<a.getClientRects().length){n=s.getBoundingClientRect(a);l=!0;break}a=a.parentNode}n=s.translateRect(n,g,h.getZoomLevel());a={top:n.top,height:n.height,right:l?n.left:n.right};8>a.height&&(a={top:a.top-(8-a.height)/2,height:8,right:a.right});q.style.height=a.height+"px";q.style.top=a.top+"px";q.style.left=a.right+"px";c&&(a=runtime.getWindow().getComputedStyle(m,null),a.font?c.style.font=a.font:(c.style.fontStyle=a.fontStyle,c.style.fontVariant=a.fontVariant,c.style.fontWeight=
a.fontWeight,c.style.fontSize=a.fontSize,c.style.lineHeight=a.lineHeight,c.style.fontFamily=a.fontFamily))}if(t){n=f.getDocument().getCanvas().getElement().parentNode;var p;g=n.offsetWidth-n.clientWidth+5;l=n.offsetHeight-n.clientHeight+5;p=m.getBoundingClientRect();a=p.left-g;b=p.top-l;g=p.right+g;l=p.bottom+l;p=n.getBoundingClientRect();b<p.top?n.scrollTop-=p.top-b:l>p.bottom&&(n.scrollTop+=l-p.bottom);a<p.left?n.scrollLeft-=p.left-a:g>p.right&&(n.scrollLeft+=g-p.right)}}D.isFocused!==A.isFocused&&
r.markAsFocussed(A.isFocused);k();E=t=x=!1}function p(b){q.parentNode.removeChild(q);a.parentNode.removeChild(a);b()}var q,m,r,c,a,n,h=f.getDocument().getCanvas(),s=new core.DomUtils,v=new gui.GuiStepUtils,y,w,u,x=!1,t=!1,E=!1,A={isFocused:!1,isShown:!0,visibility:"hidden"},D={isFocused:!A.isFocused,isShown:!A.isShown,visibility:"hidden"};this.handleUpdate=function(){E=!0;"hidden"!==A.visibility&&(A.visibility="hidden",m.style.visibility="hidden",f.getNode().removeAttributeNS("urn:webodf:names:cursor",
"caret-sizer-active"));w.trigger()};this.refreshCursorBlinking=function(){x=!0;w.trigger()};this.setFocus=function(){A.isFocused=!0;w.trigger()};this.removeFocus=function(){A.isFocused=!1;w.trigger()};this.show=function(){A.isShown=!0;w.trigger()};this.hide=function(){A.isShown=!1;w.trigger()};this.setAvatarImageUrl=function(a){r.setImageUrl(a)};this.setColor=function(a){m.style.borderColor=a;r.setColor(a)};this.getCursor=function(){return f};this.getFocusElement=function(){return m};this.toggleHandleVisibility=
function(){r.isVisible()?r.hide():r.show()};this.showHandle=function(){r.show()};this.hideHandle=function(){r.hide()};this.setOverlayElement=function(a){c=a;q.appendChild(a);E=!0;w.trigger()};this.ensureVisible=function(){t=!0;w.trigger()};this.destroy=function(a){core.Async.destroyAll([w.destroy,u.destroy,r.destroy,p],a)};(function(){var c=f.getDocument(),d=[c.createRootFilter(f.getMemberId()),c.getPositionFilter()],e=c.getDOMDocument();n=e.createRange();a=e.createElement("span");a.className="webodf-caretSizer";
a.textContent="|";f.getNode().appendChild(a);q=e.createElement("div");q.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",f.getMemberId());q.className="webodf-caretOverlay";m=e.createElement("div");m.className="caret";q.appendChild(m);r=new gui.Avatar(q,g);h.getSizer().appendChild(q);y=c.createStepIterator(f.getNode(),0,d,c.getRootNode());w=core.Task.createRedrawTask(l);u=core.Task.createTimeoutTask(b,500);w.triggerImmediate()})()};odf.TextSerializer=function(){function f(b){var e="",k=g.filter?g.filter.acceptNode(b):NodeFilter.FILTER_ACCEPT,l=b.nodeType,p;if((k===NodeFilter.FILTER_ACCEPT||k===NodeFilter.FILTER_SKIP)&&d.isTextContentContainingNode(b))for(p=b.firstChild;p;)e+=f(p),p=p.nextSibling;k===NodeFilter.FILTER_ACCEPT&&(l===Node.ELEMENT_NODE&&d.isParagraph(b)?e+="\n":l===Node.TEXT_NODE&&b.textContent&&(e+=b.textContent));return e}var g=this,d=new odf.OdfUtils;this.filter=null;this.writeToString=function(b){if(!b)return"";
b=f(b);"\n"===b[b.length-1]&&(b=b.substr(0,b.length-1));return b}};gui.MimeDataExporter=function(){var f,g;this.exportRangeToDataTransfer=function(d,b){var e;e=b.startContainer.ownerDocument.createElement("span");e.appendChild(b.cloneContents());e=f.writeToString(e);try{d.setData("text/plain",e)}catch(g){d.setData("Text",e)}};f=new odf.TextSerializer;g=new odf.OdfNodeFilter;f.filter=g};gui.Clipboard=function(f){this.setDataFromRange=function(g,d){var b,e=g.clipboardData;b=runtime.getWindow();!e&&b&&(e=b.clipboardData);e?(b=!0,f.exportRangeToDataTransfer(e,d),g.preventDefault()):b=!1;return b}};gui.SessionContext=function(f,g){var d=f.getOdtDocument(),b=new odf.OdfUtils;this.isLocalCursorWithinOwnAnnotation=function(){var e=d.getCursor(g),f;if(!e)return!1;f=e&&e.getNode();e=d.getMember(g).getProperties().fullName;return(f=b.getParentAnnotation(f,d.getRootNode()))&&b.getAnnotationCreator(f)===e?!0:!1}};gui.StyleSummary=function(f){function g(b,d){var g=b+"|"+d,q;e.hasOwnProperty(g)||(q=[],f.forEach(function(e){e=(e=e[b])&&e[d];-1===q.indexOf(e)&&q.push(e)}),e[g]=q);return e[g]}function d(b,d,e){return function(){var f=g(b,d);return e.length>=f.length&&f.every(function(b){return-1!==e.indexOf(b)})}}function b(b,d){var e=g(b,d);return 1===e.length?e[0]:void 0}var e={};this.getPropertyValues=g;this.getCommonValue=b;this.isBold=d("style:text-properties","fo:font-weight",["bold"]);this.isItalic=d("style:text-properties",
"fo:font-style",["italic"]);this.hasUnderline=d("style:text-properties","style:text-underline-style",["solid"]);this.hasStrikeThrough=d("style:text-properties","style:text-line-through-style",["solid"]);this.fontSize=function(){var d=b("style:text-properties","fo:font-size");return d&&parseFloat(d)};this.fontName=function(){return b("style:text-properties","style:font-name")};this.isAlignedLeft=d("style:paragraph-properties","fo:text-align",["left","start"]);this.isAlignedCenter=d("style:paragraph-properties",
"fo:text-align",["center"]);this.isAlignedRight=d("style:paragraph-properties","fo:text-align",["right","end"]);this.isAlignedJustified=d("style:paragraph-properties","fo:text-align",["justify"]);this.text={isBold:this.isBold,isItalic:this.isItalic,hasUnderline:this.hasUnderline,hasStrikeThrough:this.hasStrikeThrough,fontSize:this.fontSize,fontName:this.fontName};this.paragraph={isAlignedLeft:this.isAlignedLeft,isAlignedCenter:this.isAlignedCenter,isAlignedRight:this.isAlignedRight,isAlignedJustified:this.isAlignedJustified}};gui.DirectFormattingController=function(f,g,d,b,e,k,l){function p(a){var b;a.collapsed?(b=a.startContainer,b.hasChildNodes()&&a.startOffset<b.childNodes.length&&(b=b.childNodes.item(a.startOffset)),a=[b]):a=F.getTextElements(a,!0,!1);return a}function q(a,b){var c={};Object.keys(a).forEach(function(d){var e=a[d](),f=b[d]();e!==f&&(c[d]=f)});return c}function m(){var a,c,d;a=(a=(a=Q.getCursor(b))&&a.getSelectedRange())?p(a):[];a=Q.getFormatting().getAppliedStyles(a);a[0]&&U&&(a[0]=V.mergeObjects(a[0],
U));B=a;d=new gui.StyleSummary(B);a=q(O.text,d.text);c=q(O.paragraph,d.paragraph);O=d;0<Object.keys(a).length&&W.emit(gui.DirectFormattingController.textStylingChanged,a);0<Object.keys(c).length&&W.emit(gui.DirectFormattingController.paragraphStylingChanged,c)}function r(){var a=!0;!0===g.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(a=d.isLocalCursorWithinOwnAnnotation());a!==z&&(z=a,W.emit(gui.DirectFormattingController.enabledChanged,z))}function c(a){("string"===typeof a?a:a.getMemberId())===
b&&(m(),r())}function a(){m()}function n(a){var c=Q.getCursor(b);a=a.paragraphElement;c&&Q.getParagraphElement(c.getNode())===a&&m()}function h(a,b){b(!a());return!0}function s(a){if(z){var c=Q.getCursorSelection(b),d={"style:text-properties":a};0!==c.length?(a=new ops.OpApplyDirectStyling,a.init({memberid:b,position:c.position,length:c.length,setProperties:d}),f.enqueue([a])):(U=V.mergeObjects(U||{},d),m())}}function v(a,b){var c={};c[a]=b;s(c)}function y(a){a=a.spec();U&&a.memberid===b&&"SplitParagraph"!==
a.optype&&(U=null,m())}function w(a){v("fo:font-weight",a?"bold":"normal")}function u(a){v("fo:font-style",a?"italic":"normal")}function x(a){v("style:text-underline-style",a?"solid":"none")}function t(a){v("style:text-line-through-style",a?"solid":"none")}function E(a){return a===ops.OdtStepsTranslator.NEXT_STEP}function A(a){if(z){var c=Q.getCursor(b).getSelectedRange(),c=F.getParagraphElements(c),d=Q.getFormatting(),h=[],g={},k;c.forEach(function(c){var f=Q.convertDomPointToCursorStep(c,0,E),l=
c.getAttributeNS(odf.Namespaces.textns,"style-name"),n;c=l?g.hasOwnProperty(l)?g[l]:void 0:k;c||(c=e.generateStyleName(),l?(g[l]=c,n=d.createDerivedStyleObject(l,"paragraph",{})):(k=c,n={}),n=a(n),l=new ops.OpAddStyle,l.init({memberid:b,styleName:c.toString(),styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:n}),h.push(l));l=new ops.OpSetParagraphStyle;l.init({memberid:b,styleName:c.toString(),position:f});h.push(l)});f.enqueue(h)}}function D(a){A(function(b){return V.mergeObjects(b,a)})}
function L(a){D({"style:paragraph-properties":{"fo:text-align":a}})}function I(a,b){var c=Q.getFormatting().getDefaultTabStopDistance(),d=b["style:paragraph-properties"],e;d&&(d=d["fo:margin-left"],e=F.parseLength(d));return V.mergeObjects(b,{"style:paragraph-properties":{"fo:margin-left":e&&e.unit===c.unit?e.value+a*c.value+e.unit:a*c.value+c.unit}})}function P(a,b){var c=p(a),d=Q.getFormatting().getAppliedStyles(c)[0],e=Q.getFormatting().getAppliedStylesForElement(b);if(!d||"text"!==d["style:family"]||
!d["style:text-properties"])return!1;if(!e||!e["style:text-properties"])return!0;d=d["style:text-properties"];e=e["style:text-properties"];return!Object.keys(d).every(function(a){return d[a]===e[a]})}function M(){}function T(){return!1}var C=this,Q=f.getOdtDocument(),V=new core.Utils,F=new odf.OdfUtils,W=new core.EventNotifier([gui.DirectFormattingController.enabledChanged,gui.DirectFormattingController.textStylingChanged,gui.DirectFormattingController.paragraphStylingChanged]),ha=odf.Namespaces.textns,
ga=core.PositionFilter.FilterResult.FILTER_ACCEPT,U,B=[],O=new gui.StyleSummary(B),z=!1;this.isEnabled=function(){return z};this.formatTextSelection=s;this.createCursorStyleOp=function(a,c,d){var e=null;(d=d?B[0]:U)&&d["style:text-properties"]&&(e=new ops.OpApplyDirectStyling,e.init({memberid:b,position:a,length:c,setProperties:{"style:text-properties":d["style:text-properties"]}}),U=null,m());return e};this.setBold=w;this.setItalic=u;this.setHasUnderline=x;this.setHasStrikethrough=t;this.setFontSize=
function(a){v("fo:font-size",a+"pt")};this.setFontName=function(a){v("style:font-name",a)};this.getAppliedStyles=function(){return B};this.toggleBold=h.bind(C,function(){return O.isBold()},w);this.toggleItalic=h.bind(C,function(){return O.isItalic()},u);this.toggleUnderline=h.bind(C,function(){return O.hasUnderline()},x);this.toggleStrikethrough=h.bind(C,function(){return O.hasStrikeThrough()},t);this.isBold=function(){return O.isBold()};this.isItalic=function(){return O.isItalic()};this.hasUnderline=
function(){return O.hasUnderline()};this.hasStrikeThrough=function(){return O.hasStrikeThrough()};this.fontSize=function(){return O.fontSize()};this.fontName=function(){return O.fontName()};this.isAlignedLeft=function(){return O.isAlignedLeft()};this.isAlignedCenter=function(){return O.isAlignedCenter()};this.isAlignedRight=function(){return O.isAlignedRight()};this.isAlignedJustified=function(){return O.isAlignedJustified()};this.alignParagraphLeft=function(){L("left");return!0};this.alignParagraphCenter=
function(){L("center");return!0};this.alignParagraphRight=function(){L("right");return!0};this.alignParagraphJustified=function(){L("justify");return!0};this.indent=function(){A(I.bind(null,1));return!0};this.outdent=function(){A(I.bind(null,-1));return!0};this.createParagraphStyleOps=function(a){if(!z)return[];var c=Q.getCursor(b),d=c.getSelectedRange(),f=[],h,g;c.hasForwardSelection()?(h=c.getAnchorNode(),g=c.getNode()):(h=c.getNode(),g=c.getAnchorNode());c=Q.getParagraphElement(g);runtime.assert(Boolean(c),
"DirectFormattingController: Cursor outside paragraph");var k;a:{k=c;var l=gui.SelectionMover.createPositionIterator(k),n=new core.PositionFilterChain;n.addFilter(Q.getPositionFilter());n.addFilter(Q.createRootFilter(b));for(l.setUnfilteredPosition(d.endContainer,d.endOffset);l.nextPosition();)if(n.acceptPosition(l)===ga){k=Q.getParagraphElement(l.getCurrentNode())!==k;break a}k=!0}if(!k)return f;g!==h&&(c=Q.getParagraphElement(h));if(!U&&!P(d,c))return f;d=B[0];if(!d)return f;if(h=c.getAttributeNS(ha,
"style-name"))d={"style:text-properties":d["style:text-properties"]},d=Q.getFormatting().createDerivedStyleObject(h,"paragraph",d);c=e.generateStyleName();h=new ops.OpAddStyle;h.init({memberid:b,styleName:c,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:d});f.push(h);h=new ops.OpSetParagraphStyle;h.init({memberid:b,styleName:c,position:a});f.push(h);return f};this.subscribe=function(a,b){W.subscribe(a,b)};this.unsubscribe=function(a,b){W.unsubscribe(a,b)};this.destroy=function(b){Q.unsubscribe(ops.Document.signalCursorAdded,
c);Q.unsubscribe(ops.Document.signalCursorRemoved,c);Q.unsubscribe(ops.Document.signalCursorMoved,c);Q.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,a);Q.unsubscribe(ops.OdtDocument.signalParagraphChanged,n);Q.unsubscribe(ops.OdtDocument.signalOperationEnd,y);g.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r);b()};(function(){Q.subscribe(ops.Document.signalCursorAdded,c);Q.subscribe(ops.Document.signalCursorRemoved,c);Q.subscribe(ops.Document.signalCursorMoved,c);Q.subscribe(ops.OdtDocument.signalParagraphStyleModified,
a);Q.subscribe(ops.OdtDocument.signalParagraphChanged,n);Q.subscribe(ops.OdtDocument.signalOperationEnd,y);g.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r);m();r();k||(C.formatTextSelection=M,C.setBold=M,C.setItalic=M,C.setHasUnderline=M,C.setHasStrikethrough=M,C.setFontSize=M,C.setFontName=M,C.toggleBold=T,C.toggleItalic=T,C.toggleUnderline=T,C.toggleStrikethrough=T);l||(C.alignParagraphCenter=M,C.alignParagraphJustified=M,C.alignParagraphLeft=M,C.alignParagraphRight=M,C.createParagraphStyleOps=
function(){return[]},C.indent=M,C.outdent=M)})()};gui.DirectFormattingController.enabledChanged="enabled/changed";gui.DirectFormattingController.textStylingChanged="textStyling/changed";gui.DirectFormattingController.paragraphStylingChanged="paragraphStyling/changed";gui.KeyboardHandler=function(){function f(b,d){d||(d=g.None);switch(b){case gui.KeyboardHandler.KeyCode.LeftMeta:case gui.KeyboardHandler.KeyCode.RightMeta:case gui.KeyboardHandler.KeyCode.MetaInMozilla:d|=g.Meta;break;case gui.KeyboardHandler.KeyCode.Ctrl:d|=g.Ctrl;break;case gui.KeyboardHandler.KeyCode.Alt:d|=g.Alt;break;case gui.KeyboardHandler.KeyCode.Shift:d|=g.Shift}return b+":"+d}var g=gui.KeyboardHandler.Modifier,d=null,b={};this.setDefault=function(b){d=b};this.bind=function(d,g,l,p){d=f(d,
g);runtime.assert(p||!1===b.hasOwnProperty(d),"tried to overwrite the callback handler of key combo: "+d);b[d]=l};this.unbind=function(d,g){var l=f(d,g);delete b[l]};this.reset=function(){d=null;b={}};this.handleEvent=function(e){var k=e.keyCode,l=g.None;e.metaKey&&(l|=g.Meta);e.ctrlKey&&(l|=g.Ctrl);e.altKey&&(l|=g.Alt);e.shiftKey&&(l|=g.Shift);k=f(k,l);k=b[k];l=!1;k?l=k():null!==d&&(l=d(e));l&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}};
gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12};gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Ctrl:17,Alt:18,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,MetaInMozilla:224};gui.HyperlinkClickHandler=function(f,g,d){function b(){var a=f();runtime.assert(Boolean(a.classList),"Document container has no classList element");a.classList.remove("webodf-inactiveLinks")}function e(){var a=f();runtime.assert(Boolean(a.classList),"Document container has no classList element");a.classList.add("webodf-inactiveLinks")}function k(){c.removeEventListener("focus",e,!1);n.forEach(function(a){g.unbind(a.keyCode,a.modifier);d.unbind(a.keyCode,a.modifier)});n.length=0}function l(a){k();
if(a!==p.None){c.addEventListener("focus",e,!1);switch(a){case p.Ctrl:n.push({keyCode:q.Ctrl,modifier:p.None});break;case p.Meta:n.push({keyCode:q.LeftMeta,modifier:p.None}),n.push({keyCode:q.RightMeta,modifier:p.None}),n.push({keyCode:q.MetaInMozilla,modifier:p.None})}n.forEach(function(a){g.bind(a.keyCode,a.modifier,b);d.bind(a.keyCode,a.modifier,e)})}}var p=gui.KeyboardHandler.Modifier,q=gui.KeyboardHandler.KeyCode,m=xmldom.XPath,r=new odf.OdfUtils,c=runtime.getWindow(),a=p.None,n=[];runtime.assert(null!==
c,"Expected to be run in an environment which has a global window, like a browser.");this.handleClick=function(b){var d=b.target||b.srcElement,e,g;b.ctrlKey?e=p.Ctrl:b.metaKey&&(e=p.Meta);if(a===p.None||a===e){a:{for(;null!==d;){if(r.isHyperlink(d))break a;if(r.isParagraph(d))break;d=d.parentNode}d=null}d&&(d=r.getHyperlinkTarget(d),""!==d&&("#"===d[0]?(d=d.substring(1),e=f(),g=m.getODFElementsWithXPath(e,"//text:bookmark-start[@text:name='"+d+"']",odf.Namespaces.lookupNamespaceURI),0===g.length&&
(g=m.getODFElementsWithXPath(e,"//text:bookmark[@text:name='"+d+"']",odf.Namespaces.lookupNamespaceURI)),0<g.length&&g[0].scrollIntoView(!0)):c.open(d),b.preventDefault?b.preventDefault():b.returnValue=!1))}};this.setModifier=function(c){a!==c&&(runtime.assert(c===p.None||c===p.Ctrl||c===p.Meta,"Unsupported KeyboardHandler.Modifier value: "+c),a=c,a!==p.None?e():b(),l(a))};this.getModifier=function(){return a};this.destroy=function(a){e();k();a()}};gui.EventManager=function(f){function g(a){function b(a,c,d){var e,f=!1;e="on"+c;a.attachEvent&&(a.attachEvent(e,d),f=!0);!f&&a.addEventListener&&(a.addEventListener(c,d,!1),f=!0);f&&!x[c]||!a.hasOwnProperty(e)||(a[e]=d)}function c(a,b,d){var e="on"+b;a.detachEvent&&a.detachEvent(e,d);a.removeEventListener&&a.removeEventListener(b,d,!1);a[e]===d&&(a[e]=null)}function d(b){if(-1===f.indexOf(b)){f.push(b);if(e.filters.every(function(a){return a(b)}))try{h.emit(a,b)}catch(c){runtime.log("Error occurred while processing "+
a+":\n"+c.message+"\n"+c.stack)}runtime.setTimeout(function(){f.splice(f.indexOf(b),1)},0)}}var e=this,f=[],h=new core.EventNotifier([a]);this.filters=[];this.subscribe=function(b){h.subscribe(a,b)};this.unsubscribe=function(b){h.unsubscribe(a,b)};this.destroy=function(){c(u,a,d);c(D,a,d);c(L,a,d)};t[a]&&b(u,a,d);b(D,a,d);b(L,a,d)}function d(a,b,c){function d(b){c(b,e,function(b){b.type=a;f.emit(a,b)})}var e={},f=new core.EventNotifier([a]);this.subscribe=function(b){f.subscribe(a,b)};this.unsubscribe=
function(b){f.unsubscribe(a,b)};this.destroy=function(){b.forEach(function(a){I.unsubscribe(a,d)})};(function(){b.forEach(function(a){I.subscribe(a,d)})})()}function b(a){runtime.clearTimeout(a);delete P[a]}function e(a,c){var d=runtime.setTimeout(function(){a();b(d)},c);P[d]=!0;return d}function k(a,c,d){var f=a.touches.length,h=a.touches[0],g=c.timer;"touchmove"===a.type||"touchend"===a.type?g&&b(g):"touchstart"===a.type&&(1!==f?runtime.clearTimeout(g):g=e(function(){d({clientX:h.clientX,clientY:h.clientY,
pageX:h.pageX,pageY:h.pageY,target:a.target||a.srcElement||null,detail:1})},400));c.timer=g}function l(a,b,c){var d=a.touches[0],e=a.target||a.srcElement||null,f=b.target;1!==a.touches.length||"touchend"===a.type?f=null:"touchstart"===a.type&&"webodf-draggable"===e.getAttribute("class")?f=e:"touchmove"===a.type&&f&&(a.preventDefault(),a.stopPropagation(),c({clientX:d.clientX,clientY:d.clientY,pageX:d.pageX,pageY:d.pageY,target:f,detail:1}));b.target=f}function p(a,b,c){var d=a.target||a.srcElement||
null,e=b.dragging;"drag"===a.type?e=!0:"touchend"===a.type&&e&&(e=!1,a=a.changedTouches[0],c({clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY,target:d,detail:1}));b.dragging=e}function q(){L.classList.add("webodf-touchEnabled");I.unsubscribe("touchstart",q)}function m(a){var b=a.scrollX,c=a.scrollY;this.restore=function(){a.scrollX===b&&a.scrollY===c||a.scrollTo(b,c)}}function r(a){var b=a.scrollTop,c=a.scrollLeft;this.restore=function(){if(a.scrollTop!==b||a.scrollLeft!==c)a.scrollTop=
b,a.scrollLeft=c}}function c(a,b){var c=A[a]||E[a]||null;!c&&b&&(c=A[a]=new g(a));return c}function a(a,b){c(a,!0).subscribe(b)}function n(a,b){var d=c(a,!1);d&&d.unsubscribe(b)}function h(){return f.getDOMDocument().activeElement===D}function s(){h()&&D.blur();D.setAttribute("disabled","true")}function v(){D.removeAttribute("disabled")}function y(a){for(var b=[];a;)(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight)&&b.push(new r(a)),a=a.parentNode;b.push(new m(u));return b}function w(){var a;
h()||(a=y(D),v(),D.focus(),a.forEach(function(a){a.restore()}))}var u=runtime.getWindow(),x={beforecut:!0,beforepaste:!0,longpress:!0,drag:!0,dragstop:!0},t={mousedown:!0,mouseup:!0,focus:!0},E={},A={},D,L=f.getCanvas().getElement(),I=this,P={};this.addFilter=function(a,b){c(a,!0).filters.push(b)};this.removeFilter=function(a,b){var d=c(a,!0),e=d.filters.indexOf(b);-1!==e&&d.filters.splice(e,1)};this.subscribe=a;this.unsubscribe=n;this.hasFocus=h;this.focus=w;this.getEventTrap=function(){return D};
this.setEditing=function(a){var b=h();b&&D.blur();a?D.removeAttribute("readOnly"):D.setAttribute("readOnly","true");b&&w()};this.destroy=function(a){n("touchstart",q);Object.keys(P).forEach(function(a){b(parseInt(a,10))});P.length=0;Object.keys(E).forEach(function(a){E[a].destroy()});E={};n("mousedown",s);n("mouseup",v);n("contextmenu",v);Object.keys(A).forEach(function(a){A[a].destroy()});A={};D.parentNode.removeChild(D);a()};(function(){var b=f.getOdfCanvas().getSizer(),c=b.ownerDocument;runtime.assert(Boolean(u),
"EventManager requires a window object to operate correctly");D=c.createElement("input");D.id="eventTrap";D.setAttribute("tabindex","-1");D.setAttribute("readOnly","true");b.appendChild(D);a("mousedown",s);a("mouseup",v);a("contextmenu",v);E.longpress=new d("longpress",["touchstart","touchmove","touchend"],k);E.drag=new d("drag",["touchstart","touchmove","touchend"],l);E.dragstop=new d("dragstop",["drag","touchend"],p);a("touchstart",q)})()};gui.IOSSafariSupport=function(f){function g(){d.innerHeight!==d.outerHeight&&(b.style.display="none",runtime.requestAnimationFrame(function(){b.style.display="block"}))}var d=runtime.getWindow(),b=f.getEventTrap();this.destroy=function(d){f.unsubscribe("focus",g);b.removeAttribute("autocapitalize");b.style.WebkitTransform="";d()};f.subscribe("focus",g);b.setAttribute("autocapitalize","off");b.style.WebkitTransform="translateX(-10000px)"};gui.HyperlinkController=function(f,g,d,b){function e(){var b=!0;!0===g.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(b=d.isLocalCursorWithinOwnAnnotation());b!==m&&(m=b,q.emit(gui.HyperlinkController.enabledChanged,m))}function k(d){d.getMemberId()===b&&e()}var l=new odf.OdfUtils,p=f.getOdtDocument(),q=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),m=!1;this.isEnabled=function(){return m};this.subscribe=function(b,c){q.subscribe(b,c)};this.unsubscribe=function(b,c){q.unsubscribe(b,
c)};this.addHyperlink=function(d,c){if(m){var a=p.getCursorSelection(b),e=new ops.OpApplyHyperlink,h=[];if(0===a.length||c)c=c||d,e=new ops.OpInsertText,e.init({memberid:b,position:a.position,text:c}),a.length=c.length,h.push(e);e=new ops.OpApplyHyperlink;e.init({memberid:b,position:a.position,length:a.length,hyperlink:d});h.push(e);f.enqueue(h)}};this.removeHyperlinks=function(){if(m){var d=gui.SelectionMover.createPositionIterator(p.getRootNode()),c=p.getCursor(b).getSelectedRange(),a=l.getHyperlinkElements(c),
e=c.collapsed&&1===a.length,h=p.getDOMDocument().createRange(),g=[],k,q;0!==a.length&&(a.forEach(function(a){h.selectNodeContents(a);k=p.convertDomToCursorRange({anchorNode:h.startContainer,anchorOffset:h.startOffset,focusNode:h.endContainer,focusOffset:h.endOffset});q=new ops.OpRemoveHyperlink;q.init({memberid:b,position:k.position,length:k.length});g.push(q)}),e||(e=a[0],-1===c.comparePoint(e,0)&&(h.setStart(e,0),h.setEnd(c.startContainer,c.startOffset),k=p.convertDomToCursorRange({anchorNode:h.startContainer,
anchorOffset:h.startOffset,focusNode:h.endContainer,focusOffset:h.endOffset}),0<k.length&&(q=new ops.OpApplyHyperlink,q.init({memberid:b,position:k.position,length:k.length,hyperlink:l.getHyperlinkTarget(e)}),g.push(q))),a=a[a.length-1],d.moveToEndOfNode(a),d=d.unfilteredDomOffset(),1===c.comparePoint(a,d)&&(h.setStart(c.endContainer,c.endOffset),h.setEnd(a,d),k=p.convertDomToCursorRange({anchorNode:h.startContainer,anchorOffset:h.startOffset,focusNode:h.endContainer,focusOffset:h.endOffset}),0<k.length&&
(q=new ops.OpApplyHyperlink,q.init({memberid:b,position:k.position,length:k.length,hyperlink:l.getHyperlinkTarget(a)}),g.push(q)))),f.enqueue(g),h.detach())}};this.destroy=function(b){p.unsubscribe(ops.Document.signalCursorMoved,k);g.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,e);b()};p.subscribe(ops.Document.signalCursorMoved,k);g.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,e);e()};gui.HyperlinkController.enabledChanged="enabled/changed";gui.ImageController=function(f,g,d,b,e){function k(){var b=!0;!0===g.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(b=d.isLocalCursorWithinOwnAnnotation());b!==a&&(a=b,c.emit(gui.ImageController.enabledChanged,a))}function l(a){a.getMemberId()===b&&k()}var p={"image/gif":".gif","image/jpeg":".jpg","image/png":".png"},q=odf.Namespaces.textns,m=f.getOdtDocument(),r=m.getFormatting(),c=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),a=!1;this.isEnabled=function(){return a};this.subscribe=
function(a,b){c.subscribe(a,b)};this.unsubscribe=function(a,b){c.unsubscribe(a,b)};this.insertImage=function(c,d,g,k){if(a){runtime.assert(0<g&&0<k,"Both width and height of the image should be greater than 0px.");k={width:g,height:k};if(g=m.getParagraphElement(m.getCursor(b).getNode()).getAttributeNS(q,"style-name")){g=r.getContentSize(g,"paragraph");var l=1,w=1;k.width>g.width&&(l=g.width/k.width);k.height>g.height&&(w=g.height/k.height);g=Math.min(l,w);k={width:k.width*g,height:k.height*g}}g=k.width+
"px";k=k.height+"px";var u=m.getOdfCanvas().odfContainer().rootElement.styles,l=c.toLowerCase(),w=p.hasOwnProperty(l)?p[l]:null,x,l=[];runtime.assert(null!==w,"Image type is not supported: "+c);w="Pictures/"+e.generateImageName()+w;x=new ops.OpSetBlob;x.init({memberid:b,filename:w,mimetype:c,content:d});l.push(x);r.getStyleElement("Graphics","graphic",[u])||(c=new ops.OpAddStyle,c.init({memberid:b,styleName:"Graphics",styleFamily:"graphic",isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph",
"svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),l.push(c));c=e.generateStyleName();d=new ops.OpAddStyle;d.init({memberid:b,styleName:c,styleFamily:"graphic",isAutomaticStyle:!0,setProperties:{"style:parent-style-name":"Graphics","style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline",
"style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%","draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false","draw:image-opacity":"100%","draw:color-mode":"standard"}}});l.push(d);x=new ops.OpInsertImage;x.init({memberid:b,position:m.getCursorPosition(b),
filename:w,frameWidth:g,frameHeight:k,frameStyleName:c,frameName:e.generateFrameName()});l.push(x);f.enqueue(l)}};this.destroy=function(a){m.unsubscribe(ops.Document.signalCursorMoved,l);g.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,k);a()};m.subscribe(ops.Document.signalCursorMoved,l);g.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,k);k()};gui.ImageController.enabledChanged="enabled/changed";gui.ImageSelector=function(f){function g(){var d=f.getSizer(),g=e.createElement("div");g.id="imageSelector";g.style.borderWidth="1px";d.appendChild(g);b.forEach(function(b){var d=e.createElement("div");d.className=b;g.appendChild(d)});return g}var d=odf.Namespaces.svgns,b="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),e=f.getElement().ownerDocument,k=!1;this.select=function(b){var p,q,m=e.getElementById("imageSelector");m||(m=g());k=!0;p=m.parentNode;
q=b.getBoundingClientRect();var r=p.getBoundingClientRect(),c=f.getZoomLevel();p=(q.left-r.left)/c-1;q=(q.top-r.top)/c-1;m.style.display="block";m.style.left=p+"px";m.style.top=q+"px";m.style.width=b.getAttributeNS(d,"width");m.style.height=b.getAttributeNS(d,"height")};this.clearSelection=function(){var b;k&&(b=e.getElementById("imageSelector"))&&(b.style.display="none");k=!1};this.isSelectorElement=function(b){var d=e.getElementById("imageSelector");return d?b===d||b.parentNode===d:!1}};(function(){function f(f){function d(b){l=b.which&&String.fromCharCode(b.which)===k;k=void 0;return!1===l}function b(){l=!1}function e(b){k=b.data;l=!1}var k,l=!1;this.destroy=function(k){f.unsubscribe("textInput",b);f.unsubscribe("compositionend",e);f.removeFilter("keypress",d);k()};f.subscribe("textInput",b);f.subscribe("compositionend",e);f.addFilter("keypress",d)}gui.InputMethodEditor=function(g,d){function b(b){a&&(b?a.getNode().setAttributeNS(c,"composing","true"):(a.getNode().removeAttributeNS(c,
"composing"),s.textContent=""))}function e(){w&&(w=!1,b(!1),x.emit(gui.InputMethodEditor.signalCompositionEnd,{data:u}),u="")}function k(){e();a&&a.getSelectedRange().collapsed?n.value="":n.value=v;n.setSelectionRange(0,n.value.length)}function l(){d.hasFocus()&&y.trigger()}function p(){t=void 0;y.cancel();b(!0);w||x.emit(gui.InputMethodEditor.signalCompositionStart,{data:""})}function q(a){a=t=a.data;w=!0;u+=a;y.trigger()}function m(a){a.data!==t&&(a=a.data,w=!0,u+=a,y.trigger());t=void 0}function r(){s.textContent=
n.value}var c="urn:webodf:names:cursor",a=null,n=d.getEventTrap(),h=n.ownerDocument,s,v="b",y,w=!1,u="",x=new core.EventNotifier([gui.InputMethodEditor.signalCompositionStart,gui.InputMethodEditor.signalCompositionEnd]),t,E=[],A;this.subscribe=x.subscribe;this.unsubscribe=x.unsubscribe;this.registerCursor=function(b){b.getMemberId()===g&&(a=b,a.getNode().appendChild(s),b.subscribe(ops.OdtCursor.signalCursorUpdated,l),d.subscribe("input",r),d.subscribe("compositionupdate",r))};this.removeCursor=function(b){a&&
b===g&&(a.getNode().removeChild(s),a.unsubscribe(ops.OdtCursor.signalCursorUpdated,l),d.unsubscribe("input",r),d.unsubscribe("compositionupdate",r),a=null)};this.destroy=function(a){d.unsubscribe("compositionstart",p);d.unsubscribe("compositionend",q);d.unsubscribe("textInput",m);d.unsubscribe("keypress",e);d.unsubscribe("focus",k);core.Async.destroyAll(A,a)};(function(){d.subscribe("compositionstart",p);d.subscribe("compositionend",q);d.subscribe("textInput",m);d.subscribe("keypress",e);d.subscribe("focus",
k);E.push(new f(d));A=E.map(function(a){return a.destroy});s=h.createElement("span");s.setAttribute("id","composer");y=core.Task.createTimeoutTask(k,1);A.push(y.destroy)})()};gui.InputMethodEditor.signalCompositionStart="input/compositionstart";gui.InputMethodEditor.signalCompositionEnd="input/compositionend"})();gui.MetadataController=function(f,g){function d(b){k.emit(gui.MetadataController.signalMetadataChanged,b)}function b(b){var d=-1===l.indexOf(b);d||runtime.log("Setting "+b+" is restricted.");return d}var e=f.getOdtDocument(),k=new core.EventNotifier([gui.MetadataController.signalMetadataChanged]),l=["dc:creator","dc:date","meta:editing-cycles","meta:editing-duration","meta:document-statistic"];this.setMetadata=function(d,e){var k={},l="",c;d&&Object.keys(d).filter(b).forEach(function(a){k[a]=d[a]});
e&&(l=e.filter(b).join(","));if(0<l.length||0<Object.keys(k).length)c=new ops.OpUpdateMetadata,c.init({memberid:g,setProperties:k,removedProperties:0<l.length?{attributes:l}:null}),f.enqueue([c])};this.getMetadata=function(b){var d;runtime.assert("string"===typeof b,"Property must be a string");d=b.split(":");runtime.assert(2===d.length,"Property must be a namespace-prefixed string");b=odf.Namespaces.lookupNamespaceURI(d[0]);runtime.assert(Boolean(b),"Prefix must be for an ODF namespace.");return e.getOdfCanvas().odfContainer().getMetadata(b,
d[1])};this.subscribe=function(b,d){k.subscribe(b,d)};this.unsubscribe=function(b,d){k.unsubscribe(b,d)};this.destroy=function(b){e.unsubscribe(ops.OdtDocument.signalMetadataUpdated,d);b()};e.subscribe(ops.OdtDocument.signalMetadataUpdated,d)};gui.MetadataController.signalMetadataChanged="metadata/changed";gui.PasteController=function(f,g,d,b){function e(){q=!0===g.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?d.isLocalCursorWithinOwnAnnotation():!0}function k(d){d.getMemberId()===b&&e()}function l(b,d){b.init(d);return b}var p=f.getOdtDocument(),q=!1;this.isEnabled=function(){return q};this.paste=function(d){if(q){var e=p.getCursorPosition(b),c=[];d.replace(/\r/g,"").split("\n").forEach(function(a){c.push(l(new ops.OpInsertText,{memberid:b,position:e,text:a,moveCursor:!0}));e+=a.length;c.push(l(new ops.OpSplitParagraph,
{memberid:b,position:e,moveCursor:!0}));e+=1});c.pop();f.enqueue(c)}};this.destroy=function(b){p.unsubscribe(ops.Document.signalCursorMoved,k);g.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,e);b()};p.subscribe(ops.Document.signalCursorMoved,k);g.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,e);e()};odf.WordBoundaryFilter=function(f,g){function d(a,b,c){for(var d=null,e=f.getRootNode(),g;a!==e&&null!==a&&null===d;)g=0>b?a.previousSibling:a.nextSibling,c(g)===NodeFilter.FILTER_ACCEPT&&(d=g),a=a.parentNode;return d}function b(a,b){var c;return null===a?n.NO_NEIGHBOUR:l.isCharacterElement(a)?n.SPACE_CHAR:a.nodeType===e||l.isTextSpan(a)||l.isHyperlink(a)?(c=a.textContent.charAt(b()),q.test(c)?n.SPACE_CHAR:p.test(c)?n.PUNCTUATION_CHAR:n.WORD_CHAR):n.OTHER}var e=Node.TEXT_NODE,k=Node.ELEMENT_NODE,
l=new odf.OdfUtils,p=/[!-#%-*,-\/:-;?-@\[-\]_{}\u00a1\u00ab\u00b7\u00bb\u00bf;\u00b7\u055a-\u055f\u0589-\u058a\u05be\u05c0\u05c3\u05c6\u05f3-\u05f4\u0609-\u060a\u060c-\u060d\u061b\u061e-\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964-\u0965\u0970\u0df4\u0e4f\u0e5a-\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u104a-\u104f\u10fb\u1361-\u1368\u166d-\u166e\u169b-\u169c\u16eb-\u16ed\u1735-\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944-\u1945\u19de-\u19df\u1a1e-\u1a1f\u1b5a-\u1b60\u1c3b-\u1c3f\u1c7e-\u1c7f\u2000-\u206e\u207d-\u207e\u208d-\u208e\u3008-\u3009\u2768-\u2775\u27c5-\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc-\u29fd\u2cf9-\u2cfc\u2cfe-\u2cff\u2e00-\u2e7e\u3000-\u303f\u30a0\u30fb\ua60d-\ua60f\ua673\ua67e\ua874-\ua877\ua8ce-\ua8cf\ua92e-\ua92f\ua95f\uaa5c-\uaa5f\ufd3e-\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a-\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a-\uff1b\uff1f-\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]|\ud800[\udd00-\udd01\udf9f\udfd0]|\ud802[\udd1f\udd3f\ude50-\ude58]|\ud809[\udc00-\udc7e]/,
q=/\s/,m=core.PositionFilter.FilterResult.FILTER_ACCEPT,r=core.PositionFilter.FilterResult.FILTER_REJECT,c=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,a=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,n={NO_NEIGHBOUR:0,SPACE_CHAR:1,PUNCTUATION_CHAR:2,WORD_CHAR:3,OTHER:4};this.acceptPosition=function(e){var f=e.container(),l=e.leftNode(),p=e.rightNode(),q=e.unfilteredDomOffset,u=function(){return e.unfilteredDomOffset()-1};f.nodeType===k&&(null===p&&(p=d(f,1,e.getNodeFilter())),null===l&&(l=
d(f,-1,e.getNodeFilter())));f!==p&&(q=function(){return 0});f!==l&&null!==l&&(u=function(){return l.textContent.length-1});f=b(l,u);p=b(p,q);return f===n.WORD_CHAR&&p===n.WORD_CHAR||f===n.PUNCTUATION_CHAR&&p===n.PUNCTUATION_CHAR||g===c&&f!==n.NO_NEIGHBOUR&&p===n.SPACE_CHAR||g===a&&f===n.SPACE_CHAR&&p!==n.NO_NEIGHBOUR?r:m}};odf.WordBoundaryFilter.IncludeWhitespace={None:0,TRAILING:1,LEADING:2};gui.SelectionController=function(f,g){function d(a,b,c){c=new odf.WordBoundaryFilter(v,c);var d=v.getRootElement(a),e=v.createRootFilter(d);return v.createStepIterator(a,b,[u,e,c],d)}function b(a,b){return b?{anchorNode:a.startContainer,anchorOffset:a.startOffset,focusNode:a.endContainer,focusOffset:a.endOffset}:{anchorNode:a.endContainer,anchorOffset:a.endOffset,focusNode:a.startContainer,focusOffset:a.startOffset}}function e(a,b,c){var d=new ops.OpMoveCursor;d.init({memberid:g,position:a,length:b||
0,selectionType:c});return d}function k(a,c,d){var h;h=v.getCursor(g);h=b(h.getSelectedRange(),h.hasForwardSelection());h.focusNode=a;h.focusOffset=c;d||(h.anchorNode=h.focusNode,h.anchorOffset=h.focusOffset);a=v.convertDomToCursorRange(h);f.enqueue([e(a.position,a.length)])}function l(a){var b;b=d(a.startContainer,a.startOffset,E);b.roundToPreviousStep()&&a.setStart(b.container(),b.offset());b=d(a.endContainer,a.endOffset,A);b.roundToNextStep()&&a.setEnd(b.container(),b.offset())}function p(a){var b=
w.getParagraphElements(a),c=b[0],b=b[b.length-1];c&&a.setStart(c,0);b&&(w.isParagraph(a.endContainer)&&0===a.endOffset?a.setEndBefore(b):a.setEnd(b,b.childNodes.length))}function q(a,b,c,d){var e,f;d?(e=c.startContainer,f=c.startOffset):(e=c.endContainer,f=c.endOffset);y.containsNode(a,e)||(f=0>y.comparePoints(a,0,e,f)?0:a.childNodes.length,e=a);a=v.createStepIterator(e,f,b,w.getParagraphElement(e)||a);a.roundToClosestStep()||runtime.assert(!1,"No step found in requested range");d?c.setStart(a.container(),
a.offset()):c.setEnd(a.container(),a.offset())}function m(a){var b=v.getCursorSelection(g),c=v.getCursor(g).getStepCounter();0!==a&&(a=0<a?c.convertForwardStepsBetweenFilters(a,x,u):-c.convertBackwardStepsBetweenFilters(-a,x,u),a=b.length+a,f.enqueue([e(b.position,a)]))}function r(a){var b=v.getCursorPosition(g),c=v.getCursor(g).getStepCounter();0!==a&&(a=0<a?c.convertForwardStepsBetweenFilters(a,x,u):-c.convertBackwardStepsBetweenFilters(-a,x,u),f.enqueue([e(b+a,0)]))}function c(a,b){var c;c=v.getCursor(g).getNode();
c=v.createStepIterator(c,0,[u,t],v.getRootElement(c));c.advanceStep(a)&&k(c.container(),c.offset(),b)}function a(a,b){var c=v.getParagraphElement(v.getCursor(g).getNode()),d=a===L?1:-1;runtime.assert(Boolean(c),"SelectionController: Cursor outside paragraph");c=v.getCursor(g).getStepCounter().countLinesSteps(d,x);b?m(c):r(c)}function n(a,b){var c=a===core.StepDirection.NEXT?1:-1,c=v.getCursor(g).getStepCounter().countStepsToLineBoundary(c,x);b?m(c):r(c)}function h(a,c){var e=v.getCursor(g),e=b(e.getSelectedRange(),
e.hasForwardSelection()),e=d(e.focusNode,e.focusOffset,E);e.advanceStep(a)&&k(e.container(),e.offset(),c)}function s(a,c,d){var e=!1,f=v.getCursor(g),f=b(f.getSelectedRange(),f.hasForwardSelection()),e=v.getRootElement(f.focusNode);runtime.assert(Boolean(e),"SelectionController: Cursor outside root");f=v.createStepIterator(f.focusNode,f.focusOffset,[u,t],e);f.roundToClosestStep();f.advanceStep(a)&&(d=d(f.container()))&&(a===D?(f.setPosition(d,0),e=f.roundToNextStep()):(f.setPosition(d,d.childNodes.length),
e=f.roundToPreviousStep()),e&&k(f.container(),f.offset(),c))}var v=f.getOdtDocument(),y=new core.DomUtils,w=new odf.OdfUtils,u=v.getPositionFilter(),x=new core.PositionFilterChain,t=v.createRootFilter(g),E=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,A=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,D=core.StepDirection.PREVIOUS,L=core.StepDirection.NEXT;this.selectionToRange=function(a){var b=0<=y.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset),c=a.focusNode.ownerDocument.createRange();
b?(c.setStart(a.anchorNode,a.anchorOffset),c.setEnd(a.focusNode,a.focusOffset)):(c.setStart(a.focusNode,a.focusOffset),c.setEnd(a.anchorNode,a.anchorOffset));return{range:c,hasForwardSelection:b}};this.rangeToSelection=b;this.selectImage=function(a){var b=v.getRootElement(a),c=v.createRootFilter(b),b=v.createStepIterator(a,0,[c,v.getPositionFilter()],b),d;b.roundToPreviousStep()||runtime.assert(!1,"No walkable position before frame");c=b.container();d=b.offset();b.setPosition(a,a.childNodes.length);
b.roundToNextStep()||runtime.assert(!1,"No walkable position after frame");a=v.convertDomToCursorRange({anchorNode:c,anchorOffset:d,focusNode:b.container(),focusOffset:b.offset()});a=e(a.position,a.length,ops.OdtCursor.RegionSelection);f.enqueue([a])};this.expandToWordBoundaries=l;this.expandToParagraphBoundaries=p;this.selectRange=function(a,c,d){var h=v.getOdfCanvas().getElement(),k,n=[u];k=y.containsNode(h,a.startContainer);h=y.containsNode(h,a.endContainer);if(k||h)if(k&&h&&(2===d?l(a):3<=d&&
p(a)),(d=c?v.getRootElement(a.startContainer):v.getRootElement(a.endContainer))||(d=v.getRootNode()),n.push(v.createRootFilter(d)),q(d,n,a,!0),q(d,n,a,!1),a=b(a,c),c=v.convertDomToCursorRange(a),a=v.getCursorSelection(g),c.position!==a.position||c.length!==a.length)a=e(c.position,c.length,ops.OdtCursor.RangeSelection),f.enqueue([a])};this.moveCursorToLeft=function(){c(D,!1);return!0};this.moveCursorToRight=function(){c(L,!1);return!0};this.extendSelectionToLeft=function(){c(D,!0);return!0};this.extendSelectionToRight=
function(){c(L,!0);return!0};this.moveCursorUp=function(){a(D,!1);return!0};this.moveCursorDown=function(){a(L,!1);return!0};this.extendSelectionUp=function(){a(D,!0);return!0};this.extendSelectionDown=function(){a(L,!0);return!0};this.moveCursorBeforeWord=function(){h(D,!1);return!0};this.moveCursorPastWord=function(){h(L,!1);return!0};this.extendSelectionBeforeWord=function(){h(D,!0);return!0};this.extendSelectionPastWord=function(){h(L,!0);return!0};this.moveCursorToLineStart=function(){n(D,!1);
return!0};this.moveCursorToLineEnd=function(){n(L,!1);return!0};this.extendSelectionToLineStart=function(){n(D,!0);return!0};this.extendSelectionToLineEnd=function(){n(L,!0);return!0};this.extendSelectionToParagraphStart=function(){s(D,!0,v.getParagraphElement);return!0};this.extendSelectionToParagraphEnd=function(){s(L,!0,v.getParagraphElement);return!0};this.moveCursorToParagraphStart=function(){s(D,!1,v.getParagraphElement);return!0};this.moveCursorToParagraphEnd=function(){s(L,!1,v.getParagraphElement);
return!0};this.moveCursorToDocumentStart=function(){s(D,!1,v.getRootElement);return!0};this.moveCursorToDocumentEnd=function(){s(L,!1,v.getRootElement);return!0};this.extendSelectionToDocumentStart=function(){s(D,!0,v.getRootElement);return!0};this.extendSelectionToDocumentEnd=function(){s(L,!0,v.getRootElement);return!0};this.extendSelectionToEntireDocument=function(){var a=v.getCursor(g),a=v.getRootElement(a.getNode()),b,c,d;runtime.assert(Boolean(a),"SelectionController: Cursor outside root");
d=v.createStepIterator(a,0,[u,t],a);d.roundToClosestStep();b=d.container();c=d.offset();d.setPosition(a,a.childNodes.length);d.roundToClosestStep();a=v.convertDomToCursorRange({anchorNode:b,anchorOffset:c,focusNode:d.container(),focusOffset:d.offset()});f.enqueue([e(a.position,a.length)]);return!0};x.addFilter(u);x.addFilter(v.createRootFilter(g))};gui.TextController=function(f,g,d,b,e,k){function l(){n=!0===g.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?d.isLocalCursorWithinOwnAnnotation():!0}function p(a){a.getMemberId()===b&&l()}function q(d,e){var f,g;f=new ops.OpRemoveText;var k=[f];f.init({memberid:b,position:e.position,length:e.length});f=c.getParagraphElement(d.startContainer);g=c.getParagraphElement(d.endContainer);f!==g&&(f=a.hasNoODFContent(f)?g.getAttributeNS(odf.Namespaces.textns,"style-name")||"":f.getAttributeNS(odf.Namespaces.textns,
"style-name")||"",g=new ops.OpSetParagraphStyle,g.init({memberid:b,position:e.position,styleName:f}),k.push(g));return k}function m(a){0>a.length&&(a.position+=a.length,a.length=-a.length);return a}function r(a){if(!n)return!1;var d,e=c.getCursor(b).getSelectedRange().cloneRange(),g=m(c.getCursorSelection(b)),k;if(0===g.length){g=void 0;d=c.getCursor(b).getNode();k=c.getRootElement(d);var l=[c.getPositionFilter(),c.createRootFilter(k)];k=c.createStepIterator(d,0,l,k);k.roundToClosestStep()&&(a?k.nextStep():
k.previousStep())&&(g=m(c.convertDomToCursorRange({anchorNode:d,anchorOffset:0,focusNode:k.container(),focusOffset:k.offset()})),a?(e.setStart(d,0),e.setEnd(k.container(),k.offset())):(e.setStart(k.container(),k.offset()),e.setEnd(d,0)))}g&&f.enqueue(q(e,g));return void 0!==g}var c=f.getOdtDocument(),a=new odf.OdfUtils,n=!1;this.isEnabled=function(){return n};this.enqueueParagraphSplittingOps=function(){if(!n)return!1;var a=c.getCursor(b).getSelectedRange(),d=m(c.getCursorSelection(b)),e=[];0<d.length&&
(e=e.concat(q(a,d)));a=new ops.OpSplitParagraph;a.init({memberid:b,position:d.position,moveCursor:!0});e.push(a);k&&(d=k(d.position+1),e=e.concat(d));f.enqueue(e);return!0};this.removeTextByBackspaceKey=function(){return r(!1)};this.removeTextByDeleteKey=function(){return r(!0)};this.removeCurrentSelection=function(){if(!n)return!1;var a=c.getCursor(b).getSelectedRange(),d=m(c.getCursorSelection(b));0!==d.length&&f.enqueue(q(a,d));return!0};this.insertText=function(a){if(n){var d=c.getCursor(b).getSelectedRange(),
g=m(c.getCursorSelection(b)),k=[],l=!1;0<g.length&&(k=k.concat(q(d,g)),l=!0);d=new ops.OpInsertText;d.init({memberid:b,position:g.position,text:a,moveCursor:!0});k.push(d);e&&(a=e(g.position,a.length,l))&&k.push(a);f.enqueue(k)}};this.destroy=function(a){c.unsubscribe(ops.Document.signalCursorMoved,p);g.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,l);a()};c.subscribe(ops.Document.signalCursorMoved,p);g.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,l);l()};gui.UndoManager=function(){};gui.UndoManager.prototype.subscribe=function(f,g){};gui.UndoManager.prototype.unsubscribe=function(f,g){};gui.UndoManager.prototype.setDocument=function(f){};gui.UndoManager.prototype.setInitialState=function(){};gui.UndoManager.prototype.initialize=function(){};gui.UndoManager.prototype.purgeInitialState=function(){};gui.UndoManager.prototype.setPlaybackFunction=function(f){};gui.UndoManager.prototype.hasUndoStates=function(){};
gui.UndoManager.prototype.hasRedoStates=function(){};gui.UndoManager.prototype.moveForward=function(f){};gui.UndoManager.prototype.moveBackward=function(f){};gui.UndoManager.prototype.onOperationExecuted=function(f){};gui.UndoManager.signalUndoStackChanged="undoStackChanged";gui.UndoManager.signalUndoStateCreated="undoStateCreated";gui.UndoManager.signalUndoStateModified="undoStateModified";gui.SessionControllerOptions=function(){this.annotationsEnabled=this.directParagraphStylingEnabled=this.directTextStylingEnabled=!1};
(function(){var f=core.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(g,d,b,e){function k(a){return a.target||a.srcElement||null}function l(a,b){var c=F.getDOMDocument(),d=null;c.caretRangeFromPoint?(c=c.caretRangeFromPoint(a,b),d={container:c.startContainer,offset:c.startOffset}):c.caretPositionFromPoint&&(c=c.caretPositionFromPoint(a,b))&&c.offsetNode&&(d={container:c.offsetNode,offset:c.offset});return d}function p(a){var b=F.getCursor(d).getSelectedRange();b.collapsed?
a.preventDefault():O.setDataFromRange(a,b)?da.removeCurrentSelection():runtime.log("Cut operation failed")}function q(){return!1!==F.getCursor(d).getSelectedRange().collapsed}function m(a){var b=F.getCursor(d).getSelectedRange();b.collapsed?a.preventDefault():O.setDataFromRange(a,b)||runtime.log("Copy operation failed")}function r(a){var b;V.clipboardData&&V.clipboardData.getData?b=V.clipboardData.getData("Text"):a.clipboardData&&a.clipboardData.getData&&(b=a.clipboardData.getData("text/plain"));
b&&(da.removeCurrentSelection(),pa.paste(b));a.preventDefault?a.preventDefault():a.returnValue=!1}function c(){return!1}function a(a){if($)$.onOperationExecuted(a)}function n(a){F.emit(ops.OdtDocument.signalUndoStackChanged,a)}function h(){var a;return $?(a=N.hasFocus(),$.moveBackward(1),a&&N.focus(),!0):!1}function s(){var a;return $?(a=N.hasFocus(),$.moveForward(1),a&&N.focus(),!0):!1}function v(a){var c=F.getCursor(d).getSelectedRange(),e=k(a).getAttribute("end");c&&e&&(a=l(a.clientX,a.clientY))&&
(fa.setUnfilteredPosition(a.container,a.offset),aa.acceptPosition(fa)===f&&(c=c.cloneRange(),"left"===e?c.setStart(fa.container(),fa.unfilteredDomOffset()):c.setEnd(fa.container(),fa.unfilteredDomOffset()),b.setSelectedRange(c,"right"===e),F.emit(ops.Document.signalCursorMoved,b)))}function y(){R.selectRange(b.getSelectedRange(),b.hasForwardSelection(),1)}function w(){var a=V.getSelection(),c=0<a.rangeCount&&R.selectionToRange(a);Y&&c&&(X=!0,ja.clearSelection(),fa.setUnfilteredPosition(a.focusNode,
a.focusOffset),aa.acceptPosition(fa)===f&&(2===ma?R.expandToWordBoundaries(c.range):3<=ma&&R.expandToParagraphBoundaries(c.range),b.setSelectedRange(c.range,c.hasForwardSelection),F.emit(ops.Document.signalCursorMoved,b)))}function u(a){var b=k(a),c=F.getCursor(d);if(Y=null!==b&&ga.containsNode(F.getOdfCanvas().getElement(),b))X=!1,aa=F.createRootFilter(b),ma=0===a.button?a.detail:0,c&&a.shiftKey?V.getSelection().collapse(c.getAnchorNode(),0):(a=V.getSelection(),b=c.getSelectedRange(),a.extend?c.hasForwardSelection()?
(a.collapse(b.startContainer,b.startOffset),a.extend(b.endContainer,b.endOffset)):(a.collapse(b.endContainer,b.endOffset),a.extend(b.startContainer,b.startOffset)):(a.removeAllRanges(),a.addRange(b.cloneRange()))),1<ma&&w()}function x(a){var b=F.getRootElement(a),c=F.createRootFilter(b),b=F.createStepIterator(a,0,[c,F.getPositionFilter()],b);b.setPosition(a,a.childNodes.length);return b.roundToNextStep()?{container:b.container(),offset:b.offset()}:null}function t(a){var b;b=(b=V.getSelection())?{anchorNode:b.anchorNode,
anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}:null;var c=V.getSelection().isCollapsed,d,e;b.anchorNode||b.focusNode||!(d=l(a.clientX,a.clientY))||(b.anchorNode=d.container,b.anchorOffset=d.offset,b.focusNode=b.anchorNode,b.focusOffset=b.anchorOffset);if(U.isImage(b.focusNode)&&0===b.focusOffset&&U.isCharacterFrame(b.focusNode.parentNode)){if(e=b.focusNode.parentNode,d=e.getBoundingClientRect(),a.clientX>d.left&&(d=x(e)))b.focusNode=d.container,b.focusOffset=d.offset,
c&&(b.anchorNode=b.focusNode,b.anchorOffset=b.focusOffset)}else U.isImage(b.focusNode.firstChild)&&1===b.focusOffset&&U.isCharacterFrame(b.focusNode)&&(d=x(b.focusNode))&&(b.anchorNode=b.focusNode=d.container,b.anchorOffset=b.focusOffset=d.offset);b.anchorNode&&b.focusNode&&(b=R.selectionToRange(b),R.selectRange(b.range,b.hasForwardSelection,0===a.button?a.detail:0));N.focus()}function E(a){var b;if(b=l(a.clientX,a.clientY))a=b.container,b=b.offset,a={anchorNode:a,anchorOffset:b,focusNode:a,focusOffset:b},
a=R.selectionToRange(a),R.selectRange(a.range,a.hasForwardSelection,2),N.focus()}function A(a){var c=k(a),d,e;ka.processRequests();Y&&(U.isImage(c)&&U.isCharacterFrame(c.parentNode)&&V.getSelection().isCollapsed?(R.selectImage(c.parentNode),N.focus()):ja.isSelectorElement(c)?N.focus():X?(c=b.getSelectedRange(),d=c.collapsed,U.isImage(c.endContainer)&&0===c.endOffset&&U.isCharacterFrame(c.endContainer.parentNode)&&(e=c.endContainer.parentNode,e=x(e))&&(c.setEnd(e.container,e.offset),d&&c.collapse(!1)),
R.selectRange(c,b.hasForwardSelection(),0===a.button?a.detail:0),N.focus()):ua?t(a):Z=runtime.setTimeout(function(){t(a)},0),ma=0,X=Y=!1)}function D(a){var b=F.getCursor(d).getSelectedRange();b.collapsed||B.exportRangeToDataTransfer(a.dataTransfer,b)}function L(){Y&&N.focus();ma=0;X=Y=!1}function I(a){A(a)}function P(a){var b=k(a),c=null;"annotationRemoveButton"===b.className?(runtime.assert(na,"Remove buttons are displayed on annotations while annotation editing is disabled in the controller."),
c=ga.getElementsByTagNameNS(b.parentNode,odf.Namespaces.officens,"annotation")[0],ba.removeAnnotation(c),N.focus()):"webodf-draggable"!==b.getAttribute("class")&&A(a)}function M(a){(a=a.data)&&(-1===a.indexOf("\n")?da.insertText(a):pa.paste(a))}function T(a){return function(){a();return!0}}function C(a){return function(b){return F.getCursor(d).getSelectionType()===ops.OdtCursor.RangeSelection?a(b):!0}}function Q(b){N.unsubscribe("keydown",z.handleEvent);N.unsubscribe("keypress",S.handleEvent);N.unsubscribe("keyup",
K.handleEvent);N.unsubscribe("copy",m);N.unsubscribe("mousedown",u);N.unsubscribe("mousemove",ka.trigger);N.unsubscribe("mouseup",P);N.unsubscribe("contextmenu",I);N.unsubscribe("dragstart",D);N.unsubscribe("dragend",L);N.unsubscribe("click",la.handleClick);N.unsubscribe("longpress",E);N.unsubscribe("drag",v);N.unsubscribe("dragstop",y);F.unsubscribe(ops.OdtDocument.signalOperationEnd,oa.trigger);F.unsubscribe(ops.Document.signalCursorAdded,ia.registerCursor);F.unsubscribe(ops.Document.signalCursorRemoved,
ia.removeCursor);F.unsubscribe(ops.OdtDocument.signalOperationEnd,a);b()}var V=runtime.getWindow(),F=g.getOdtDocument(),W=new gui.SessionConstraints,ha=new gui.SessionContext(g,d),ga=new core.DomUtils,U=new odf.OdfUtils,B=new gui.MimeDataExporter,O=new gui.Clipboard(B),z=new gui.KeyboardHandler,S=new gui.KeyboardHandler,K=new gui.KeyboardHandler,Y=!1,J=new odf.ObjectNameGenerator(F.getOdfCanvas().odfContainer(),d),X=!1,aa=null,Z,$=null,N=new gui.EventManager(F),na=e.annotationsEnabled,ba=new gui.AnnotationController(g,
W,d),ca=new gui.DirectFormattingController(g,W,ha,d,J,e.directTextStylingEnabled,e.directParagraphStylingEnabled),da=new gui.TextController(g,W,ha,d,ca.createCursorStyleOp,ca.createParagraphStyleOps),qa=new gui.ImageController(g,W,ha,d,J),ja=new gui.ImageSelector(F.getOdfCanvas()),fa=gui.SelectionMover.createPositionIterator(F.getRootNode()),ka,oa,pa=new gui.PasteController(g,W,ha,d),ia=new gui.InputMethodEditor(d,N),ma=0,la=new gui.HyperlinkClickHandler(F.getOdfCanvas().getElement,z,K),ea=new gui.HyperlinkController(g,
W,ha,d),R=new gui.SelectionController(g,d),ta=new gui.MetadataController(g,d),G=gui.KeyboardHandler.Modifier,H=gui.KeyboardHandler.KeyCode,ra=-1!==V.navigator.appVersion.toLowerCase().indexOf("mac"),ua=-1!==["iPad","iPod","iPhone"].indexOf(V.navigator.platform),sa;runtime.assert(null!==V,"Expected to be run in an environment which has a global window, like a browser.");this.undo=h;this.redo=s;this.insertLocalCursor=function(){runtime.assert(void 0===g.getOdtDocument().getCursor(d),"Inserting local cursor a second time.");
var a=new ops.OpAddCursor;a.init({memberid:d});g.enqueue([a]);N.focus()};this.removeLocalCursor=function(){runtime.assert(void 0!==g.getOdtDocument().getCursor(d),"Removing local cursor without inserting before.");var a=new ops.OpRemoveCursor;a.init({memberid:d});g.enqueue([a])};this.startEditing=function(){ia.subscribe(gui.InputMethodEditor.signalCompositionStart,da.removeCurrentSelection);ia.subscribe(gui.InputMethodEditor.signalCompositionEnd,M);N.subscribe("beforecut",q);N.subscribe("cut",p);
N.subscribe("beforepaste",c);N.subscribe("paste",r);$&&$.initialize();N.setEditing(!0);la.setModifier(ra?G.Meta:G.Ctrl);z.bind(H.Backspace,G.None,T(da.removeTextByBackspaceKey),!0);z.bind(H.Delete,G.None,da.removeTextByDeleteKey);z.bind(H.Tab,G.None,C(function(){da.insertText("\t");return!0}));ra?(z.bind(H.Clear,G.None,da.removeCurrentSelection),z.bind(H.B,G.Meta,C(ca.toggleBold)),z.bind(H.I,G.Meta,C(ca.toggleItalic)),z.bind(H.U,G.Meta,C(ca.toggleUnderline)),z.bind(H.L,G.MetaShift,C(ca.alignParagraphLeft)),
z.bind(H.E,G.MetaShift,C(ca.alignParagraphCenter)),z.bind(H.R,G.MetaShift,C(ca.alignParagraphRight)),z.bind(H.J,G.MetaShift,C(ca.alignParagraphJustified)),na&&z.bind(H.C,G.MetaShift,ba.addAnnotation),z.bind(H.Z,G.Meta,h),z.bind(H.Z,G.MetaShift,s)):(z.bind(H.B,G.Ctrl,C(ca.toggleBold)),z.bind(H.I,G.Ctrl,C(ca.toggleItalic)),z.bind(H.U,G.Ctrl,C(ca.toggleUnderline)),z.bind(H.L,G.CtrlShift,C(ca.alignParagraphLeft)),z.bind(H.E,G.CtrlShift,C(ca.alignParagraphCenter)),z.bind(H.R,G.CtrlShift,C(ca.alignParagraphRight)),
z.bind(H.J,G.CtrlShift,C(ca.alignParagraphJustified)),na&&z.bind(H.C,G.CtrlAlt,ba.addAnnotation),z.bind(H.Z,G.Ctrl,h),z.bind(H.Z,G.CtrlShift,s));S.setDefault(C(function(a){var b;b=null===a.which||void 0===a.which?String.fromCharCode(a.keyCode):0!==a.which&&0!==a.charCode?String.fromCharCode(a.which):null;return!b||a.altKey||a.ctrlKey||a.metaKey?!1:(da.insertText(b),!0)}));S.bind(H.Enter,G.None,C(da.enqueueParagraphSplittingOps))};this.endEditing=function(){ia.unsubscribe(gui.InputMethodEditor.signalCompositionStart,
da.removeCurrentSelection);ia.unsubscribe(gui.InputMethodEditor.signalCompositionEnd,M);N.unsubscribe("cut",p);N.unsubscribe("beforecut",q);N.unsubscribe("paste",r);N.unsubscribe("beforepaste",c);N.setEditing(!1);la.setModifier(G.None);z.bind(H.Backspace,G.None,function(){return!0},!0);z.unbind(H.Delete,G.None);z.unbind(H.Tab,G.None);ra?(z.unbind(H.Clear,G.None),z.unbind(H.B,G.Meta),z.unbind(H.I,G.Meta),z.unbind(H.U,G.Meta),z.unbind(H.L,G.MetaShift),z.unbind(H.E,G.MetaShift),z.unbind(H.R,G.MetaShift),
z.unbind(H.J,G.MetaShift),na&&z.unbind(H.C,G.MetaShift),z.unbind(H.Z,G.Meta),z.unbind(H.Z,G.MetaShift)):(z.unbind(H.B,G.Ctrl),z.unbind(H.I,G.Ctrl),z.unbind(H.U,G.Ctrl),z.unbind(H.L,G.CtrlShift),z.unbind(H.E,G.CtrlShift),z.unbind(H.R,G.CtrlShift),z.unbind(H.J,G.CtrlShift),na&&z.unbind(H.C,G.CtrlAlt),z.unbind(H.Z,G.Ctrl),z.unbind(H.Z,G.CtrlShift));S.setDefault(null);S.unbind(H.Enter,G.None)};this.getInputMemberId=function(){return d};this.getSession=function(){return g};this.getSessionConstraints=function(){return W};
this.setUndoManager=function(a){$&&$.unsubscribe(gui.UndoManager.signalUndoStackChanged,n);if($=a)$.setDocument(F),$.setPlaybackFunction(g.enqueue),$.subscribe(gui.UndoManager.signalUndoStackChanged,n)};this.getUndoManager=function(){return $};this.getMetadataController=function(){return ta};this.getAnnotationController=function(){return ba};this.getDirectFormattingController=function(){return ca};this.getHyperlinkClickHandler=function(){return la};this.getHyperlinkController=function(){return ea};
this.getImageController=function(){return qa};this.getSelectionController=function(){return R};this.getTextController=function(){return da};this.getEventManager=function(){return N};this.getKeyboardHandlers=function(){return{keydown:z,keypress:S}};this.destroy=function(a){var b=[ka.destroy,oa.destroy,ca.destroy,ia.destroy,N.destroy,la.destroy,ea.destroy,ta.destroy,da.destroy,Q];sa&&b.unshift(sa.destroy);runtime.clearTimeout(Z);core.Async.destroyAll(b,a)};ka=core.Task.createRedrawTask(w);oa=core.Task.createRedrawTask(function(){var a=
F.getCursor(d);if(a&&a.getSelectionType()===ops.OdtCursor.RegionSelection&&(a=U.getImageElements(a.getSelectedRange())[0])){ja.select(a.parentNode);return}ja.clearSelection()});z.bind(H.Left,G.None,C(R.moveCursorToLeft));z.bind(H.Right,G.None,C(R.moveCursorToRight));z.bind(H.Up,G.None,C(R.moveCursorUp));z.bind(H.Down,G.None,C(R.moveCursorDown));z.bind(H.Left,G.Shift,C(R.extendSelectionToLeft));z.bind(H.Right,G.Shift,C(R.extendSelectionToRight));z.bind(H.Up,G.Shift,C(R.extendSelectionUp));z.bind(H.Down,
G.Shift,C(R.extendSelectionDown));z.bind(H.Home,G.None,C(R.moveCursorToLineStart));z.bind(H.End,G.None,C(R.moveCursorToLineEnd));z.bind(H.Home,G.Ctrl,C(R.moveCursorToDocumentStart));z.bind(H.End,G.Ctrl,C(R.moveCursorToDocumentEnd));z.bind(H.Home,G.Shift,C(R.extendSelectionToLineStart));z.bind(H.End,G.Shift,C(R.extendSelectionToLineEnd));z.bind(H.Up,G.CtrlShift,C(R.extendSelectionToParagraphStart));z.bind(H.Down,G.CtrlShift,C(R.extendSelectionToParagraphEnd));z.bind(H.Home,G.CtrlShift,C(R.extendSelectionToDocumentStart));
z.bind(H.End,G.CtrlShift,C(R.extendSelectionToDocumentEnd));ra?(z.bind(H.Left,G.Alt,C(R.moveCursorBeforeWord)),z.bind(H.Right,G.Alt,C(R.moveCursorPastWord)),z.bind(H.Left,G.Meta,C(R.moveCursorToLineStart)),z.bind(H.Right,G.Meta,C(R.moveCursorToLineEnd)),z.bind(H.Home,G.Meta,C(R.moveCursorToDocumentStart)),z.bind(H.End,G.Meta,C(R.moveCursorToDocumentEnd)),z.bind(H.Left,G.AltShift,C(R.extendSelectionBeforeWord)),z.bind(H.Right,G.AltShift,C(R.extendSelectionPastWord)),z.bind(H.Left,G.MetaShift,C(R.extendSelectionToLineStart)),
z.bind(H.Right,G.MetaShift,C(R.extendSelectionToLineEnd)),z.bind(H.Up,G.AltShift,C(R.extendSelectionToParagraphStart)),z.bind(H.Down,G.AltShift,C(R.extendSelectionToParagraphEnd)),z.bind(H.Up,G.MetaShift,C(R.extendSelectionToDocumentStart)),z.bind(H.Down,G.MetaShift,C(R.extendSelectionToDocumentEnd)),z.bind(H.A,G.Meta,C(R.extendSelectionToEntireDocument))):(z.bind(H.Left,G.Ctrl,C(R.moveCursorBeforeWord)),z.bind(H.Right,G.Ctrl,C(R.moveCursorPastWord)),z.bind(H.Left,G.CtrlShift,C(R.extendSelectionBeforeWord)),
z.bind(H.Right,G.CtrlShift,C(R.extendSelectionPastWord)),z.bind(H.A,G.Ctrl,C(R.extendSelectionToEntireDocument)));ua&&(sa=new gui.IOSSafariSupport(N));N.subscribe("keydown",z.handleEvent);N.subscribe("keypress",S.handleEvent);N.subscribe("keyup",K.handleEvent);N.subscribe("copy",m);N.subscribe("mousedown",u);N.subscribe("mousemove",ka.trigger);N.subscribe("mouseup",P);N.subscribe("contextmenu",I);N.subscribe("dragstart",D);N.subscribe("dragend",L);N.subscribe("click",la.handleClick);N.subscribe("longpress",
E);N.subscribe("drag",v);N.subscribe("dragstop",y);F.subscribe(ops.OdtDocument.signalOperationEnd,oa.trigger);F.subscribe(ops.Document.signalCursorAdded,ia.registerCursor);F.subscribe(ops.Document.signalCursorRemoved,ia.removeCursor);F.subscribe(ops.OdtDocument.signalOperationEnd,a)}})();gui.CaretManager=function(f){function g(b){return a.hasOwnProperty(b)?a[b]:null}function d(){return Object.keys(a).map(function(b){return a[b]})}function b(b){var c=a[b];c&&(delete a[b],b===f.getInputMemberId()&&f.getEventManager().unsubscribe("compositionupdate",c.handleUpdate),c.destroy(function(){}))}function e(a){a=a.getMemberId();a===f.getInputMemberId()&&(a=g(a))&&a.refreshCursorBlinking()}function k(){var a=g(f.getInputMemberId());s=!1;a&&a.ensureVisible()}function l(){var a=g(f.getInputMemberId());
a&&(a.handleUpdate(),s||(s=!0,h=runtime.setTimeout(k,50)))}function p(a){a.memberId===f.getInputMemberId()&&l()}function q(){var a=g(f.getInputMemberId());a&&a.setFocus()}function m(){var a=g(f.getInputMemberId());a&&a.removeFocus()}function r(){var a=g(f.getInputMemberId());a&&a.show()}function c(){var a=g(f.getInputMemberId());a&&a.hide()}var a={},n=runtime.getWindow(),h,s=!1;this.registerCursor=function(b,c,d){var e=b.getMemberId();c=new gui.Caret(b,c,d);d=f.getEventManager();a[e]=c;e===f.getInputMemberId()?
(runtime.log("Starting to track input on new cursor of "+e),b.subscribe(ops.OdtCursor.signalCursorUpdated,l),d.subscribe("compositionupdate",c.handleUpdate),c.setOverlayElement(d.getEventTrap())):b.subscribe(ops.OdtCursor.signalCursorUpdated,c.handleUpdate);return c};this.getCaret=g;this.getCarets=d;this.destroy=function(g){var k=f.getSession().getOdtDocument(),l=f.getEventManager(),s=d().map(function(a){return a.destroy});runtime.clearTimeout(h);k.unsubscribe(ops.OdtDocument.signalParagraphChanged,
p);k.unsubscribe(ops.Document.signalCursorMoved,e);k.unsubscribe(ops.Document.signalCursorRemoved,b);l.unsubscribe("focus",q);l.unsubscribe("blur",m);n.removeEventListener("focus",r,!1);n.removeEventListener("blur",c,!1);a={};core.Async.destroyAll(s,g)};(function(){var a=f.getSession().getOdtDocument(),d=f.getEventManager();a.subscribe(ops.OdtDocument.signalParagraphChanged,p);a.subscribe(ops.Document.signalCursorMoved,e);a.subscribe(ops.Document.signalCursorRemoved,b);d.subscribe("focus",q);d.subscribe("blur",
m);n.addEventListener("focus",r,!1);n.addEventListener("blur",c,!1)})()};gui.EditInfoHandle=function(f){var g=[],d,b=f.ownerDocument,e=b.documentElement.namespaceURI;this.setEdits=function(f){g=f;var l,p,q,m;d.innerHTML="";for(f=0;f<g.length;f+=1)l=b.createElementNS(e,"div"),l.className="editInfo",p=b.createElementNS(e,"span"),p.className="editInfoColor",p.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g[f].memberid),q=b.createElementNS(e,"span"),q.className="editInfoAuthor",q.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g[f].memberid),
m=b.createElementNS(e,"span"),m.className="editInfoTime",m.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g[f].memberid),m.innerHTML=g[f].time,l.appendChild(p),l.appendChild(q),l.appendChild(m),d.appendChild(l)};this.show=function(){d.style.display="block"};this.hide=function(){d.style.display="none"};this.destroy=function(b){f.removeChild(d);b()};d=b.createElementNS(e,"div");d.setAttribute("class","editInfoHandle");d.style.display="none";f.appendChild(d)};ops.EditInfo=function(f,g){function d(){var b=[],d;for(d in e)e.hasOwnProperty(d)&&b.push({memberid:d,time:e[d].time});b.sort(function(b,d){return b.time-d.time});return b}var b,e={};this.getNode=function(){return b};this.getOdtDocument=function(){return g};this.getEdits=function(){return e};this.getSortedEdits=function(){return d()};this.addEdit=function(b,d){e[b]={time:d}};this.clearEdits=function(){e={}};this.destroy=function(d){f.parentNode&&f.removeChild(b);d()};b=g.getDOMDocument().createElementNS("urn:webodf:names:editinfo",
"editinfo");f.insertBefore(b,f.firstChild)};gui.EditInfoMarker=function(f,g){function d(b,c){return runtime.setTimeout(function(){l.style.opacity=b},c)}var b=this,e,k,l,p,q,m;this.addEdit=function(b,c){var a=Date.now()-c;f.addEdit(b,c);k.setEdits(f.getSortedEdits());l.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",b);runtime.clearTimeout(q);runtime.clearTimeout(m);1E4>a?(p=d(1,0),q=d(0.5,1E4-a),m=d(0.2,2E4-a)):1E4<=a&&2E4>a?(p=d(0.5,0),m=d(0.2,2E4-a)):p=d(0.2,0)};this.getEdits=function(){return f.getEdits()};this.clearEdits=
function(){f.clearEdits();k.setEdits([]);l.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&l.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")};this.getEditInfo=function(){return f};this.show=function(){l.style.display="block"};this.hide=function(){b.hideHandle();l.style.display="none"};this.showHandle=function(){k.show()};this.hideHandle=function(){k.hide()};this.destroy=function(b){runtime.clearTimeout(p);runtime.clearTimeout(q);runtime.clearTimeout(m);e.removeChild(l);
k.destroy(function(c){c?b(c):f.destroy(b)})};(function(){var d=f.getOdtDocument().getDOMDocument();l=d.createElementNS(d.documentElement.namespaceURI,"div");l.setAttribute("class","editInfoMarker");l.onmouseover=function(){b.showHandle()};l.onmouseout=function(){b.hideHandle()};e=f.getNode();e.appendChild(l);k=new gui.EditInfoHandle(e);g||b.hide()})()};gui.HyperlinkTooltipView=function(f,g){var d=new core.DomUtils,b=new odf.OdfUtils,e=runtime.getWindow(),k,l,p;runtime.assert(null!==e,"Expected to be run in an environment which has a global window, like a browser.");this.showTooltip=function(q){var m=q.target||q.srcElement,r=f.getSizer(),c=f.getZoomLevel(),a;a:{for(;m;){if(b.isHyperlink(m))break a;if(b.isParagraph(m)||b.isInlineRoot(m))break;m=m.parentNode}m=null}if(m){d.containsNode(r,p)||r.appendChild(p);a=l;var n;switch(g()){case gui.KeyboardHandler.Modifier.Ctrl:n=
runtime.tr("Ctrl-click to follow link");break;case gui.KeyboardHandler.Modifier.Meta:n=runtime.tr("\u2318-click to follow link");break;default:n=""}a.textContent=n;k.textContent=b.getHyperlinkTarget(m);p.style.display="block";a=e.innerWidth-p.offsetWidth-15;m=q.clientX>a?a:q.clientX+15;a=e.innerHeight-p.offsetHeight-10;q=q.clientY>a?a:q.clientY+10;r=r.getBoundingClientRect();m=(m-r.left)/c;q=(q-r.top)/c;p.style.left=m+"px";p.style.top=q+"px"}};this.hideTooltip=function(){p.style.display="none"};this.destroy=
function(b){p.parentNode&&p.parentNode.removeChild(p);b()};(function(){var b=f.getElement().ownerDocument;k=b.createElement("span");l=b.createElement("span");k.className="webodf-hyperlinkTooltipLink";l.className="webodf-hyperlinkTooltipText";p=b.createElement("div");p.className="webodf-hyperlinkTooltip";p.appendChild(k);p.appendChild(l);f.getElement().appendChild(p)})()};gui.ShadowCursor=function(f){var g=f.getDOMDocument().createRange(),d=!0;this.removeFromDocument=function(){};this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId};this.getSelectedRange=function(){return g};this.setSelectedRange=function(b,e){g=b;d=!1!==e};this.hasForwardSelection=function(){return d};this.getDocument=function(){return f};this.getSelectionType=function(){return ops.OdtCursor.RangeSelection};g.setStart(f.getRootNode(),0)};gui.ShadowCursor.ShadowCursorMemberId="";gui.SelectionView=function(f){};gui.SelectionView.prototype.rerender=function(){};gui.SelectionView.prototype.show=function(){};gui.SelectionView.prototype.hide=function(){};gui.SelectionView.prototype.destroy=function(f){};gui.SelectionViewManager=function(f){function g(){return Object.keys(d).map(function(b){return d[b]})}var d={};this.getSelectionView=function(b){return d.hasOwnProperty(b)?d[b]:null};this.getSelectionViews=g;this.removeSelectionView=function(b){d.hasOwnProperty(b)&&(d[b].destroy(function(){}),delete d[b])};this.hideSelectionView=function(b){d.hasOwnProperty(b)&&d[b].hide()};this.showSelectionView=function(b){d.hasOwnProperty(b)&&d[b].show()};this.rerenderSelectionViews=function(){Object.keys(d).forEach(function(b){d[b].rerender()})};
this.registerCursor=function(b,e){var g=b.getMemberId(),l=new f(b);e?l.show():l.hide();return d[g]=l};this.destroy=function(b){function d(g,p){p?b(p):g<f.length?f[g].destroy(function(b){d(g+1,b)}):b()}var f=g();d(0,void 0)}};gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0};
(function(){gui.SessionView=function(f,g,d,b,e,k){function l(){var a=document.getElementsByTagName("head").item(0),b=document.createElement("style");b.type="text/css";b.media="screen, print, handheld, projection";a.appendChild(b);return b}function p(a,b,c){function d(b,c,e){c=b+'[editinfo|memberid="'+a+'"]'+e+c;a:{var f=v.firstChild;for(b=b+'[editinfo|memberid="'+a+'"]'+e+"{";f;){if(f.nodeType===Node.TEXT_NODE&&0===f.data.indexOf(b)){b=f;break a}f=f.nextSibling}b=null}b?b.data=c:v.appendChild(document.createTextNode(c))}
d("div.editInfoMarker","{ background-color: "+c+"; }","");d("span.editInfoColor","{ background-color: "+c+"; }","");d("span.editInfoAuthor",'{ content: "'+b+'"; }',":before");d("dc|creator","{ background-color: "+c+"; }","");d(".webodf-selectionOverlay","{ fill: "+c+"; stroke: "+c+";}","");a!==gui.ShadowCursor.ShadowCursorMemberId&&a!==g||d(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable")}function q(a){var b,c;for(c in u)u.hasOwnProperty(c)&&(b=u[c],a?
b.show():b.hide())}function m(a){e.getCarets().forEach(function(b){a?b.showHandle():b.hideHandle()})}function r(a){var b=a.getMemberId();a=a.getProperties();p(b,a.fullName,a.color);g===b&&p("","",a.color)}function c(a){var b=a.getMemberId(),c=d.getOdtDocument().getMember(b).getProperties();e.registerCursor(a,t,E);k.registerCursor(a,!0);if(a=e.getCaret(b))a.setAvatarImageUrl(c.imageUrl),a.setColor(c.color);runtime.log("+++ View here +++ eagerly created an Caret for '"+b+"'! +++")}function a(a){a=a.getMemberId();
var b=k.getSelectionView(g),c=k.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),d=e.getCaret(g);a===g?(c.hide(),b&&b.show(),d&&d.show()):a===gui.ShadowCursor.ShadowCursorMemberId&&(c.show(),b&&b.hide(),d&&d.hide())}function n(a){k.removeSelectionView(a)}function h(a){var b=a.paragraphElement,c=a.memberId;a=a.timeStamp;var e,f="",h=b.getElementsByTagNameNS(w,"editinfo").item(0);h?(f=h.getAttributeNS(w,"id"),e=u[f]):(f=Math.random().toString(),e=new ops.EditInfo(b,d.getOdtDocument()),e=new gui.EditInfoMarker(e,
x),h=b.getElementsByTagNameNS(w,"editinfo").item(0),h.setAttributeNS(w,"id",f),u[f]=e);e.addEdit(c,new Date(a))}function s(){var a;""!==y.innerHTML&&(y.innerHTML="");!0===b.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&(a=d.getOdtDocument().getMember(g))&&(a=a.getProperties().fullName,y.appendChild(document.createTextNode(".annotationWrapper:not([creator = '"+a+"']) .annotationRemoveButton { display: none; }")))}var v,y,w="urn:webodf:names:editinfo",u={},x=void 0!==f.editInfoMarkersInitiallyVisible?
Boolean(f.editInfoMarkersInitiallyVisible):!0,t=void 0!==f.caretAvatarsInitiallyVisible?Boolean(f.caretAvatarsInitiallyVisible):!0,E=void 0!==f.caretBlinksOnRangeSelect?Boolean(f.caretBlinksOnRangeSelect):!0;this.showEditInfoMarkers=function(){x||(x=!0,q(x))};this.hideEditInfoMarkers=function(){x&&(x=!1,q(x))};this.showCaretAvatars=function(){t||(t=!0,m(t))};this.hideCaretAvatars=function(){t&&(t=!1,m(t))};this.getSession=function(){return d};this.getCaret=function(a){return e.getCaret(a)};this.destroy=
function(e){var f=d.getOdtDocument(),g=Object.keys(u).map(function(a){return u[a]});f.unsubscribe(ops.Document.signalMemberAdded,r);f.unsubscribe(ops.Document.signalMemberUpdated,r);f.unsubscribe(ops.Document.signalCursorAdded,c);f.unsubscribe(ops.Document.signalCursorRemoved,n);f.unsubscribe(ops.OdtDocument.signalParagraphChanged,h);f.unsubscribe(ops.Document.signalCursorMoved,a);f.unsubscribe(ops.OdtDocument.signalParagraphChanged,k.rerenderSelectionViews);f.unsubscribe(ops.OdtDocument.signalTableAdded,
k.rerenderSelectionViews);f.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,k.rerenderSelectionViews);b.unsubscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,s);f.unsubscribe(ops.Document.signalMemberAdded,s);f.unsubscribe(ops.Document.signalMemberUpdated,s);v.parentNode.removeChild(v);y.parentNode.removeChild(y);(function P(a,b){b?e(b):a<g.length?g[a].destroy(function(b){P(a+1,b)}):e()})(0,void 0)};(function(){var e=d.getOdtDocument();e.subscribe(ops.Document.signalMemberAdded,
r);e.subscribe(ops.Document.signalMemberUpdated,r);e.subscribe(ops.Document.signalCursorAdded,c);e.subscribe(ops.Document.signalCursorRemoved,n);e.subscribe(ops.OdtDocument.signalParagraphChanged,h);e.subscribe(ops.Document.signalCursorMoved,a);e.subscribe(ops.OdtDocument.signalParagraphChanged,k.rerenderSelectionViews);e.subscribe(ops.OdtDocument.signalTableAdded,k.rerenderSelectionViews);e.subscribe(ops.OdtDocument.signalParagraphStyleModified,k.rerenderSelectionViews);b.subscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,
s);e.subscribe(ops.Document.signalMemberAdded,s);e.subscribe(ops.Document.signalMemberUpdated,s);v=l();v.appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);"));v.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);"));y=l();s()})()}})();gui.SvgSelectionView=function(f){function g(){var b=a.getRootNode();n!==b&&(n=b,h=a.getCanvas().getSizer(),h.appendChild(v),v.setAttribute("class","webodf-selectionOverlay"),w.setAttribute("class","webodf-draggable"),u.setAttribute("class","webodf-draggable"),w.setAttribute("end","left"),u.setAttribute("end","right"),w.setAttribute("r",8),u.setAttribute("r",8),v.appendChild(y),v.appendChild(w),v.appendChild(u))}function d(a){a=a.getBoundingClientRect();return Boolean(a&&0!==a.height)}function b(a){var b=
x.getTextElements(a,!0,!1),c=a.cloneRange(),e=a.cloneRange();a=a.cloneRange();if(!b.length)return null;var f;a:{f=0;var h=b[f],g=c.startContainer===h?c.startOffset:0,k=g;c.setStart(h,g);for(c.setEnd(h,k);!d(c);){if(h.nodeType===Node.ELEMENT_NODE&&k<h.childNodes.length)k=h.childNodes.length;else if(h.nodeType===Node.TEXT_NODE&&k<h.length)k+=1;else if(b[f])h=b[f],f+=1,g=k=0;else{f=!1;break a}c.setStart(h,g);c.setEnd(h,k)}f=!0}if(!f)return null;a:{f=b.length-1;h=b[f];k=g=e.endContainer===h?e.endOffset:
h.nodeType===Node.TEXT_NODE?h.length:h.childNodes.length;e.setStart(h,g);for(e.setEnd(h,k);!d(e);){if(h.nodeType===Node.ELEMENT_NODE&&0<g)g=0;else if(h.nodeType===Node.TEXT_NODE&&0<g)g-=1;else if(b[f])h=b[f],f-=1,g=k=h.length||h.childNodes.length;else{b=!1;break a}e.setStart(h,g);e.setEnd(h,k)}b=!0}if(!b)return null;a.setStart(c.startContainer,c.startOffset);a.setEnd(e.endContainer,e.endOffset);return{firstRange:c,lastRange:e,fillerRange:a}}function e(a,b){var c={};c.top=Math.min(a.top,b.top);c.left=
Math.min(a.left,b.left);c.right=Math.max(a.right,b.right);c.bottom=Math.max(a.bottom,b.bottom);c.width=c.right-c.left;c.height=c.bottom-c.top;return c}function k(a,b){b&&0<b.width&&0<b.height&&(a=a?e(a,b):b);return a}function l(b){function c(a){D.setUnfilteredPosition(a,0);return u.acceptNode(a)===L&&v.acceptPosition(D)===L?L:I}function d(a){var b=null;c(a)===L&&(b=t.getBoundingClientRect(a));return b}var e=b.commonAncestorContainer,f=b.startContainer,h=b.endContainer,g=b.startOffset,l=b.endOffset,
n,m,p=null,q,r=s.createRange(),v,u=new odf.OdfNodeFilter,w;if(f===e||h===e)return r=b.cloneRange(),p=r.getBoundingClientRect(),r.detach(),p;for(b=f;b.parentNode!==e;)b=b.parentNode;for(m=h;m.parentNode!==e;)m=m.parentNode;v=a.createRootFilter(f);for(e=b.nextSibling;e&&e!==m;)q=d(e),p=k(p,q),e=e.nextSibling;if(x.isParagraph(b))p=k(p,t.getBoundingClientRect(b));else if(b.nodeType===Node.TEXT_NODE)e=b,r.setStart(e,g),r.setEnd(e,e===m?l:e.length),q=r.getBoundingClientRect(),p=k(p,q);else for(w=s.createTreeWalker(b,
NodeFilter.SHOW_TEXT,c,!1),e=w.currentNode=f;e&&e!==h;)r.setStart(e,g),r.setEnd(e,e.length),q=r.getBoundingClientRect(),p=k(p,q),n=e,g=0,e=w.nextNode();n||(n=f);if(x.isParagraph(m))p=k(p,t.getBoundingClientRect(m));else if(m.nodeType===Node.TEXT_NODE)e=m,r.setStart(e,e===b?g:0),r.setEnd(e,l),q=r.getBoundingClientRect(),p=k(p,q);else for(w=s.createTreeWalker(m,NodeFilter.SHOW_TEXT,c,!1),e=w.currentNode=h;e&&e!==n;)if(r.setStart(e,0),r.setEnd(e,l),q=r.getBoundingClientRect(),p=k(p,q),e=w.previousNode())l=
e.length;return p}function p(a,b){var c=a.getBoundingClientRect(),d={width:0};d.top=c.top;d.bottom=c.bottom;d.height=c.height;d.left=d.right=b?c.right:c.left;return d}function q(){var a=f.getSelectedRange(),c;if(c=A&&f.getSelectionType()===ops.OdtCursor.RangeSelection&&!a.collapsed){g();var d=t.getBoundingClientRect(h),k=E.getZoomLevel(),a=b(a),n,m,q,r,s,x;if(a){c=a.firstRange;n=a.lastRange;m=a.fillerRange;q=t.translateRect(p(c,!1),d,k);s=t.translateRect(p(n,!0),d,k);r=(r=l(m))?t.translateRect(r,
d,k):e(q,s);x=r.left;r=q.left+Math.max(0,r.width-(q.left-r.left));d=Math.min(q.top,s.top);k=s.top+s.height;x=[{x:q.left,y:d+q.height},{x:q.left,y:d},{x:r,y:d},{x:r,y:k-s.height},{x:s.right,y:k-s.height},{x:s.right,y:k},{x:x,y:k},{x:x,y:d+q.height},{x:q.left,y:d+q.height}];r="";var D;for(D=0;D<x.length;D+=1)r+=x[D].x+","+x[D].y+" ";y.setAttribute("points",r);w.setAttribute("cx",q.left);w.setAttribute("cy",d+q.height/2);u.setAttribute("cx",s.right);u.setAttribute("cy",k-s.height/2);c.detach();n.detach();
m.detach()}c=Boolean(a)}v.style.display=c?"block":"none"}function m(a){A&&a===f&&P.trigger()}function r(a){a=8/a;w.setAttribute("r",a);u.setAttribute("r",a)}function c(a){h.removeChild(v);h.classList.remove("webodf-virtualSelections");f.getDocument().unsubscribe(ops.Document.signalCursorMoved,m);E.unsubscribe(gui.ZoomHelper.signalZoomChanged,r);a()}var a=f.getDocument(),n,h,s=a.getDOMDocument(),v=s.createElementNS("http://www.w3.org/2000/svg","svg"),y=s.createElementNS("http://www.w3.org/2000/svg",
"polygon"),w=s.createElementNS("http://www.w3.org/2000/svg","circle"),u=s.createElementNS("http://www.w3.org/2000/svg","circle"),x=new odf.OdfUtils,t=new core.DomUtils,E=a.getCanvas().getZoomHelper(),A=!0,D=gui.SelectionMover.createPositionIterator(a.getRootNode()),L=NodeFilter.FILTER_ACCEPT,I=NodeFilter.FILTER_REJECT,P;this.rerender=function(){A&&P.trigger()};this.show=function(){A=!0;P.trigger()};this.hide=function(){A=!1;P.trigger()};this.destroy=function(a){core.Async.destroyAll([P.destroy,c],
a)};(function(){var a=f.getMemberId();P=core.Task.createRedrawTask(q);g();v.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",a);h.classList.add("webodf-virtualSelections");f.getDocument().subscribe(ops.Document.signalCursorMoved,m);E.subscribe(gui.ZoomHelper.signalZoomChanged,r);r(E.getZoomLevel())})()};gui.UndoStateRules=function(){function f(b,d){var f=b.length;this.previous=function(){for(f-=1;0<=f;f-=1)if(d(b[f]))return b[f];return null}}function g(b){b=b.spec();var d;b.hasOwnProperty("position")&&(d=b.position);return d}function d(b){return b.isEdit}function b(b,d,f){if(!f)return f=g(b)-g(d),0===f||1===Math.abs(f);b=g(b);d=g(d);f=g(f);return b-d===d-f}this.isEditOperation=d;this.isPartOfOperationSet=function(e,g){var l=void 0!==e.group,p;if(!e.isEdit||0===g.length)return!0;p=g[g.length-1];if(l&&
e.group===p.group)return!0;a:switch(e.spec().optype){case "RemoveText":case "InsertText":p=!0;break a;default:p=!1}if(p&&g.some(d)){if(l){var q;l=e.spec().optype;p=new f(g,d);var m=p.previous(),r=null,c,a;runtime.assert(Boolean(m),"No edit operations found in state");a=m.group;runtime.assert(void 0!==a,"Operation has no group");for(c=1;m&&m.group===a;){if(l===m.spec().optype){q=m;break}m=p.previous()}if(q){for(m=p.previous();m;){if(m.group!==a){if(2===c)break;a=m.group;c+=1}if(l===m.spec().optype){r=
m;break}m=p.previous()}q=b(e,q,r)}else q=!1;return q}q=e.spec().optype;l=new f(g,d);p=l.previous();runtime.assert(Boolean(p),"No edit operations found in state");q=q===p.spec().optype?b(e,p,l.previous()):!1;return q}return!1}};gui.TrivialUndoManager=function(f){function g(a){0<a.length&&(x=!0,n(a),x=!1)}function d(){w.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:q.hasUndoStates(),redoAvailable:q.hasRedoStates()})}function b(){s!==a&&s!==v[v.length-1]&&v.push(s)}function e(a){var b=a.previousSibling||a.nextSibling;a.parentNode.removeChild(a);r.normalizeTextNodes(b)}function k(a){return Object.keys(a).map(function(b){return a[b]})}function l(a){function b(a){var h=a.spec();if(e[h.memberid])switch(h.optype){case "AddCursor":c[h.memberid]||
(c[h.memberid]=a,delete e[h.memberid],f-=1);break;case "MoveCursor":d[h.memberid]||(d[h.memberid]=a)}}var c={},d={},e={},f,g=a.pop();h.getMemberIds().forEach(function(a){e[a]=!0});for(f=Object.keys(e).length;g&&0<f;)g.reverse(),g.forEach(b),g=a.pop();return k(c).concat(k(d))}function p(){var f=c=h.cloneDocumentElement();r.getElementsByTagNameNS(f,m,"cursor").forEach(e);r.getElementsByTagNameNS(f,m,"anchor").forEach(e);b();s=a=l([a].concat(v));v.length=0;y.length=0;d()}var q=this,m="urn:webodf:names:cursor",
r=new core.DomUtils,c,a=[],n,h,s=[],v=[],y=[],w=new core.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.TrivialUndoManager.signalDocumentRootReplaced]),u=f||new gui.UndoStateRules,x=!1;this.subscribe=function(a,b){w.subscribe(a,b)};this.unsubscribe=function(a,b){w.unsubscribe(a,b)};this.hasUndoStates=function(){return 0<v.length};this.hasRedoStates=function(){return 0<y.length};this.setDocument=function(a){h=
a};this.purgeInitialState=function(){v.length=0;y.length=0;a.length=0;s.length=0;c=null;d()};this.setInitialState=p;this.initialize=function(){c||p()};this.setPlaybackFunction=function(a){n=a};this.onOperationExecuted=function(c){x||(u.isEditOperation(c)&&(s===a||0<y.length)||!u.isPartOfOperationSet(c,s)?(y.length=0,b(),s=[c],v.push(s),w.emit(gui.UndoManager.signalUndoStateCreated,{operations:s}),d()):(s.push(c),w.emit(gui.UndoManager.signalUndoStateModified,{operations:s})))};this.moveForward=function(a){for(var b=
0,c;a&&y.length;)c=y.pop(),v.push(c),g(c),a-=1,b+=1;b&&(s=v[v.length-1],d());return b};this.moveBackward=function(b){for(var e=0;b&&v.length;)y.push(v.pop()),b-=1,e+=1;e&&(h.getMemberIds().forEach(function(a){h.removeCursor(a)}),h.setDocumentElement(c.cloneNode(!0)),w.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),g(a),v.forEach(g),s=v[v.length-1]||a,d());return e}};gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced";odf.LazyStyleProperties=function(f,g){var d={};this.value=function(b){var e;d.hasOwnProperty(b)?e=d[b]:(e=g[b](),void 0===e&&f&&(e=f.value(b)),d[b]=e);return e};this.reset=function(b){f=b;d={}}};
odf.StyleParseUtils=function(){function f(d){var b,e;d=(d=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px))/.exec(d))?{value:parseFloat(d[1]),unit:d[3]}:null;e=d&&d.unit;"px"===e?b=d.value:"cm"===e?b=96*(d.value/2.54):"mm"===e?b=96*(d.value/25.4):"in"===e?b=96*d.value:"pt"===e?b=d.value/0.75:"pc"===e&&(b=16*d.value);return b}var g=odf.Namespaces.stylens;this.parseLength=f;this.parsePositiveLengthOrPercent=function(d,b,e){var g;d&&(g=parseFloat(d.substr(0,
d.indexOf("%"))),isNaN(g)&&(g=void 0));var l;void 0!==g?(e&&(l=e.value(b)),g=void 0===l?void 0:g*(l/100)):g=f(d);return g};this.getPropertiesElement=function(d,b,e){for(b=e?e.nextElementSibling:b.firstElementChild;null!==b&&(b.localName!==d||b.namespaceURI!==g);)b=b.nextElementSibling;return b}};odf.GraphicProperties=function(f,g,d){var b=this,e=odf.Namespaces.stylens,k=odf.Namespaces.svgns;this.verticalPos=function(){return b.data.value("verticalPos")};this.verticalRel=function(){return b.data.value("verticalRel")};this.horizontalPos=function(){return b.data.value("horizontalPos")};this.horizontalRel=function(){return b.data.value("horizontalRel")};this.strokeWidth=function(){return b.data.value("strokeWidth")};b.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{verticalPos:function(){var b=
f.getAttributeNS(e,"vertical-pos");return""===b?void 0:b},verticalRel:function(){var b=f.getAttributeNS(e,"vertical-rel");return""===b?void 0:b},horizontalPos:function(){var b=f.getAttributeNS(e,"horizontal-pos");return""===b?void 0:b},horizontalRel:function(){var b=f.getAttributeNS(e,"horizontal-rel");return""===b?void 0:b},strokeWidth:function(){var b=f.getAttributeNS(k,"stroke-width");return g.parseLength(b)}})};
odf.ComputedGraphicProperties=function(){var f;this.setGraphicProperties=function(g){f=g};this.verticalPos=function(){return f&&f.verticalPos()||"from-top"};this.verticalRel=function(){return f&&f.verticalRel()||"page"};this.horizontalPos=function(){return f&&f.horizontalPos()||"from-left"};this.horizontalRel=function(){return f&&f.horizontalRel()||"page"}};odf.PageLayoutProperties=function(f,g,d){var b=this,e=odf.Namespaces.fons;this.pageHeight=function(){return b.data.value("pageHeight")||1123};this.pageWidth=function(){return b.data.value("pageWidth")||794};b.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{pageHeight:function(){var b;f&&(b=f.getAttributeNS(e,"page-height"),b=g.parseLength(b));return b},pageWidth:function(){var b;f&&(b=f.getAttributeNS(e,"page-width"),b=g.parseLength(b));return b}})};
odf.PageLayout=function(f,g,d){var b=null;f&&(b=g.getPropertiesElement("page-layout-properties",f));this.pageLayout=new odf.PageLayoutProperties(b,g,d&&d.pageLayout)};odf.PageLayoutCache=function(){};odf.PageLayoutCache.prototype.getPageLayout=function(f){};odf.PageLayoutCache.prototype.getDefaultPageLayout=function(){};odf.ParagraphProperties=function(f,g,d){var b=this,e=odf.Namespaces.fons;this.marginTop=function(){return b.data.value("marginTop")};b.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{marginTop:function(){var b=f.getAttributeNS(e,"margin-top");return g.parsePositiveLengthOrPercent(b,"marginTop",d&&d.data)}})};
odf.ComputedParagraphProperties=function(){var f={},g=[];this.setStyleChain=function(d){g=d;f={}};this.marginTop=function(){var d,b;if(f.hasOwnProperty("marginTop"))d=f.marginTop;else{for(b=0;void 0===d&&b<g.length;b+=1)d=g[b].marginTop();f.marginTop=d}return d||0}};odf.TextProperties=function(f,g,d){var b=this,e=odf.Namespaces.fons;this.fontSize=function(){return b.data.value("fontSize")};b.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{fontSize:function(){var b=f.getAttributeNS(e,"font-size");return g.parsePositiveLengthOrPercent(b,"fontSize",d&&d.data)}})};
odf.ComputedTextProperties=function(){var f={},g=[];this.setStyleChain=function(d){g=d;f={}};this.fontSize=function(){var d,b;if(f.hasOwnProperty("fontSize"))d=f.fontSize;else{for(b=0;void 0===d&&b<g.length;b+=1)d=g[b].fontSize();f.fontSize=d}return d||12}};odf.MasterPage=function(f,g){var d;f?(d=f.getAttributeNS(odf.Namespaces.stylens,"page-layout-name"),this.pageLayout=g.getPageLayout(d)):this.pageLayout=g.getDefaultPageLayout()};odf.MasterPageCache=function(){};odf.MasterPageCache.prototype.getMasterPage=function(f){};
odf.StylePileEntry=function(f,g,d,b){this.masterPage=function(){var b=f.getAttributeNS(odf.Namespaces.stylens,"master-page-name"),g=null;b&&(g=d.getMasterPage(b));return g};(function(d){var k=f.getAttributeNS(odf.Namespaces.stylens,"family"),l=null;if("graphic"===k||"chart"===k)d.graphic=void 0===b?void 0:b.graphic,l=g.getPropertiesElement("graphic-properties",f,l),null!==l&&(d.graphic=new odf.GraphicProperties(l,g,d.graphic));if("paragraph"===k||"table-cell"===k||"graphic"===k||"presentation"===
k||"chart"===k)d.paragraph=void 0===b?void 0:b.paragraph,l=g.getPropertiesElement("paragraph-properties",f,l),null!==l&&(d.paragraph=new odf.ParagraphProperties(l,g,d.paragraph));if("text"===k||"paragraph"===k||"table-cell"===k||"graphic"===k||"presentation"===k||"chart"===k)d.text=void 0===b?void 0:b.text,l=g.getPropertiesElement("text-properties",f,l),null!==l&&(d.text=new odf.TextProperties(l,g,d.text))})(this)};
odf.StylePile=function(f,g){function d(d,c){var a,e;d.hasAttributeNS(b,"parent-style-name")&&(e=d.getAttributeNS(b,"parent-style-name"),-1===c.indexOf(e)&&(a=m(e,c)));return new odf.StylePileEntry(d,f,g,a)}var b=odf.Namespaces.stylens,e={},k={},l,p={},q={},m;m=function(b,c){var a=p[b],f;!a&&(f=e[b])&&(c.push(b),a=d(f,c),p[b]=a);return a};this.getStyle=function(b){var c=q[b]||p[b],a,f=[];c||(a=k[b],a||(a=e[b])&&f.push(b),a&&(c=d(a,f)));return c};this.addCommonStyle=function(d){var c;d.hasAttributeNS(b,
"name")&&(c=d.getAttributeNS(b,"name"),e.hasOwnProperty(c)||(e[c]=d))};this.addAutomaticStyle=function(d){var c;d.hasAttributeNS(b,"name")&&(c=d.getAttributeNS(b,"name"),k.hasOwnProperty(c)||(k[c]=d))};this.setDefaultStyle=function(b){void 0===l&&(l=d(b,[]))};this.getDefaultStyle=function(){return l}};odf.ComputedGraphicStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties;this.graphic=new odf.ComputedGraphicProperties};
odf.ComputedParagraphStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties};odf.ComputedTextStyle=function(){this.text=new odf.ComputedTextProperties};
odf.StyleCache=function(f){function g(a,b,c,d){b=c.getAttributeNS(b,"class-names");var e;if(b)for(b=b.split(" "),e=0;e<b.length;e+=1)if(c=b[e])d.push(a),d.push(c)}function d(a,b){var c=v.getStyleName("paragraph",a);void 0!==c&&(b.push("paragraph"),b.push(c));a.namespaceURI!==h||"h"!==a.localName&&"p"!==a.localName||g("paragraph",h,a,b);return b}function b(a,b,c){var d=[],e,f,h,g;for(e=0;e<a.length;e+=2)h=a[e],g=a[e+1],h=p[h],g=h.getStyle(g),void 0!==g&&(g=g[b],void 0!==g&&g!==f&&(d.push(g),f=g));
h=p[c];if(g=h.getDefaultStyle())g=g[b],void 0!==g&&g!==f&&d.push(g);return d}function e(a,b){var c=v.getStyleName("text",a),k=a.parentElement;void 0!==c&&(b.push("text"),b.push(c));"span"===a.localName&&a.namespaceURI===h&&g("text",h,a,b);if(!k||k===f)return b;k.namespaceURI!==h||"p"!==k.localName&&"h"!==k.localName?e(k,b):d(k,b);return b}function k(a){a=a.getAttributeNS(s,"family");return p[a]}var l=this,p,q,m,r,c,a,n,h=odf.Namespaces.textns,s=odf.Namespaces.stylens,v=new odf.StyleInfo,y=new odf.StyleParseUtils,
w,u,x,t,E,A;this.getComputedGraphicStyle=function(a){var c=[];a=v.getStyleName("graphic",a);void 0!==a&&(c.push("graphic"),c.push(a));a=c.join("/");var d=r[a];runtime.assert(0===c.length%2,"Invalid style chain.");void 0===d&&(d=new odf.ComputedGraphicStyle,d.graphic.setGraphicProperties(b(c,"graphic","graphic")[0]),d.text.setStyleChain(b(c,"text","graphic")),d.paragraph.setStyleChain(b(c,"paragraph","graphic")),r[a]=d);return d};this.getComputedParagraphStyle=function(a){a=d(a,[]);var c=a.join("/"),
e=m[c];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===e&&(e=new odf.ComputedParagraphStyle,e.text.setStyleChain(b(a,"text","paragraph")),e.paragraph.setStyleChain(b(a,"paragraph","paragraph")),m[c]=e);return e};this.getComputedTextStyle=function(a){a=e(a,[]);var c=a.join("/"),d=q[c];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===d&&(d=new odf.ComputedTextStyle,d.text.setStyleChain(b(a,"text","text")),q[c]=d);return d};this.getPageLayout=function(a){var b=A[a];b||((b=
E[a])?(b=new odf.PageLayout(b,y,t),A[a]=b):b=t);return b};this.getDefaultPageLayout=function(){return t};this.getMasterPage=function(a){var b=u[a];void 0===b&&((b=w[a])?(b=new odf.MasterPage(b,l),u[a]=b):b=null);return b};this.getDefaultMasterPage=function(){return x};this.update=function(){var b,d,e=null,g=null;q={};m={};r={};w={};u={};A={};E={};c=new odf.StylePile(y,l);a=new odf.StylePile(y,l);n=new odf.StylePile(y,l);p={text:c,paragraph:a,graphic:n};for(b=f.styles.firstElementChild;b;)b.namespaceURI===
s&&((d=k(b))?"style"===b.localName?d.addCommonStyle(b):"default-style"===b.localName&&d.setDefaultStyle(b):"default-page-layout"===b.localName&&(e=b)),b=b.nextElementSibling;t=new odf.PageLayout(e,y);for(b=f.automaticStyles.firstElementChild;b;)b.namespaceURI===s&&((d=k(b))&&"style"===b.localName?d.addAutomaticStyle(b):"page-layout"===b.localName&&(E[b.getAttributeNS(s,"name")]=b)),b=b.nextElementSibling;for(b=f.masterStyles.firstElementChild;b;)b.namespaceURI===s&&"master-page"===b.localName&&(g=
g||b,d=b,e=d.getAttributeNS(s,"name"),0<e.length&&!w.hasOwnProperty(e)&&(w[e]=d)),b=b.nextElementSibling;x=new odf.MasterPage(g,l)}};ops.OperationTransformMatrix=function(){function f(b){b.position+=b.length;b.length*=-1}function g(b){var a=0>b.length;a&&f(b);return a}function d(b,a){function d(f){b[f]===a&&e.push(f)}var e=[];b&&["style:parent-style-name","style:next-style-name"].forEach(d);return e}function b(b,a){function d(e){b[e]===a&&delete b[e]}b&&["style:parent-style-name","style:next-style-name"].forEach(d)}function e(b){var a={};Object.keys(b).forEach(function(d){a[d]="object"===typeof b[d]?e(b[d]):b[d]});return a}function k(b,
a,d,e){var f,g=!1,k=!1,l,m=[];e&&e.attributes&&(m=e.attributes.split(","));b&&(d||0<m.length)&&Object.keys(b).forEach(function(a){var e=b[a],f;"object"!==typeof e&&(d&&(f=d[a]),void 0!==f?(delete b[a],k=!0,f===e&&(delete d[a],g=!0)):-1!==m.indexOf(a)&&(delete b[a],k=!0))});if(a&&a.attributes&&(d||0<m.length)){l=a.attributes.split(",");for(e=0;e<l.length;e+=1)if(f=l[e],d&&void 0!==d[f]||m&&-1!==m.indexOf(f))l.splice(e,1),e-=1,k=!0;0<l.length?a.attributes=l.join(","):delete a.attributes}return{majorChanged:g,
minorChanged:k}}function l(b){for(var a in b)if(b.hasOwnProperty(a))return!0;return!1}function p(b){for(var a in b)if(b.hasOwnProperty(a)&&("attributes"!==a||0<b.attributes.length))return!0;return!1}function q(b,a,d,e,f){var g=b?b[f]:null,m=a?a[f]:null,q=d?d[f]:null,r=e?e[f]:null,x;x=k(g,m,q,r);g&&!l(g)&&delete b[f];m&&!p(m)&&delete a[f];q&&!l(q)&&delete d[f];r&&!p(r)&&delete e[f];return x}function m(b,a){return{opSpecsA:[b],opSpecsB:[a]}}var r;r={AddCursor:{AddCursor:m,AddMember:m,AddStyle:m,ApplyDirectStyling:m,
InsertText:m,MoveCursor:m,RemoveCursor:m,RemoveMember:m,RemoveStyle:m,RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},AddMember:{AddStyle:m,InsertText:m,MoveCursor:m,RemoveCursor:m,RemoveStyle:m,RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMetadata:m,UpdateParagraphStyle:m},AddStyle:{AddStyle:m,ApplyDirectStyling:m,InsertText:m,MoveCursor:m,RemoveCursor:m,RemoveMember:m,RemoveStyle:function(c,a){var e,f=[c],g=[a];c.styleFamily===
a.styleFamily&&(e=d(c.setProperties,a.styleName),0<e.length&&(e={optype:"UpdateParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,styleName:c.styleName,removedProperties:{attributes:e.join(",")}},g.unshift(e)),b(c.setProperties,a.styleName));return{opSpecsA:f,opSpecsB:g}},RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},ApplyDirectStyling:{ApplyDirectStyling:function(b,a,d){var f,g,k,m,p,r,x,t;m=[b];k=[a];if(!(b.position+b.length<=a.position||
b.position>=a.position+a.length)){f=d?b:a;g=d?a:b;if(b.position!==a.position||b.length!==a.length)r=e(f),x=e(g);a=q(g.setProperties,null,f.setProperties,null,"style:text-properties");if(a.majorChanged||a.minorChanged)k=[],b=[],m=f.position+f.length,p=g.position+g.length,g.position<f.position?a.minorChanged&&(t=e(x),t.length=f.position-g.position,b.push(t),g.position=f.position,g.length=p-g.position):f.position<g.position&&a.majorChanged&&(t=e(r),t.length=g.position-f.position,k.push(t),f.position=
g.position,f.length=m-f.position),p>m?a.minorChanged&&(r=x,r.position=m,r.length=p-m,b.push(r),g.length=m-g.position):m>p&&a.majorChanged&&(r.position=p,r.length=m-p,k.push(r),f.length=p-f.position),f.setProperties&&l(f.setProperties)&&k.push(f),g.setProperties&&l(g.setProperties)&&b.push(g),d?(m=k,k=b):m=b}return{opSpecsA:m,opSpecsB:k}},InsertText:function(b,a){a.position<=b.position?b.position+=a.text.length:a.position<=b.position+b.length&&(b.length+=a.text.length);return{opSpecsA:[b],opSpecsB:[a]}},
MoveCursor:m,RemoveCursor:m,RemoveStyle:m,RemoveText:function(b,a){var d=b.position+b.length,e=a.position+a.length,f=[b],g=[a];e<=b.position?b.position-=a.length:a.position<d&&(b.position<a.position?b.length=e<d?b.length-a.length:a.position-b.position:(b.position=a.position,e<d?b.length=d-e:f=[]));return{opSpecsA:f,opSpecsB:g}},SetParagraphStyle:m,SplitParagraph:function(b,a){a.position<b.position?b.position+=1:a.position<b.position+b.length&&(b.length+=1);return{opSpecsA:[b],opSpecsB:[a]}},UpdateMetadata:m,
UpdateParagraphStyle:m},InsertText:{InsertText:function(b,a,d){b.position<a.position?a.position+=b.text.length:b.position>a.position?b.position+=a.text.length:d?a.position+=b.text.length:b.position+=a.text.length;return{opSpecsA:[b],opSpecsB:[a]}},MoveCursor:function(b,a){var d=g(a);b.position<a.position?a.position+=b.text.length:b.position<a.position+a.length&&(a.length+=b.text.length);d&&f(a);return{opSpecsA:[b],opSpecsB:[a]}},RemoveCursor:m,RemoveMember:m,RemoveStyle:m,RemoveText:function(b,a){var d;
d=a.position+a.length;var e=[b],f=[a];d<=b.position?b.position-=a.length:b.position<=a.position?a.position+=b.text.length:(a.length=b.position-a.position,d={optype:"RemoveText",memberid:a.memberid,timestamp:a.timestamp,position:b.position+b.text.length,length:d-b.position},f.unshift(d),b.position=a.position);return{opSpecsA:e,opSpecsB:f}},SplitParagraph:function(b,a){b.position<=a.position?a.position+=b.text.length:b.position+=1;return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},
MoveCursor:{MoveCursor:m,RemoveCursor:function(b,a){return{opSpecsA:b.memberid===a.memberid?[]:[b],opSpecsB:[a]}},RemoveMember:m,RemoveStyle:m,RemoveText:function(b,a){var d=g(b),e=b.position+b.length,k=a.position+a.length;k<=b.position?b.position-=a.length:a.position<e&&(b.position<a.position?b.length=k<e?b.length-a.length:a.position-b.position:(b.position=a.position,b.length=k<e?e-k:0));d&&f(b);return{opSpecsA:[b],opSpecsB:[a]}},SetParagraphStyle:m,SplitParagraph:function(b,a){var d=g(b);a.position<
b.position?b.position+=1:a.position<b.position+b.length&&(b.length+=1);d&&f(b);return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},RemoveCursor:{RemoveCursor:function(b,a){var d=b.memberid===a.memberid;return{opSpecsA:d?[]:[b],opSpecsB:d?[]:[a]}},RemoveMember:m,RemoveStyle:m,RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},RemoveMember:{RemoveStyle:m,RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMetadata:m,
UpdateParagraphStyle:m},RemoveStyle:{RemoveStyle:function(b,a){var d=b.styleName===a.styleName&&b.styleFamily===a.styleFamily;return{opSpecsA:d?[]:[b],opSpecsB:d?[]:[a]}},RemoveText:m,SetParagraphStyle:function(b,a){var d,e=[b],f=[a];"paragraph"===b.styleFamily&&b.styleName===a.styleName&&(d={optype:"SetParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,position:a.position,styleName:""},e.unshift(d),a.styleName="");return{opSpecsA:e,opSpecsB:f}},SplitParagraph:m,UpdateMember:m,UpdateMetadata:m,
UpdateParagraphStyle:function(c,a){var e,f=[c],g=[a];"paragraph"===c.styleFamily&&(e=d(a.setProperties,c.styleName),0<e.length&&(e={optype:"UpdateParagraphStyle",memberid:c.memberid,timestamp:c.timestamp,styleName:a.styleName,removedProperties:{attributes:e.join(",")}},f.unshift(e)),c.styleName===a.styleName?g=[]:b(a.setProperties,c.styleName));return{opSpecsA:f,opSpecsB:g}}},RemoveText:{RemoveText:function(b,a){var d=b.position+b.length,e=a.position+a.length,f=[b],g=[a];e<=b.position?b.position-=
a.length:d<=a.position?a.position-=b.length:a.position<d&&(b.position<a.position?(b.length=e<d?b.length-a.length:a.position-b.position,d<e?(a.position=b.position,a.length=e-d):g=[]):(d<e?a.length-=b.length:a.position<b.position?a.length=b.position-a.position:g=[],e<d?(b.position=a.position,b.length=d-e):f=[]));return{opSpecsA:f,opSpecsB:g}},SplitParagraph:function(b,a){var d=b.position+b.length,e=[b],f=[a];a.position<=b.position?b.position+=1:a.position<d&&(b.length=a.position-b.position,d={optype:"RemoveText",
memberid:b.memberid,timestamp:b.timestamp,position:a.position+1,length:d-a.position},e.unshift(d));b.position+b.length<=a.position?a.position-=b.length:b.position<a.position&&(a.position=b.position);return{opSpecsA:e,opSpecsB:f}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},SetParagraphStyle:{UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},SplitParagraph:{SplitParagraph:function(b,a,d){b.position<a.position?a.position+=1:b.position>a.position?b.position+=1:b.position===a.position&&
(d?a.position+=1:b.position+=1);return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},UpdateMember:{UpdateMetadata:m,UpdateParagraphStyle:m},UpdateMetadata:{UpdateMetadata:function(b,a,d){var e,f=[b],g=[a];e=d?b:a;b=d?a:b;k(b.setProperties||null,b.removedProperties||null,e.setProperties||null,e.removedProperties||null);e.setProperties&&l(e.setProperties)||e.removedProperties&&p(e.removedProperties)||(d?f=[]:g=[]);b.setProperties&&l(b.setProperties)||b.removedProperties&&
p(b.removedProperties)||(d?g=[]:f=[]);return{opSpecsA:f,opSpecsB:g}},UpdateParagraphStyle:m},UpdateParagraphStyle:{UpdateParagraphStyle:function(b,a,d){var e,f=[b],g=[a];b.styleName===a.styleName&&(e=d?b:a,b=d?a:b,q(b.setProperties,b.removedProperties,e.setProperties,e.removedProperties,"style:paragraph-properties"),q(b.setProperties,b.removedProperties,e.setProperties,e.removedProperties,"style:text-properties"),k(b.setProperties||null,b.removedProperties||null,e.setProperties||null,e.removedProperties||
null),e.setProperties&&l(e.setProperties)||e.removedProperties&&p(e.removedProperties)||(d?f=[]:g=[]),b.setProperties&&l(b.setProperties)||b.removedProperties&&p(b.removedProperties)||(d?g=[]:f=[]));return{opSpecsA:f,opSpecsB:g}}}};this.passUnchanged=m;this.extendTransformations=function(b){Object.keys(b).forEach(function(a){var d=b[a],e,f=r.hasOwnProperty(a);runtime.log((f?"Extending":"Adding")+" map for optypeA: "+a);f||(r[a]={});e=r[a];Object.keys(d).forEach(function(b){var c=e.hasOwnProperty(b);
runtime.assert(a<=b,"Wrong order:"+a+", "+b);runtime.log("  "+(c?"Overwriting":"Adding")+" entry for optypeB: "+b);e[b]=d[b]})})};this.transformOpspecVsOpspec=function(b,a){var d=b.optype<=a.optype,e;runtime.log("Crosstransforming:");runtime.log(runtime.toJson(b));runtime.log(runtime.toJson(a));d||(e=b,b=a,a=e);(e=(e=r[b.optype])&&e[a.optype])?(e=e(b,a,!d),d||null===e||(e={opSpecsA:e.opSpecsB,opSpecsB:e.opSpecsA})):e=null;runtime.log("result:");e?(runtime.log(runtime.toJson(e.opSpecsA)),runtime.log(runtime.toJson(e.opSpecsB))):
runtime.log("null");return e}};ops.OperationTransformer=function(){function f(d,b){for(var e,k,l=[],p=[];0<d.length&&b;){e=d.shift();e=g.transformOpspecVsOpspec(e,b);if(!e)return null;l=l.concat(e.opSpecsA);if(0===e.opSpecsB.length){l=l.concat(d);b=null;break}for(;1<e.opSpecsB.length;){k=f(d,e.opSpecsB.shift());if(!k)return null;p=p.concat(k.opSpecsB);d=k.opSpecsA}b=e.opSpecsB.pop()}b&&p.push(b);return{opSpecsA:l,opSpecsB:p}}var g=new ops.OperationTransformMatrix;this.getOperationTransformMatrix=function(){return g};this.transform=
function(d,b){for(var e,g=[];0<b.length;){e=f(d,b.shift());if(!e)return null;d=e.opSpecsA;g=g.concat(e.opSpecsB)}return{opSpecsA:d,opSpecsB:g}}};var webodf_css="/**\n * Copyright (C) 2010-2014 KO GmbH <copyright@kogmbh.com>\n *\n * @licstart\n * This file is part of WebODF.\n *\n * WebODF is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License (GNU AGPL)\n * as published by the Free Software Foundation, either version 3 of\n * the License, or (at your option) any later version.\n *\n * WebODF is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with WebODF.  If not, see <http://www.gnu.org/licenses/>.\n * @licend\n *\n * @source: http://www.webodf.org/\n * @source: https://github.com/kogmbh/WebODF/\n */\n\n@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);\n@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);\n@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);\n@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);\n@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);\n@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);\n@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);\n@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);\n@namespace webodfhelper url(urn:webodf:names:helper);\n@namespace cursor url(urn:webodf:names:cursor);\n@namespace editinfo url(urn:webodf:names:editinfo);\n@namespace annotation url(urn:webodf:names:annotation);\n@namespace dc url(http://purl.org/dc/elements/1.1/);\n@namespace svgns url(http://www.w3.org/2000/svg);\n\noffice|document > *, office|document-content > * {\n  display: none;\n}\noffice|body, office|document {\n  display: inline-block;\n  position: relative;\n}\n\ntext|p, text|h {\n  display: block;\n  padding: 0;\n  margin: 0;\n  line-height: normal;\n  position: relative;\n  min-height: 1.3em; /* prevent empty paragraphs and headings from collapsing if they are empty */\n}\n*[webodfhelper|containsparagraphanchor] {\n  position: relative;\n}\ntext|s {\n    white-space: pre;\n}\ntext|tab {\n  display: inline;\n  white-space: pre;\n}\ntext|tracked-changes {\n  /*Consumers that do not support change tracking, should ignore changes.*/\n  display: none;\n}\noffice|binary-data {\n  display: none;\n}\noffice|text {\n  display: block;\n  text-align: left;\n  overflow: visible;\n  word-wrap: break-word;\n}\n\noffice|text::selection {\n  /** Let's not draw selection highlight that overflows into the office|text\n   * node when selecting content across several paragraphs\n   */\n  background: transparent;\n}\n\n.webodf-virtualSelections *::selection {\n  background: transparent;\n}\n.webodf-virtualSelections *::-moz-selection {\n  background: transparent;\n}\n\noffice|text * draw|text-box {\n/** only for text documents */\n    display: block;\n    border: 1px solid #d3d3d3;\n}\noffice|text draw|frame {\n  /** make sure frames are above the main text. */\n  z-index: 1;\n}\noffice|spreadsheet {\n  display: block;\n  border-collapse: collapse;\n  empty-cells: show;\n  font-family: sans-serif;\n  font-size: 10pt;\n  text-align: left;\n  page-break-inside: avoid;\n  overflow: hidden;\n}\noffice|presentation {\n  display: inline-block;\n  text-align: left;\n}\n#shadowContent {\n  display: inline-block;\n  text-align: left;\n}\ndraw|page {\n  display: block;\n  position: relative;\n  overflow: hidden;\n}\npresentation|notes, presentation|footer-decl, presentation|date-time-decl {\n    display: none;\n}\n@media print {\n  draw|page {\n    border: 1pt solid black;\n    page-break-inside: avoid;\n  }\n  presentation|notes {\n    /*TODO*/\n  }\n}\noffice|spreadsheet text|p {\n  border: 0px;\n  padding: 1px;\n  margin: 0px;\n}\noffice|spreadsheet table|table {\n  margin: 3px;\n}\noffice|spreadsheet table|table:after {\n  /* show sheet name the end of the sheet */\n  /*content: attr(table|name);*/ /* gives parsing error in opera */\n}\noffice|spreadsheet table|table-row {\n  counter-increment: row;\n}\noffice|spreadsheet table|table-row:before {\n  width: 3em;\n  background: #cccccc;\n  border: 1px solid black;\n  text-align: center;\n  content: counter(row);\n  display: table-cell;\n}\noffice|spreadsheet table|table-cell {\n  border: 1px solid #cccccc;\n}\ntable|table {\n  display: table;\n}\ndraw|frame table|table {\n  width: 100%;\n  height: 100%;\n  background: white;\n}\ntable|table-header-rows {\n  display: table-header-group;\n}\ntable|table-row {\n  display: table-row;\n}\ntable|table-column {\n  display: table-column;\n}\ntable|table-cell {\n  width: 0.889in;\n  display: table-cell;\n  word-break: break-all; /* prevent long words from extending out the table cell */\n}\ndraw|frame {\n  display: block;\n}\ndraw|image {\n  display: block;\n  width: 100%;\n  height: 100%;\n  top: 0px;\n  left: 0px;\n  background-repeat: no-repeat;\n  background-size: 100% 100%;\n  -moz-background-size: 100% 100%;\n}\n/* only show the first image in frame */\ndraw|frame > draw|image:nth-of-type(n+2) {\n  display: none;\n}\ntext|list:before {\n    display: none;\n    content:\"\";\n}\ntext|list {\n    display: block;\n    counter-reset: list;\n}\ntext|list-item {\n    display: block;\n}\ntext|number {\n    display:none;\n}\n\ntext|a {\n    color: blue;\n    text-decoration: underline;\n    cursor: pointer;\n}\n.webodf-inactiveLinks text|a {\n    cursor: text;\n}\ntext|note-citation {\n    vertical-align: super;\n    font-size: smaller;\n}\ntext|note-body {\n    display: none;\n}\ntext|note:hover text|note-citation {\n    background: #dddddd;\n}\ntext|note:hover text|note-body {\n    display: block;\n    left:1em;\n    max-width: 80%;\n    position: absolute;\n    background: #ffffaa;\n}\ntext|bibliography-source {\n  display: none;\n}\nsvg|title, svg|desc {\n    display: none;\n}\nvideo {\n    width: 100%;\n    height: 100%\n}\n\n/* below set up the cursor */\ncursor|anchor {\n    display: none;\n}\n\ncursor|cursor {\n    display: none;\n}\n\n.webodf-caretOverlay {\n    position: absolute;\n    top: 5%; /* push down the caret; 0px can do the job, 5% looks better, 10% is a bit over */\n    height: 1em;\n    margin-left: -1px;\n    z-index: 10;\n    pointer-events: none;\n}\n\n.webodf-caretOverlay .caret {\n    position: absolute;\n    border-left: 2px solid black;\n    top: 0;\n    bottom: 0;\n}\n\n.webodf-caretOverlay .handle {\n    margin-top: 5px;\n    padding-top: 3px;\n    margin-left: auto;\n    margin-right: auto;\n    width: 64px !important;\n    height: 68px !important;\n    border-radius: 5px;\n    opacity: 0.3;\n    text-align: center;\n    background-color: black !important;\n    box-shadow: 0px 0px 5px rgb(90, 90, 90);\n    border: 1px solid black;\n\n    top: -85px !important;\n    left: -32px !important;\n}\n\n.webodf-caretOverlay .handle > img {\n    box-shadow: 0px 0px 5px rgb(90, 90, 90) inset;\n    background-color: rgb(200, 200, 200);\n    border-radius: 5px;\n    border: 2px solid;\n    height: 60px !important;\n    width: 60px !important;\n    display: block;\n    margin: auto;\n}\n\n.webodf-caretOverlay .handle.active {\n    opacity: 0.8;\n}\n\n.webodf-caretOverlay .handle:after {\n    content: ' ';\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: black transparent transparent transparent;\n\n    top: 100%;\n    left: 43%;\n}\n\n.webodf-caretSizer {\n    display: inline-block; /* inline-block is necessary so the width can be set to 0 */\n    width: 0; /* the caret sizer shouldn't take up any horizontal space */\n    visibility: hidden; /* \"hidden\" means the client rects are still calculated, but the node content is not shown */\n}\n\n/** Input Method Editor input pane & behaviours */\n/* not within a cursor */\n#eventTrap {\n    height: auto;\n    display: block;\n    position: absolute;\n    bottom: 0;\n    right: 0;\n    width: 1px;\n    outline: none;\n    opacity: 0;\n    color: rgba(255, 255, 255, 0); /* hide the blinking caret by setting the colour to fully transparent */\n    overflow: hidden; /* The overflow visibility is used to hide and show characters being entered */\n    pointer-events: none;\n}\n\n/* within a cursor */\ncursor|cursor > #composer {\n    text-decoration: underline;\n}\n\ncursor|cursor[cursor|caret-sizer-active=\"true\"],\ncursor|cursor[cursor|composing=\"true\"] {\n    display: inline;\n}\n\neditinfo|editinfo {\n    /* Empty or invisible display:inline elements respond very badly to mouse selection.\n       Inline blocks are much more reliably selectable in Chrome & friends */\n    display: inline-block;\n}\n\n.editInfoMarker {\n    position: absolute;\n    width: 10px;\n    height: 100%;\n    left: -20px;\n    opacity: 0.8;\n    top: 0;\n    border-radius: 5px;\n    background-color: transparent;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n}\n.editInfoMarker:hover {\n    box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);\n}\n\n.editInfoHandle {\n    position: absolute;\n    background-color: black;\n    padding: 5px;\n    border-radius: 5px;\n    opacity: 0.8;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n    bottom: 100%;\n    margin-bottom: 10px;\n    z-index: 3;\n    left: -25px;\n}\n.editInfoHandle:after {\n    content: ' ';\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: black transparent transparent transparent;\n\n    top: 100%;\n    left: 5px;\n}\n.editInfo {\n    font-family: sans-serif;\n    font-weight: normal;\n    font-style: normal;\n    text-decoration: none;\n    color: white;\n    width: 100%;\n    height: 12pt;\n}\n.editInfoColor {\n    float: left;\n    width: 10pt;\n    height: 10pt;\n    border: 1px solid white;\n}\n.editInfoAuthor {\n    float: left;\n    margin-left: 5pt;\n    font-size: 10pt;\n    text-align: left;\n    height: 12pt;\n    line-height: 12pt;\n}\n.editInfoTime {\n    float: right;\n    margin-left: 30pt;\n    font-size: 8pt;\n    font-style: italic;\n    color: yellow;\n    height: 12pt;\n    line-height: 12pt;\n}\n\n.annotationWrapper {\n    display: inline;\n    position: relative;\n}\n\n.annotationRemoveButton:before {\n    content: '\u00d7';\n    color: white;\n    padding: 5px;\n    line-height: 1em;\n}\n\n.annotationRemoveButton {\n    width: 20px;\n    height: 20px;\n    border-radius: 10px;\n    background-color: black;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n    position: absolute;\n    top: -10px;\n    left: -10px;\n    z-index: 3;\n    text-align: center;\n    font-family: sans-serif;\n    font-style: normal;\n    font-weight: normal;\n    text-decoration: none;\n    font-size: 15px;\n}\n.annotationRemoveButton:hover {\n    cursor: pointer;\n    box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);\n}\n\n.annotationNote {\n    width: 4cm;\n    position: absolute;\n    display: inline;\n    z-index: 10;\n    top: 0;\n}\n.annotationNote > office|annotation {\n    display: block;\n    text-align: left;\n}\n\n.annotationConnector {\n    position: absolute;\n    display: inline;\n    top: 0;\n    z-index: 2;\n    border-top: 1px dashed brown;\n}\n.annotationConnector.angular {\n    -moz-transform-origin: left top;\n    -webkit-transform-origin: left top;\n    -ms-transform-origin: left top;\n    transform-origin: left top;\n}\n.annotationConnector.horizontal {\n    left: 0;\n}\n.annotationConnector.horizontal:before {\n    content: '';\n    display: inline;\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: brown transparent transparent transparent;\n    top: -1px;\n    left: -5px;\n}\n\noffice|annotation {\n    width: 100%;\n    height: 100%;\n    display: none;\n    background: rgb(198, 238, 184);\n    background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    box-shadow: 0 3px 4px -3px #ccc;\n}\n\noffice|annotation > dc|creator {\n    display: block;\n    font-size: 10pt;\n    font-weight: normal;\n    font-style: normal;\n    font-family: sans-serif;\n    color: white;\n    background-color: brown;\n    padding: 4px;\n}\noffice|annotation > dc|date {\n    display: block;\n    font-size: 10pt;\n    font-weight: normal;\n    font-style: normal;\n    font-family: sans-serif;\n    border: 4px solid transparent;\n    color: black;\n}\noffice|annotation > text|list {\n    display: block;\n    padding: 5px;\n}\n\n/* This is very temporary CSS. This must go once\n * we start bundling webodf-default ODF styles for annotations.\n */\noffice|annotation text|p {\n    font-size: 10pt;\n    color: black;\n    font-weight: normal;\n    font-style: normal;\n    text-decoration: none;\n    font-family: sans-serif;\n}\n\n#annotationsPane {\n    background-color: #EAEAEA;\n    width: 4cm;\n    height: 100%;\n    display: none;\n    position: absolute;\n    outline: 1px solid #ccc;\n}\n\n.webodf-annotationHighlight {\n    background-color: yellow;\n    position: relative;\n}\n\n.webodf-selectionOverlay {\n    position: absolute;\n    pointer-events: none;\n    top: 0;\n    left: 0;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 15;\n}\n.webodf-selectionOverlay > polygon {\n    fill-opacity: 0.3;\n    stroke-opacity: 0.8;\n    stroke-width: 1;\n    fill-rule: evenodd;\n}\n\n.webodf-selectionOverlay > .webodf-draggable {\n    fill-opacity: 0.8;\n    stroke-opacity: 0;\n    stroke-width: 8;\n    pointer-events: all;\n    display: none;\n\n    -moz-transform-origin: center center;\n    -webkit-transform-origin: center center;\n    -ms-transform-origin: center center;\n    transform-origin: center center;\n}\n\n#imageSelector {\n    display: none;\n    position: absolute;\n    border-style: solid;\n    border-color: black;\n}\n\n#imageSelector > div {\n    width: 5px;\n    height: 5px;\n    display: block;\n    position: absolute;\n    border: 1px solid black;\n    background-color: #ffffff;\n}\n\n#imageSelector > .topLeft {\n    top: -4px;\n    left: -4px;\n}\n\n#imageSelector > .topRight {\n    top: -4px;\n    right: -4px;\n}\n\n#imageSelector > .bottomRight {\n    right: -4px;\n    bottom: -4px;\n}\n\n#imageSelector > .bottomLeft {\n    bottom: -4px;\n    left: -4px;\n}\n\n#imageSelector > .topMiddle {\n    top: -4px;\n    left: 50%;\n    margin-left: -2.5px; /* half of the width defined in #imageSelector > div */\n}\n\n#imageSelector > .rightMiddle {\n    top: 50%;\n    right: -4px;\n    margin-top: -2.5px; /* half of the height defined in #imageSelector > div */\n}\n\n#imageSelector > .bottomMiddle {\n    bottom: -4px;\n    left: 50%;\n    margin-left: -2.5px; /* half of the width defined in #imageSelector > div */\n}\n\n#imageSelector > .leftMiddle {\n    top: 50%;\n    left: -4px;\n    margin-top: -2.5px; /* half of the height defined in #imageSelector > div */\n}\n\ndiv.webodf-customScrollbars::-webkit-scrollbar\n{\n    width: 8px;\n    height: 8px;\n    background-color: transparent;\n}\n\ndiv.webodf-customScrollbars::-webkit-scrollbar-track\n{\n    background-color: transparent;\n}\n\ndiv.webodf-customScrollbars::-webkit-scrollbar-thumb\n{\n    background-color: #444;\n    border-radius: 4px;\n}\n\n.webodf-hyperlinkTooltip {\n    display: none;\n    color: white;\n    background-color: black;\n    border-radius: 5px;\n    box-shadow: 2px 2px 5px gray;\n    padding: 3px;\n    position: absolute;\n    max-width: 210px;\n    text-align: left;\n    word-break: break-all;\n    z-index: 16;\n}\n\n.webodf-hyperlinkTooltipText {\n    display: block;\n    font-weight: bold;\n}\n";
